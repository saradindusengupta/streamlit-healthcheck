<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.4"/>
    <title>streamlit_healthcheck.healthcheck API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../streamlit_healthcheck.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;streamlit_healthcheck</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="variable" href="#logger">logger</a>
            </li>
            <li>
                    <a class="class" href="#StreamlitPageMonitor">StreamlitPageMonitor</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#StreamlitPageMonitor.set_page_context">set_page_context</a>
                        </li>
                        <li>
                                <a class="function" href="#StreamlitPageMonitor.monitor_page">monitor_page</a>
                        </li>
                        <li>
                                <a class="function" href="#StreamlitPageMonitor.get_page_errors">get_page_errors</a>
                        </li>
                        <li>
                                <a class="function" href="#StreamlitPageMonitor.clear_errors">clear_errors</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#HealthCheckService">HealthCheckService</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#HealthCheckService.__init__">HealthCheckService</a>
                        </li>
                        <li>
                                <a class="variable" href="#HealthCheckService.logger">logger</a>
                        </li>
                        <li>
                                <a class="variable" href="#HealthCheckService.config_path">config_path</a>
                        </li>
                        <li>
                                <a class="variable" href="#HealthCheckService.health_data">health_data</a>
                        </li>
                        <li>
                                <a class="variable" href="#HealthCheckService.config">config</a>
                        </li>
                        <li>
                                <a class="variable" href="#HealthCheckService.check_interval">check_interval</a>
                        </li>
                        <li>
                                <a class="variable" href="#HealthCheckService.streamlit_url">streamlit_url</a>
                        </li>
                        <li>
                                <a class="variable" href="#HealthCheckService.streamlit_port">streamlit_port</a>
                        </li>
                        <li>
                                <a class="function" href="#HealthCheckService.start">start</a>
                        </li>
                        <li>
                                <a class="function" href="#HealthCheckService.stop">stop</a>
                        </li>
                        <li>
                                <a class="function" href="#HealthCheckService.run_all_checks">run_all_checks</a>
                        </li>
                        <li>
                                <a class="function" href="#HealthCheckService.check_cpu">check_cpu</a>
                        </li>
                        <li>
                                <a class="function" href="#HealthCheckService.check_memory">check_memory</a>
                        </li>
                        <li>
                                <a class="function" href="#HealthCheckService.check_disk">check_disk</a>
                        </li>
                        <li>
                                <a class="function" href="#HealthCheckService.check_dependencies">check_dependencies</a>
                        </li>
                        <li>
                                <a class="function" href="#HealthCheckService.register_custom_check">register_custom_check</a>
                        </li>
                        <li>
                                <a class="function" href="#HealthCheckService.run_custom_checks">run_custom_checks</a>
                        </li>
                        <li>
                                <a class="function" href="#HealthCheckService.get_health_data">get_health_data</a>
                        </li>
                        <li>
                                <a class="function" href="#HealthCheckService.save_config">save_config</a>
                        </li>
                        <li>
                                <a class="function" href="#HealthCheckService.check_streamlit_pages">check_streamlit_pages</a>
                        </li>
                        <li>
                                <a class="function" href="#HealthCheckService.check_streamlit_server">check_streamlit_server</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#health_check">health_check</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../streamlit_healthcheck.html">streamlit_healthcheck</a><wbr>.healthcheck    </h1>

                
                        <input id="mod-healthcheck-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-healthcheck-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">streamlit</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">st</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">psutil</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Callable</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">functools</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">traceback</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="c1"># Set up logging</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a>    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a>    <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(name)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a>    <span class="n">handlers</span><span class="o">=</span><span class="p">[</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a>        <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a>    <span class="p">]</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a><span class="p">)</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="k">class</span><span class="w"> </span><span class="nc">StreamlitPageMonitor</span><span class="p">:</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="sd">    Singleton class to monitor and record errors and exceptions occurring in Streamlit pages.</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="sd">    This class monkey-patches `st.error` to capture error messages and provides decorators and methods</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="sd">    to track exceptions and errors per Streamlit page. Errors are stored in a class-level dictionary</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="sd">    and can be retrieved or cleared as needed.</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a><span class="sd">    Attributes:</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="sd">        _instance (StreamlitPageMonitor): Singleton instance of the monitor.</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="sd">        _errors (Dict[str, List[Dict[str, Any]]]): Dictionary mapping page names to lists of error records.</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="sd">        _st_error (Callable): Original `st.error` function before monkey-patching.</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a><span class="sd">        _current_page (str): Name of the current page being monitored.</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="sd">    Methods:</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a><span class="sd">        __new__(cls):</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a><span class="sd">            Ensures singleton behavior and monkey-patches `st.error` to record error messages.</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="sd">        _handle_st_error(cls, error_message: str):</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a><span class="sd">            Handles calls to `st.error` and records error information for the current page.</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a><span class="sd">        set_page_context(cls, page_name: str):</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a><span class="sd">            Sets the current page context for error recording.</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a><span class="sd">        monitor_page(cls, page_name: str):</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a><span class="sd">            Decorator to monitor a Streamlit page for exceptions and `st.error` calls.</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a><span class="sd">            Records exceptions and errors under the specified page name.</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a><span class="sd">        get_page_errors(cls):</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a><span class="sd">            Retrieves all recorded errors for all pages, grouped by page name.</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a><span class="sd">        clear_errors(cls, page_name: Optional[str] = None):</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a><span class="sd">            Clears recorded errors for a specific page or all pages.</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a>    
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a>    <span class="n">_instance</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a>    <span class="n">_errors</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a>    <span class="n">_st_error</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">error</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>    <span class="n">_current_page</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a>        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a>            <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">StreamlitPageMonitor</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a>            
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a>            <span class="c1"># Monkey patch st.error to capture error messages</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">patched_error</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a>                <span class="n">error_message</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">)</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a>                <span class="n">current_page</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_current_page</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a>                
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a>                <span class="n">error_info</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a>                    <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="n">error_message</span><span class="p">,</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a>                    <span class="s1">&#39;traceback&#39;</span><span class="p">:</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_stack</span><span class="p">(),</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a>                    <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a>                    <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;critical&#39;</span><span class="p">,</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a>                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;streamlit_error&#39;</span><span class="p">,</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a>                    <span class="s1">&#39;page&#39;</span><span class="p">:</span> <span class="n">current_page</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a>                <span class="p">}</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a>                <span class="c1"># Ensure current_page is a string, not None</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a>                <span class="k">if</span> <span class="n">current_page</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a>                    <span class="n">current_page</span> <span class="o">=</span> <span class="s2">&quot;unknown_page&quot;</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a>                <span class="k">if</span> <span class="n">current_page</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">:</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a>                    <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">[</span><span class="n">current_page</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a>                
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a>                <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">[</span><span class="n">current_page</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_info</span><span class="p">)</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a>                
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a>                <span class="c1"># Call original st.error</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a>                <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_st_error</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a>                
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">patched_error</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_st_error</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a><span class="sd">        Handles Streamlit-specific errors by recording error details for the current page.</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a><span class="sd">        Args:</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a><span class="sd">            error_message (str): The error message to be logged.</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a><span class="sd">        Side Effects:</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a><span class="sd">            Updates the class-level _errors dictionary with error information for the current Streamlit page.</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a><span class="sd">        Error Information Stored:</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a><span class="sd">            - error: Formatted error message.</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a><span class="sd">            - traceback: Stack trace at the point of error.</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a><span class="sd">            - timestamp: Time when the error occurred (ISO format).</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a><span class="sd">            - status: Error severity (&#39;critical&#39;).</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a><span class="sd">            - type: Error type (&#39;streamlit_error&#39;).</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>        
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>        <span class="c1"># Get current page name from Streamlit context</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>        <span class="n">current_page</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="s1">&#39;_current_page&#39;</span><span class="p">,</span> <span class="s1">&#39;unknown_page&#39;</span><span class="p">)</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a>        
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>        <span class="n">error_info</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>            <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Streamlit Error: </span><span class="si">{</span><span class="n">error_message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>            <span class="s1">&#39;traceback&#39;</span><span class="p">:</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_stack</span><span class="p">(),</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>            <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;critical&#39;</span><span class="p">,</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a>            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;streamlit_error&#39;</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a>        <span class="p">}</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a>        <span class="c1"># Initialize list for page if not exists</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a>        <span class="k">if</span> <span class="n">current_page</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">:</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a>            <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">[</span><span class="n">current_page</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a>        <span class="c1"># Add new error</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a>        <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">[</span><span class="n">current_page</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_info</span><span class="p">)</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_page_context</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">page_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the current page context&quot;&quot;&quot;</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a>        <span class="bp">cls</span><span class="o">.</span><span class="n">_current_page</span> <span class="o">=</span> <span class="n">page_name</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">monitor_page</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">page_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a><span class="sd">        Decorator to monitor and log exceptions for a specific Streamlit page.</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a><span class="sd">        Args:</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a><span class="sd">            page_name (str): The name of the page to monitor.</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a><span class="sd">        Returns:</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a><span class="sd">            Callable: A decorator that wraps the target function, sets the page context,</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a><span class="sd">            clears previous non-Streamlit errors, and logs any exceptions that occur during execution.</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a><span class="sd">        The decorator performs the following actions:</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a><span class="sd">            - Sets the current page context using `cls.set_page_context`.</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a><span class="sd">            - Clears previous exception errors for the page, retaining only those marked as &#39;streamlit_error&#39;.</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a><span class="sd">            - Executes the wrapped function.</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a><span class="sd">            - If an exception occurs, logs detailed error information (error message, traceback, timestamp, status, type, and page)</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a><span class="sd">              to `cls._errors` under the given page name, then re-raises the exception.</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a>        
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a><span class="sd">            Decorator to manage page-specific error handling and context setting.</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a><span class="sd">            This decorator sets the current page context before executing the decorated function.</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a><span class="sd">            It clears previous exception errors for the page, retaining only Streamlit error calls.</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a><span class="sd">            If an exception occurs during function execution, it captures error details including</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a><span class="sd">            the error message, traceback, timestamp, status, type, and page name, and appends them</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a><span class="sd">            to the page&#39;s error log. The exception is then re-raised.</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a><span class="sd">            Args:</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a><span class="sd">                func (Callable): The function to be decorated.</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a><span class="sd">            Returns:</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a><span class="sd">                Callable: The wrapped function with error handling and context management.</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>            
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a>            <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a>                <span class="c1"># Set the current page context</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>                <span class="bp">cls</span><span class="o">.</span><span class="n">set_page_context</span><span class="p">(</span><span class="n">page_name</span><span class="p">)</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>                    <span class="c1"># Clear previous exception errors but keep st.error calls</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>                    <span class="k">if</span> <span class="n">page_name</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">:</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a>                        <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">[</span><span class="n">page_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>                            <span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">[</span><span class="n">page_name</span><span class="p">]</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>                            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;streamlit_error&#39;</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>                        <span class="p">]</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>                    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>                    <span class="k">return</span> <span class="n">result</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>                    <span class="n">error_info</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a>                        <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a>                        <span class="s1">&#39;traceback&#39;</span><span class="p">:</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">(),</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a>                        <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a>                        <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;critical&#39;</span><span class="p">,</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a>                        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;exception&#39;</span><span class="p">,</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>                        <span class="s1">&#39;page&#39;</span><span class="p">:</span> <span class="n">page_name</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a>                    <span class="p">}</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a>                    <span class="k">if</span> <span class="n">page_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">:</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>                        <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">[</span><span class="n">page_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>                    <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">[</span><span class="n">page_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_info</span><span class="p">)</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>                    <span class="k">raise</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>            <span class="k">return</span> <span class="n">wrapper</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>        <span class="k">return</span> <span class="n">decorator</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_page_errors</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a><span class="sd">        Collects and returns errors for each page that has recorded errors.</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a><span class="sd">        Iterates through the internal `_errors` dictionary, and for each page with errors,</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a><span class="sd">        constructs a list of error details including the error message, traceback, timestamp,</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a><span class="sd">        and error type.</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a><span class="sd">        Returns:</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a><span class="sd">            dict: A dictionary where keys are page names and values are lists of error details.</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a><span class="sd">                  Each error detail is a dictionary with the following keys:</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a><span class="sd">                      - &#39;error&#39; (str): The error message or &#39;Unknown error&#39; if not present.</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a><span class="sd">                      - &#39;traceback&#39; (list): The traceback information or empty list if not present.</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a><span class="sd">                      - &#39;timestamp&#39; (str): The timestamp of the error or empty string if not present.</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a><span class="sd">                      - &#39;type&#39; (str): The type of error or &#39;unknown&#39; if not present.</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a>        
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a>        <span class="k">for</span> <span class="n">page</span><span class="p">,</span> <span class="n">errors</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>            <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>  <span class="c1"># Only include pages with errors</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>                <span class="n">result</span><span class="p">[</span><span class="n">page</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>                    <span class="p">{</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a>                        <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="n">err</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown error&#39;</span><span class="p">),</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a>                        <span class="s1">&#39;traceback&#39;</span><span class="p">:</span> <span class="n">err</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;traceback&#39;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>                        <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">err</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>                        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">err</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span><span class="p">)</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a>                    <span class="p">}</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a>                    <span class="k">for</span> <span class="n">err</span> <span class="ow">in</span> <span class="n">errors</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>                <span class="p">]</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">clear_errors</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">page_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear errors for a specific page or all pages&quot;&quot;&quot;</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>        <span class="k">if</span> <span class="n">page_name</span><span class="p">:</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>            <span class="k">if</span> <span class="n">page_name</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">:</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a>                <span class="k">del</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">[</span><span class="n">page_name</span><span class="p">]</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>            <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a><span class="k">class</span><span class="w"> </span><span class="nc">HealthCheckService</span><span class="p">:</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a><span class="sd">    HealthCheckService provides a comprehensive health monitoring solution for Streamlit applications.</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a><span class="sd">    It periodically checks system resources, external dependencies, custom health checks, and Streamlit server/page status,</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a><span class="sd">    updating and reporting the overall health status.</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a><span class="sd">    Attributes:</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a><span class="sd">        logger (logging.Logger): Logger for health check events.</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a><span class="sd">        config_path (str): Path to the health check configuration file.</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a><span class="sd">        health_data (Dict[str, Any]): Stores the latest health check results.</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a><span class="sd">        config (Dict): Loaded health check configuration.</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a><span class="sd">        check_interval (int): Interval (in seconds) between health checks.</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a><span class="sd">        _running (bool): Indicates if the health check service is running.</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a><span class="sd">        _thread (threading.Thread): Background thread for periodic checks.</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a><span class="sd">        streamlit_url (str): URL of the Streamlit server.</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a><span class="sd">        streamlit_port (int): Port of the Streamlit server.</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a><span class="sd">    Methods:</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a><span class="sd">        __init__(config_path: str = &quot;health_check_config.json&quot;):</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a><span class="sd">            Initializes the HealthCheckService with configuration and default health data.</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a><span class="sd">        _load_config() -&gt; Dict:</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a><span class="sd">            Loads health check configuration from file or returns default configuration.</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a><span class="sd">        _get_default_config() -&gt; Dict:</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a><span class="sd">            Returns the default health check configuration.</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a><span class="sd">        start():</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a><span class="sd">            Starts the health check service in a background thread.</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a><span class="sd">        stop():</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a><span class="sd">            Stops the health check service.</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a><span class="sd">        _run_checks_periodically():</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a><span class="sd">            Runs health checks periodically based on the configured interval.</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a><span class="sd">        run_all_checks():</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a><span class="sd">            Executes all configured health checks and updates health data.</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a><span class="sd">        check_cpu():</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a><span class="sd">            Checks CPU usage and updates health data.</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a><span class="sd">        check_memory():</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a><span class="sd">            Checks memory usage and updates health data.</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a><span class="sd">        check_disk():</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a><span class="sd">            Checks disk usage and updates health data.</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a><span class="sd">        check_dependencies():</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a><span class="sd">            Checks external dependencies such as APIs and databases.</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a><span class="sd">        _check_api_endpoint(endpoint: Dict):</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a><span class="sd">            Checks if an API endpoint is accessible and updates health data.</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a><span class="sd">        _check_database(db_config: Dict):</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a><span class="sd">            Checks database connection (placeholder for actual implementation).</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a><span class="sd">        register_custom_check(name: str, check_func: Callable[[], Dict[str, Any]]):</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a><span class="sd">            Registers a custom health check function.</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a><span class="sd">        run_custom_checks():</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a><span class="sd">            Executes all registered custom health checks.</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a><span class="sd">        _update_overall_status():</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a><span class="sd">            Updates the overall health status based on individual checks.</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a><span class="sd">        get_health_data() -&gt; Dict:</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a><span class="sd">            Returns the latest health check data, excluding function references.</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a><span class="sd">        save_config():</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a><span class="sd">            Saves the current configuration to file.</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a><span class="sd">        check_streamlit_pages():</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a><span class="sd">            Checks for errors in Streamlit pages and updates health data.</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a><span class="sd">        check_streamlit_server() -&gt; Dict[str, Any]:</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a><span class="sd">            Checks if the Streamlit server is running and responding.</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;health_check_config.json&quot;</span><span class="p">):</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a><span class="sd">        Initializes the HealthCheckService instance.</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a><span class="sd">        Args:</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a><span class="sd">            config_path (str): Path to the health check configuration file. Defaults to &quot;health_check_config.json&quot;.</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a><span class="sd">        Attributes:</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a><span class="sd">            logger (logging.Logger): Logger for the HealthCheckService.</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a><span class="sd">            config_path (str): Path to the configuration file.</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a><span class="sd">            health_data (Dict[str, Any]): Dictionary storing health check data.</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a><span class="sd">            config (dict): Loaded configuration from the config file.</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a><span class="sd">            check_interval (int): Interval in seconds between health checks. Defaults to 60.</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a><span class="sd">            _running (bool): Indicates if the health check service is running.</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a><span class="sd">            _thread (threading.Thread or None): Thread running the health check loop.</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a><span class="sd">            streamlit_url (str): URL of the Streamlit service. Defaults to &quot;http://localhost&quot;.</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a><span class="sd">            streamlit_port (int): Port of the Streamlit service. Defaults to 8501.</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.HealthCheckService&quot;</span><span class="p">)</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Initializing HealthCheckService&quot;</span><span class="p">)</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config_path</span> <span class="o">=</span> <span class="n">config_path</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>            <span class="s2">&quot;last_updated&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>            <span class="s2">&quot;system&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>            <span class="s2">&quot;dependencies&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>            <span class="s2">&quot;custom_checks&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>            <span class="s2">&quot;overall_status&quot;</span><span class="p">:</span> <span class="s2">&quot;unknown&quot;</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>        <span class="p">}</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_config</span><span class="p">()</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">check_interval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;check_interval&quot;</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>  <span class="c1"># Default: 60 seconds</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_running</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">streamlit_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;streamlit_url&quot;</span><span class="p">,</span> <span class="s2">&quot;http://localhost&quot;</span><span class="p">)</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">streamlit_port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;streamlit_port&quot;</span><span class="p">,</span> <span class="mi">8501</span><span class="p">)</span>  <span class="c1"># Default: 8501</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_load_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Load health check configuration from file.&quot;&quot;&quot;</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">):</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>                    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>                <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading health check config: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_config</span><span class="p">()</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_config</span><span class="p">()</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>            
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_default_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return default health check configuration.&quot;&quot;&quot;</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>            <span class="s2">&quot;check_interval&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>            <span class="s2">&quot;streamlit_url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://localhost&quot;</span><span class="p">,</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>            <span class="s2">&quot;streamlit_port&quot;</span><span class="p">:</span> <span class="mi">8501</span><span class="p">,</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>            <span class="s2">&quot;system_checks&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>                <span class="s2">&quot;cpu&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>                <span class="s2">&quot;memory&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>                <span class="s2">&quot;disk&quot;</span><span class="p">:</span> <span class="kc">True</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>            <span class="p">},</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>            <span class="s2">&quot;dependencies&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>                <span class="s2">&quot;api_endpoints&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>                    <span class="c1"># Example API endpoint to check</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>                    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;example_api&quot;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://httpbin.org/get&quot;</span><span class="p">,</span> <span class="s2">&quot;timeout&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>                <span class="p">],</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>                <span class="s2">&quot;databases&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>                    <span class="c1"># Example database connection to check</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>                    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;main_db&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;postgres&quot;</span><span class="p">,</span> <span class="s2">&quot;connection_string&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">}</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a>                <span class="p">]</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>            <span class="p">},</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a>            <span class="s2">&quot;thresholds&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>                <span class="s2">&quot;cpu_warning&quot;</span><span class="p">:</span> <span class="mi">70</span><span class="p">,</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>                <span class="s2">&quot;cpu_critical&quot;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>                <span class="s2">&quot;memory_warning&quot;</span><span class="p">:</span> <span class="mi">70</span><span class="p">,</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>                <span class="s2">&quot;memory_critical&quot;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>                <span class="s2">&quot;disk_warning&quot;</span><span class="p">:</span> <span class="mi">70</span><span class="p">,</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>                <span class="s2">&quot;disk_critical&quot;</span><span class="p">:</span> <span class="mi">90</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>            <span class="p">}</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>        <span class="p">}</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>    
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Start the health check service in a background thread.&quot;&quot;&quot;</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running</span><span class="p">:</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>            <span class="k">return</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>            
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_running</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_run_checks_periodically</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>        
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stop the health check service.&quot;&quot;&quot;</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_running</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="p">:</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>            
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_run_checks_periodically</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Run health checks periodically based on check interval.&quot;&quot;&quot;</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running</span><span class="p">:</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">run_all_checks</span><span class="p">()</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">check_interval</span><span class="p">)</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>            
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run_all_checks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Run all configured health checks and update health data.&quot;&quot;&quot;</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>        <span class="c1"># Update timestamp</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;last_updated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>        
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>        <span class="c1"># Check Streamlit server</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;streamlit_server&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_streamlit_server</span><span class="p">()</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>        
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>        <span class="c1"># System checks</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;system_checks&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">check_cpu</span><span class="p">()</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;system_checks&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">check_memory</span><span class="p">()</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;system_checks&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;disk&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">check_disk</span><span class="p">()</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>            
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>        <span class="c1"># Rest of the existing checks...</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">check_dependencies</span><span class="p">()</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">run_custom_checks</span><span class="p">()</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">check_streamlit_pages</span><span class="p">()</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_update_overall_status</span><span class="p">()</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>        
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_cpu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a><span class="sd">        Checks the current CPU usage and updates the health status based on configured thresholds.</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a><span class="sd">        Measures the CPU usage percentage over a 1-second interval using psutil. Compares the result</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a><span class="sd">        against warning and critical thresholds defined in the configuration. Sets the status to</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a><span class="sd">        &#39;healthy&#39;, &#39;warning&#39;, or &#39;critical&#39; accordingly, and updates the health data dictionary.</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a><span class="sd">        Returns:</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a><span class="sd">            None</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>        
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>        <span class="n">cpu_percent</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">cpu_percent</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>        <span class="n">warning_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cpu_warning&quot;</span><span class="p">,</span> <span class="mi">70</span><span class="p">)</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>        <span class="n">critical_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cpu_critical&quot;</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>        
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>        <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;healthy&quot;</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>        <span class="k">if</span> <span class="n">cpu_percent</span> <span class="o">&gt;=</span> <span class="n">critical_threshold</span><span class="p">:</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;critical&quot;</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>        <span class="k">elif</span> <span class="n">cpu_percent</span> <span class="o">&gt;=</span> <span class="n">warning_threshold</span><span class="p">:</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;warning&quot;</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>            
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;system&quot;</span><span class="p">][</span><span class="s2">&quot;cpu&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>            <span class="s2">&quot;usage_percent&quot;</span><span class="p">:</span> <span class="n">cpu_percent</span><span class="p">,</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">status</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>        <span class="p">}</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a>        
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_memory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a><span class="sd">        Checks the system&#39;s memory usage and updates the health status accordingly.</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a><span class="sd">        Retrieves the current memory usage statistics using psutil, compares the usage percentage</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a><span class="sd">        against configured warning and critical thresholds, and sets the memory status to &#39;healthy&#39;,</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a><span class="sd">        &#39;warning&#39;, or &#39;critical&#39;. Updates the health_data dictionary with total memory, available memory,</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a><span class="sd">        usage percentage, and status.</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a><span class="sd">        Returns:</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a><span class="sd">            None</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>        
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>        <span class="n">memory</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>        <span class="n">memory_percent</span> <span class="o">=</span> <span class="n">memory</span><span class="o">.</span><span class="n">percent</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>        <span class="n">warning_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_warning&quot;</span><span class="p">,</span> <span class="mi">70</span><span class="p">)</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>        <span class="n">critical_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_critical&quot;</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>        
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>        <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;healthy&quot;</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>        <span class="k">if</span> <span class="n">memory_percent</span> <span class="o">&gt;=</span> <span class="n">critical_threshold</span><span class="p">:</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;critical&quot;</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>        <span class="k">elif</span> <span class="n">memory_percent</span> <span class="o">&gt;=</span> <span class="n">warning_threshold</span><span class="p">:</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;warning&quot;</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>            
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;system&quot;</span><span class="p">][</span><span class="s2">&quot;memory&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>            <span class="s2">&quot;total_gb&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">memory</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>            <span class="s2">&quot;available_gb&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">memory</span><span class="o">.</span><span class="n">available</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>            <span class="s2">&quot;usage_percent&quot;</span><span class="p">:</span> <span class="n">memory_percent</span><span class="p">,</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">status</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>        <span class="p">}</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>        
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a><span class="sd">        Checks the disk usage of the root filesystem and updates the health status.</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a><span class="sd">        Retrieves disk usage statistics using psutil, compares the usage percentage</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a><span class="sd">        against configured warning and critical thresholds, and sets the disk status</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a><span class="sd">        accordingly (&quot;healthy&quot;, &quot;warning&quot;, or &quot;critical&quot;). Updates the health_data</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a><span class="sd">        dictionary with total disk size, free space, usage percentage, and status.</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a><span class="sd">        Returns:</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a><span class="sd">            None</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>        
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>        <span class="n">disk</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">disk_usage</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>        <span class="n">disk_percent</span> <span class="o">=</span> <span class="n">disk</span><span class="o">.</span><span class="n">percent</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>        <span class="n">warning_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;disk_warning&quot;</span><span class="p">,</span> <span class="mi">70</span><span class="p">)</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>        <span class="n">critical_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;disk_critical&quot;</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>        
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>        <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;healthy&quot;</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>        <span class="k">if</span> <span class="n">disk_percent</span> <span class="o">&gt;=</span> <span class="n">critical_threshold</span><span class="p">:</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;critical&quot;</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>        <span class="k">elif</span> <span class="n">disk_percent</span> <span class="o">&gt;=</span> <span class="n">warning_threshold</span><span class="p">:</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;warning&quot;</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>            
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;system&quot;</span><span class="p">][</span><span class="s2">&quot;disk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>            <span class="s2">&quot;total_gb&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">disk</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>            <span class="s2">&quot;free_gb&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">disk</span><span class="o">.</span><span class="n">free</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>            <span class="s2">&quot;usage_percent&quot;</span><span class="p">:</span> <span class="n">disk_percent</span><span class="p">,</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">status</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>        <span class="p">}</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>        
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_dependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a><span class="sd">        Checks the health of configured dependencies, including API endpoints and databases.</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a><span class="sd">        Iterates through the list of API endpoints and databases specified in the configuration,</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a><span class="sd">        and performs health checks on each by invoking the corresponding internal methods.</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a><span class="sd">        Raises:</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a><span class="sd">            Exception: If any dependency check fails.</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>        
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>        <span class="c1"># Check API endpoints</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>        <span class="k">for</span> <span class="n">endpoint</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;dependencies&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api_endpoints&quot;</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_check_api_endpoint</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>            
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>        <span class="c1"># Check database connections</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>        <span class="k">for</span> <span class="n">db</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;dependencies&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;databases&quot;</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_check_database</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>            
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_api_endpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="n">Dict</span><span class="p">):</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a><span class="sd">        Check if an API endpoint is accessible.</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a><span class="sd">        </span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a><span class="sd">        Args:</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a><span class="sd">            endpoint: Dictionary with endpoint configuration</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>        <span class="n">name</span> <span class="o">=</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown_api&quot;</span><span class="p">)</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>        <span class="n">timeout</span> <span class="o">=</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timeout&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>        
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">url</span><span class="p">:</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>            <span class="k">return</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>            
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>            <span class="n">response_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>            
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;healthy&quot;</span> <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&lt;</span> <span class="mi">400</span> <span class="k">else</span> <span class="s2">&quot;critical&quot;</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>            
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;dependencies&quot;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;api&quot;</span><span class="p">,</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">status</span><span class="p">,</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>                <span class="s2">&quot;response_time_ms&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">response_time</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>                <span class="s2">&quot;status_code&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>            <span class="p">}</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;dependencies&quot;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;api&quot;</span><span class="p">,</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;critical&quot;</span><span class="p">,</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>            <span class="p">}</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>            
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">):</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a><span class="sd">        Check database connection.</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a><span class="sd">        Note: This is a placeholder. You&#39;ll need to implement specific database checks</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a><span class="sd">        based on your application&#39;s needs.</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a><span class="sd">        </span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a><span class="sd">        Args:</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a><span class="sd">            db_config: Dictionary with database configuration</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a>        <span class="n">name</span> <span class="o">=</span> <span class="n">db_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown_db&quot;</span><span class="p">)</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>        <span class="n">db_type</span> <span class="o">=</span> <span class="n">db_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a>        
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>        <span class="c1"># Placeholder for database connection check</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>        <span class="c1"># In a real implementation, you would check the specific database connection</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;dependencies&quot;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;database&quot;</span><span class="p">,</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>            <span class="s2">&quot;db_type&quot;</span><span class="p">:</span> <span class="n">db_type</span><span class="p">,</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;unknown&quot;</span><span class="p">,</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Database check not implemented&quot;</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>        <span class="p">}</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>        
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">register_custom_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">check_func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]):</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a><span class="sd">        Register a custom health check function.</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a><span class="sd">        </span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a><span class="sd">        Args:</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a><span class="sd">            name: Name of the custom check</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a><span class="sd">            check_func: Function that performs the check and returns a dictionary with results</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>        <span class="k">if</span> <span class="s2">&quot;custom_checks&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">:</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;custom_checks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>            
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;custom_checks&quot;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;unknown&quot;</span><span class="p">,</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>            <span class="s2">&quot;check_func&quot;</span><span class="p">:</span> <span class="n">check_func</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>        <span class="p">}</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>        
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run_custom_checks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Run all registered custom health checks.&quot;&quot;&quot;</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>        <span class="k">if</span> <span class="s2">&quot;custom_checks&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">:</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>            <span class="k">return</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>            
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">check_info</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;custom_checks&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>            <span class="k">if</span> <span class="s2">&quot;check_func&quot;</span> <span class="ow">in</span> <span class="n">check_info</span> <span class="ow">and</span> <span class="nb">callable</span><span class="p">(</span><span class="n">check_info</span><span class="p">[</span><span class="s2">&quot;check_func&quot;</span><span class="p">]):</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>                    <span class="n">result</span> <span class="o">=</span> <span class="n">check_info</span><span class="p">[</span><span class="s2">&quot;check_func&quot;</span><span class="p">]()</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>                    <span class="c1"># Remove the function reference from the result</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>                    <span class="n">func</span> <span class="o">=</span> <span class="n">check_info</span><span class="p">[</span><span class="s2">&quot;check_func&quot;</span><span class="p">]</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;custom_checks&quot;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>                    <span class="c1"># Add the function back</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;custom_checks&quot;</span><span class="p">][</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;check_func&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;custom_checks&quot;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>                        <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;critical&quot;</span><span class="p">,</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>                        <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>                        <span class="s2">&quot;check_func&quot;</span><span class="p">:</span> <span class="n">check_info</span><span class="p">[</span><span class="s2">&quot;check_func&quot;</span><span class="p">]</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>                    <span class="p">}</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>                    
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_update_overall_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a><span class="sd">        Updates the overall health status of the application based on the statuses of various components.</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a><span class="sd">        The method checks the health status of the following components:</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a><span class="sd">            - Streamlit server</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a><span class="sd">            - System checks</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a><span class="sd">            - Dependencies</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a><span class="sd">            - Custom checks (excluding those with a &#39;check_func&#39; key)</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a><span class="sd">            - Streamlit pages</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a><span class="sd">        The overall status is determined using the following priority order:</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a><span class="sd">            1. &quot;critical&quot; if any component is critical</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a><span class="sd">            2. &quot;warning&quot; if any component is warning and none are critical</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a><span class="sd">            3. &quot;unknown&quot; if any component is unknown and none are critical or warning, and no healthy components exist</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a><span class="sd">            4. &quot;healthy&quot; if any component is healthy and none are critical, warning, or unknown</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a><span class="sd">            5. &quot;unknown&quot; if no statuses are found</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a><span class="sd">        The result is stored in `self.health_data[&quot;overall_status&quot;]`.</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>        
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>        <span class="n">has_critical</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>        <span class="n">has_warning</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>        <span class="n">has_healthy</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>        <span class="n">has_unknown</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>        
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>        <span class="c1"># Helper function to check status</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">check_component_status</span><span class="p">(</span><span class="n">status</span><span class="p">):</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>            <span class="k">nonlocal</span> <span class="n">has_critical</span><span class="p">,</span> <span class="n">has_warning</span><span class="p">,</span> <span class="n">has_healthy</span><span class="p">,</span> <span class="n">has_unknown</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>            <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;critical&quot;</span><span class="p">:</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>                <span class="n">has_critical</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>            <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;warning&quot;</span><span class="p">:</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>                <span class="n">has_warning</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>            <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;healthy&quot;</span><span class="p">:</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>                <span class="n">has_healthy</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>            <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;unknown&quot;</span><span class="p">:</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>                <span class="n">has_unknown</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>        <span class="c1"># Check Streamlit server status</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>        <span class="n">server_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;streamlit_server&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>        <span class="n">check_component_status</span><span class="p">(</span><span class="n">server_status</span><span class="p">)</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>        
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>        <span class="c1"># Check system status</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>        <span class="k">for</span> <span class="n">system_check</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>            <span class="n">check_component_status</span><span class="p">(</span><span class="n">system_check</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">))</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>                    
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>        <span class="c1"># Check dependencies status</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>        <span class="k">for</span> <span class="n">dep_check</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dependencies&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>            <span class="n">check_component_status</span><span class="p">(</span><span class="n">dep_check</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">))</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>                    
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>        <span class="c1"># Check custom checks status</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>        <span class="k">for</span> <span class="n">custom_check</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_checks&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">custom_check</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;check_func&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">custom_check</span><span class="p">:</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>                <span class="n">check_component_status</span><span class="p">(</span><span class="n">custom_check</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">))</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>        
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>        <span class="c1"># Check Streamlit pages status</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>        <span class="n">pages_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;streamlit_pages&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>        <span class="n">check_component_status</span><span class="p">(</span><span class="n">pages_status</span><span class="p">)</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>                        
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>        <span class="c1"># Determine overall status with priority:</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>        <span class="c1"># critical &gt; warning &gt; unknown &gt; healthy</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>        <span class="k">if</span> <span class="n">has_critical</span><span class="p">:</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;overall_status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;critical&quot;</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>        <span class="k">elif</span> <span class="n">has_warning</span><span class="p">:</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;overall_status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;warning&quot;</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>        <span class="k">elif</span> <span class="n">has_unknown</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">has_healthy</span><span class="p">:</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;overall_status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>        <span class="k">elif</span> <span class="n">has_healthy</span><span class="p">:</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;overall_status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;healthy&quot;</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;overall_status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>                
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_health_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the latest health check data.&quot;&quot;&quot;</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>        <span class="c1"># Create a copy without the function references</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>        <span class="n">result</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;custom_checks&quot;</span><span class="p">:</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>                <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>                <span class="k">for</span> <span class="n">check_name</span><span class="p">,</span> <span class="n">check_data</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">check_data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>                        <span class="n">check_copy</span> <span class="o">=</span> <span class="n">check_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a>                        <span class="k">if</span> <span class="s2">&quot;check_func&quot;</span> <span class="ow">in</span> <span class="n">check_copy</span><span class="p">:</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a>                            <span class="k">del</span> <span class="n">check_copy</span><span class="p">[</span><span class="s2">&quot;check_func&quot;</span><span class="p">]</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>                        <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">check_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">check_copy</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>                <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>        
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a><span class="sd">        Saves the current health check configuration to a JSON file.</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a><span class="sd">        Attempts to write the configuration stored in `self.config` to the file specified by `self.config_path`.</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a><span class="sd">        Displays a success message in the Streamlit app upon successful save.</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a><span class="sd">        Handles and displays appropriate error messages for file not found, permission issues, JSON decoding errors, and other exceptions.</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a><span class="sd">        Raises:</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a><span class="sd">            FileNotFoundError: If the configuration file path does not exist.</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a><span class="sd">            PermissionError: If there are insufficient permissions to write to the file.</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a><span class="sd">            json.JSONDecodeError: If there is an error decoding the JSON data.</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a><span class="sd">            Exception: For any other exceptions encountered during the save process.</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>        
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>                <span class="n">st</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Health check config saved successfully to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Configuration file not found: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>        <span class="k">except</span> <span class="ne">PermissionError</span><span class="p">:</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Permission denied: Unable to write to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>        <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error decoding JSON in config file: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error saving health check config: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_streamlit_pages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a><span class="sd">        Checks for errors in Streamlit pages and updates the health data accordingly.</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a><span class="sd">        This method retrieves page errors using StreamlitPageMonitor.get_page_errors().</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a><span class="sd">        If errors are found, it sets the &#39;streamlit_pages&#39; status to &#39;critical&#39; and updates</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a><span class="sd">        the overall health status to &#39;critical&#39;. If no errors are found, it marks the</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a><span class="sd">        &#39;streamlit_pages&#39; status as &#39;healthy&#39;.</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a><span class="sd">        Updates:</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a><span class="sd">            self.health_data[&quot;streamlit_pages&quot;]: Dict containing status, error count, errors, and details.</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a><span class="sd">            self.health_data[&quot;overall_status&quot;]: Set to &#39;critical&#39; if errors are detected.</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a><span class="sd">        Returns:</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a><span class="sd">            None</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>        
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>        <span class="n">page_errors</span> <span class="o">=</span> <span class="n">StreamlitPageMonitor</span><span class="o">.</span><span class="n">get_page_errors</span><span class="p">()</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>        
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>        <span class="k">if</span> <span class="s2">&quot;streamlit_pages&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">:</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;streamlit_pages&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>        
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>        <span class="k">if</span> <span class="n">page_errors</span><span class="p">:</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;streamlit_pages&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;critical&quot;</span><span class="p">,</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>                <span class="s2">&quot;error_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">page_errors</span><span class="p">),</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>                <span class="s2">&quot;errors&quot;</span><span class="p">:</span> <span class="n">page_errors</span><span class="p">,</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>                <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="s2">&quot;Errors detected in Streamlit pages&quot;</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>            <span class="p">}</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>            <span class="c1"># This affects overall status</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;overall_status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;critical&quot;</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;streamlit_pages&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;healthy&quot;</span><span class="p">,</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>                <span class="s2">&quot;error_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>                <span class="s2">&quot;errors&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>                <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="s2">&quot;All pages functioning normally&quot;</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>            <span class="p">}</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>    
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_streamlit_server</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a><span class="sd">        Checks the health status of the Streamlit server by sending a GET request to the /healthz endpoint.</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a><span class="sd">        Returns:</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a><span class="sd">            Dict[str, Any]: A dictionary containing the health status, response code, latency in milliseconds,</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a><span class="sd">                            message, and the URL checked. If the server is healthy (HTTP 200), status is &quot;healthy&quot;.</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a><span class="sd">                            Otherwise, status is &quot;critical&quot; with error details.</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a><span class="sd">        Handles:</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a><span class="sd">            - Connection errors: Returns critical status with connection error details.</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a><span class="sd">            - Timeout errors: Returns critical status with timeout error details.</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a><span class="sd">            - Other exceptions: Returns critical status with unknown error details.</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a><span class="sd">        Logs:</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a><span class="sd">            - The URL being checked.</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a><span class="sd">            - The response status code and text.</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a><span class="sd">            - Health status and response time if healthy.</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a><span class="sd">            - Warnings and errors for unhealthy or failed checks.</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>        
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>            <span class="n">host</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">streamlit_url</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">host</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;http://&#39;</span><span class="p">,</span> <span class="s1">&#39;https://&#39;</span><span class="p">)):</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>                <span class="n">host</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;http://</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>            
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">streamlit_port</span><span class="si">}</span><span class="s2">/healthz&quot;</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Checking Streamlit server health at: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>            
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>            <span class="n">total_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>            <span class="c1"># Check if the response is healthy</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Streamlit server healthy - Response time: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">total_time</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">ms&quot;</span><span class="p">)</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>                <span class="k">return</span> <span class="p">{</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>                    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;healthy&quot;</span><span class="p">,</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>                    <span class="s2">&quot;response_code&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>                    <span class="s2">&quot;latency_ms&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">total_time</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>                    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Streamlit server is running&quot;</span><span class="p">,</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>                    <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>                <span class="p">}</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unhealthy response from server: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>                <span class="k">return</span> <span class="p">{</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>                    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;critical&quot;</span><span class="p">,</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>                    <span class="s2">&quot;response_code&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>                    <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Unhealthy response from server: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>                    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Streamlit server is not healthy&quot;</span><span class="p">,</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>                    <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>                <span class="p">}</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection error while checking Streamlit server: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;critical&quot;</span><span class="p">,</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Connection error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Cannot connect to Streamlit server&quot;</span><span class="p">,</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>            <span class="p">}</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">Timeout</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timeout while checking Streamlit server: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;critical&quot;</span><span class="p">,</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Timeout error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Streamlit server is not responding&quot;</span><span class="p">,</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>            <span class="p">}</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected error while checking Streamlit server: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;critical&quot;</span><span class="p">,</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Unknown error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Failed to check Streamlit server&quot;</span><span class="p">,</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>            <span class="p">}</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>    
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a><span class="k">def</span><span class="w"> </span><span class="nf">health_check</span><span class="p">(</span><span class="n">config_path</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;health_check_config.json&quot;</span><span class="p">):</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a><span class="sd">    Displays an interactive Streamlit dashboard for monitoring application health.</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a><span class="sd">    This function initializes and manages a health check service, presenting real-time system metrics,</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a><span class="sd">    dependency statuses, custom checks, and Streamlit page health in a user-friendly dashboard.</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a><span class="sd">    Users can manually refresh health checks, view detailed error information, and adjust configuration</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a><span class="sd">    thresholds and intervals directly from the UI.</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a><span class="sd">    Args:</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a><span class="sd">        config_path (str, optional): Path to the health check configuration JSON file.</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a><span class="sd">            Defaults to &quot;health_check_config.json&quot;.</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a><span class="sd">    Features:</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a><span class="sd">        - Displays overall health status with color-coded indicators.</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a><span class="sd">        - Shows last updated timestamp for health data.</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a><span class="sd">        - Monitors Streamlit server status, latency, and errors.</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a><span class="sd">        - Provides tabs for:</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a><span class="sd">            * System Resources (CPU, Memory, Disk usage and status)</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a><span class="sd">            * Dependencies (external services and their health)</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a><span class="sd">            * Custom Checks (user-defined health checks)</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a><span class="sd">            * Streamlit Pages (page-specific errors and status)</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a><span class="sd">        - Allows configuration of system thresholds, check intervals, and Streamlit server settings.</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a><span class="sd">        - Supports manual refresh and saving configuration changes.</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a><span class="sd">    Raises:</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a><span class="sd">        Displays error messages in the UI for any exceptions encountered during health data retrieval or processing.</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a><span class="sd">    Returns:</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a><span class="sd">        None. The dashboard is rendered in the Streamlit app.</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a>    
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.health_check&quot;</span><span class="p">)</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting health check dashboard&quot;</span><span class="p">)</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>    <span class="n">st</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Application Health Dashboard&quot;</span><span class="p">)</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>    
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>    <span class="c1"># Initialize or get the health check service</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>    <span class="k">if</span> <span class="s2">&quot;health_service&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">:</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Initializing new health check service&quot;</span><span class="p">)</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">health_service</span> <span class="o">=</span> <span class="n">HealthCheckService</span><span class="p">(</span><span class="n">config_path</span> <span class="o">=</span> <span class="n">config_path</span><span class="p">)</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">health_service</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>    
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>    <span class="n">health_service</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">health_service</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>    
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>    <span class="c1"># Add controls for manual refresh and configuration</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>    <span class="n">col1</span><span class="p">,</span> <span class="n">col2</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">columns</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>    <span class="k">with</span> <span class="n">col1</span><span class="p">:</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">subheader</span><span class="p">(</span><span class="s2">&quot;System Health Status&quot;</span><span class="p">)</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>    <span class="k">with</span> <span class="n">col2</span><span class="p">:</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>        <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s2">&quot;Refresh Now&quot;</span><span class="p">):</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>            <span class="n">health_service</span><span class="o">.</span><span class="n">run_all_checks</span><span class="p">()</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>    
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>    <span class="c1"># Get the latest health data</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>    <span class="n">health_data</span> <span class="o">=</span> <span class="n">health_service</span><span class="o">.</span><span class="n">get_health_data</span><span class="p">()</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>    
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>    <span class="c1"># Display overall status with appropriate color</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>    <span class="n">overall_status</span> <span class="o">=</span> <span class="n">health_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;overall_status&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>    <span class="n">status_color</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>        <span class="s2">&quot;healthy&quot;</span><span class="p">:</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>        <span class="s2">&quot;warning&quot;</span><span class="p">:</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>        <span class="s2">&quot;critical&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>        <span class="s2">&quot;unknown&quot;</span><span class="p">:</span> <span class="s2">&quot;gray&quot;</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>    <span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">overall_status</span><span class="p">,</span> <span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>    
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>    <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>        <span class="sa">f</span><span class="s2">&quot;&lt;h3 style=&#39;color: </span><span class="si">{</span><span class="n">status_color</span><span class="si">}</span><span class="s2">;&#39;&gt;Overall Status: </span><span class="si">{</span><span class="n">overall_status</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&lt;/h3&gt;&quot;</span><span class="p">,</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>        <span class="n">unsafe_allow_html</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>    <span class="p">)</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>    
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>    <span class="c1"># Display last updated time</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>    <span class="k">if</span> <span class="n">health_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;last_updated&quot;</span><span class="p">):</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>            <span class="n">last_updated</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;last_updated&quot;</span><span class="p">])</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Last updated: </span><span class="si">{</span><span class="n">last_updated</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Last updated: </span><span class="si">{</span><span class="n">health_data</span><span class="p">[</span><span class="s1">&#39;last_updated&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>    
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>    <span class="n">server_health</span> <span class="o">=</span> <span class="n">health_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;streamlit_server&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>    <span class="n">server_status</span> <span class="o">=</span> <span class="n">server_health</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>    <span class="n">server_color</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>        <span class="s2">&quot;healthy&quot;</span><span class="p">:</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>        <span class="s2">&quot;critical&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>        <span class="s2">&quot;unknown&quot;</span><span class="p">:</span> <span class="s2">&quot;gray&quot;</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>    <span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">server_status</span><span class="p">,</span> <span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>    <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>        <span class="sa">f</span><span class="s2">&quot;### Streamlit Server Status: &lt;span style=&#39;color: </span><span class="si">{</span><span class="n">server_color</span><span class="si">}</span><span class="s2">&#39;&gt;</span><span class="si">{</span><span class="n">server_status</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&lt;/span&gt;&quot;</span><span class="p">,</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>        <span class="n">unsafe_allow_html</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>    <span class="p">)</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>    <span class="k">if</span> <span class="n">server_status</span> <span class="o">!=</span> <span class="s2">&quot;healthy&quot;</span><span class="p">:</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">server_health</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;Server status unknown&quot;</span><span class="p">))</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>        <span class="k">if</span> <span class="s2">&quot;error&quot;</span> <span class="ow">in</span> <span class="n">server_health</span><span class="p">:</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">code</span><span class="p">(</span><span class="n">server_health</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">])</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">server_health</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;Server is running&quot;</span><span class="p">))</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>        <span class="k">if</span> <span class="s2">&quot;latency_ms&quot;</span> <span class="ow">in</span> <span class="n">server_health</span><span class="p">:</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>            <span class="n">latency</span> <span class="o">=</span> <span class="n">server_health</span><span class="p">[</span><span class="s2">&quot;latency_ms&quot;</span><span class="p">]</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>            <span class="c1"># Define color based on latency thresholds</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>            <span class="k">if</span> <span class="n">latency</span> <span class="o">&lt;=</span> <span class="mi">50</span><span class="p">:</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>                <span class="n">latency_color</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>                <span class="n">performance</span> <span class="o">=</span> <span class="s2">&quot;Excellent&quot;</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>            <span class="k">elif</span> <span class="n">latency</span> <span class="o">&lt;=</span> <span class="mi">100</span><span class="p">:</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>                <span class="n">latency_color</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>                <span class="n">performance</span> <span class="o">=</span> <span class="s2">&quot;Good&quot;</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>            <span class="k">elif</span> <span class="n">latency</span> <span class="o">&lt;=</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>                <span class="n">latency_color</span> <span class="o">=</span> <span class="s2">&quot;orange&quot;</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>                <span class="n">performance</span> <span class="o">=</span> <span class="s2">&quot;Fair&quot;</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>                <span class="n">latency_color</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>                <span class="n">performance</span> <span class="o">=</span> <span class="s2">&quot;Poor&quot;</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>                
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a><span class="s2">                &lt;div style=&#39;display: flex; align-items: center; gap: 10px;&#39;&gt;</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a><span class="s2">                    &lt;div&gt;Server Response Time:&lt;/div&gt;</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a><span class="s2">                    &lt;div style=&#39;color: </span><span class="si">{</span><span class="n">latency_color</span><span class="si">}</span><span class="s2">; font-weight: bold;&#39;&gt;</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a><span class="s2">                        </span><span class="si">{</span><span class="n">latency</span><span class="si">}</span><span class="s2"> ms</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a><span class="s2">                    &lt;/div&gt;</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a><span class="s2">                    &lt;div style=&#39;color: </span><span class="si">{</span><span class="n">latency_color</span><span class="si">}</span><span class="s2">;&#39;&gt;</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a><span class="s2">                        (</span><span class="si">{</span><span class="n">performance</span><span class="si">}</span><span class="s2">)</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a><span class="s2">                    &lt;/div&gt;</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a><span class="s2">                &lt;/div&gt;</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a><span class="s2">                &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>                <span class="n">unsafe_allow_html</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>            <span class="p">)</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>    
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>    <span class="c1"># Create tabs for different categories of health checks</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>    <span class="n">tab1</span><span class="p">,</span> <span class="n">tab2</span><span class="p">,</span> <span class="n">tab3</span><span class="p">,</span> <span class="n">tab4</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">tabs</span><span class="p">([</span><span class="s2">&quot;System Resources&quot;</span><span class="p">,</span> <span class="s2">&quot;Dependencies&quot;</span><span class="p">,</span> <span class="s2">&quot;Custom Checks&quot;</span><span class="p">,</span> <span class="s2">&quot;Streamlit Pages&quot;</span><span class="p">])</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>    
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>    <span class="k">with</span> <span class="n">tab1</span><span class="p">:</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>        <span class="c1"># Display system health checks</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>        <span class="n">system_data</span> <span class="o">=</span> <span class="n">health_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>        
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>        <span class="c1"># CPU</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>        <span class="k">if</span> <span class="s2">&quot;cpu&quot;</span> <span class="ow">in</span> <span class="n">system_data</span><span class="p">:</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>            <span class="n">cpu_data</span> <span class="o">=</span> <span class="n">system_data</span><span class="p">[</span><span class="s2">&quot;cpu&quot;</span><span class="p">]</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>            <span class="n">cpu_status</span> <span class="o">=</span> <span class="n">cpu_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>            <span class="n">cpu_color</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;healthy&quot;</span><span class="p">:</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span><span class="p">:</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="s2">&quot;critical&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cpu_status</span><span class="p">,</span> <span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>            
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;### CPU Status: &lt;span style=&#39;color:</span><span class="si">{</span><span class="n">cpu_color</span><span class="si">}</span><span class="s2">&#39;&gt;</span><span class="si">{</span><span class="n">cpu_status</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&lt;/span&gt;&quot;</span><span class="p">,</span> <span class="n">unsafe_allow_html</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">progress</span><span class="p">(</span><span class="n">cpu_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;usage_percent&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CPU Usage: </span><span class="si">{</span><span class="n">cpu_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;usage_percent&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>        
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>        <span class="c1"># Memory</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>        <span class="k">if</span> <span class="s2">&quot;memory&quot;</span> <span class="ow">in</span> <span class="n">system_data</span><span class="p">:</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>            <span class="n">memory_data</span> <span class="o">=</span> <span class="n">system_data</span><span class="p">[</span><span class="s2">&quot;memory&quot;</span><span class="p">]</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>            <span class="n">memory_status</span> <span class="o">=</span> <span class="n">memory_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>            <span class="n">memory_color</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;healthy&quot;</span><span class="p">:</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span><span class="p">:</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="s2">&quot;critical&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">memory_status</span><span class="p">,</span> <span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>            
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;### Memory Status: &lt;span style=&#39;color:</span><span class="si">{</span><span class="n">memory_color</span><span class="si">}</span><span class="s2">&#39;&gt;</span><span class="si">{</span><span class="n">memory_status</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&lt;/span&gt;&quot;</span><span class="p">,</span> <span class="n">unsafe_allow_html</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">progress</span><span class="p">(</span><span class="n">memory_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;usage_percent&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Memory Usage: </span><span class="si">{</span><span class="n">memory_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;usage_percent&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total Memory: </span><span class="si">{</span><span class="n">memory_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;total_gb&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2"> GB&quot;</span><span class="p">)</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Available Memory: </span><span class="si">{</span><span class="n">memory_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;available_gb&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2"> GB&quot;</span><span class="p">)</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>        
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>        <span class="c1"># Disk</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>        <span class="k">if</span> <span class="s2">&quot;disk&quot;</span> <span class="ow">in</span> <span class="n">system_data</span><span class="p">:</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>            <span class="n">disk_data</span> <span class="o">=</span> <span class="n">system_data</span><span class="p">[</span><span class="s2">&quot;disk&quot;</span><span class="p">]</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>            <span class="n">disk_status</span> <span class="o">=</span> <span class="n">disk_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>            <span class="n">disk_color</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;healthy&quot;</span><span class="p">:</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span><span class="p">:</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="s2">&quot;critical&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">disk_status</span><span class="p">,</span> <span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>            
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;### Disk Status: &lt;span style=&#39;color:</span><span class="si">{</span><span class="n">disk_color</span><span class="si">}</span><span class="s2">&#39;&gt;</span><span class="si">{</span><span class="n">disk_status</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&lt;/span&gt;&quot;</span><span class="p">,</span> <span class="n">unsafe_allow_html</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">progress</span><span class="p">(</span><span class="n">disk_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;usage_percent&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Disk Usage: </span><span class="si">{</span><span class="n">disk_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;usage_percent&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total Disk Space: </span><span class="si">{</span><span class="n">disk_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;total_gb&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2"> GB&quot;</span><span class="p">)</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Free Disk Space: </span><span class="si">{</span><span class="n">disk_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;free_gb&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2"> GB&quot;</span><span class="p">)</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>    
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>    <span class="k">with</span> <span class="n">tab2</span><span class="p">:</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>        <span class="c1"># Display dependency health checks</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>        <span class="n">dependencies</span> <span class="o">=</span> <span class="n">health_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dependencies&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>        <span class="k">if</span> <span class="n">dependencies</span><span class="p">:</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>            <span class="c1"># Create a dataframe for all dependencies</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>            <span class="n">dep_data</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">dep_info</span> <span class="ow">in</span> <span class="n">dependencies</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>                <span class="n">dep_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>                    <span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>                    <span class="s2">&quot;Type&quot;</span><span class="p">:</span> <span class="n">dep_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">),</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>                    <span class="s2">&quot;Status&quot;</span><span class="p">:</span> <span class="n">dep_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">),</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>                    <span class="s2">&quot;Details&quot;</span><span class="p">:</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dep_info</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> 
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>                               <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)])</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>                <span class="p">})</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>            
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>            <span class="k">if</span> <span class="n">dep_data</span><span class="p">:</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dep_data</span><span class="p">)</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>                
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>                <span class="c1"># Apply color formatting to status column</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>                <span class="k">def</span><span class="w"> </span><span class="nf">color_status</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>                    <span class="n">colors</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>                        <span class="s2">&quot;healthy&quot;</span><span class="p">:</span> <span class="s2">&quot;background-color: #c6efce; color: #006100&quot;</span><span class="p">,</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>                        <span class="s2">&quot;warning&quot;</span><span class="p">:</span> <span class="s2">&quot;background-color: #ffeb9c; color: #9c5700&quot;</span><span class="p">,</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>                        <span class="s2">&quot;critical&quot;</span><span class="p">:</span> <span class="s2">&quot;background-color: #ffc7ce; color: #9c0006&quot;</span><span class="p">,</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>                        <span class="s2">&quot;unknown&quot;</span><span class="p">:</span> <span class="s2">&quot;background-color: #eeeeee; color: #7f7f7f&quot;</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>                    <span class="p">}</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>                    <span class="k">return</span> <span class="n">colors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>                
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>                <span class="n">st</span><span class="o">.</span><span class="n">dataframe</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">color_status</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Status&quot;</span><span class="p">]))</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>                <span class="n">st</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No dependencies configured&quot;</span><span class="p">)</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No dependencies configured&quot;</span><span class="p">)</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>    
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>    <span class="k">with</span> <span class="n">tab3</span><span class="p">:</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>        <span class="c1"># Display custom checks</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>        <span class="n">custom_checks</span> <span class="o">=</span> <span class="n">health_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_checks&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>        <span class="k">if</span> <span class="n">custom_checks</span><span class="p">:</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>            <span class="c1"># Create a dataframe for all custom checks</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>            <span class="n">check_data</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">check_info</span> <span class="ow">in</span> <span class="n">custom_checks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">check_info</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;check_func&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">check_info</span><span class="p">:</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>                    <span class="n">check_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>                        <span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>                        <span class="s2">&quot;Status&quot;</span><span class="p">:</span> <span class="n">check_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">),</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>                        <span class="s2">&quot;Details&quot;</span><span class="p">:</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">check_info</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> 
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a>                                  <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;check_func&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)]),</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>                        <span class="s2">&quot;Error&quot;</span><span class="p">:</span> <span class="n">check_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>                    <span class="p">})</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>            
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>            <span class="k">if</span> <span class="n">check_data</span><span class="p">:</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">check_data</span><span class="p">)</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a>                
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>                <span class="c1"># Apply color formatting to status column</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>                <span class="k">def</span><span class="w"> </span><span class="nf">color_status</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>                    <span class="n">colors</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>                        <span class="s2">&quot;healthy&quot;</span><span class="p">:</span> <span class="s2">&quot;background-color: #c6efce; color: #006100&quot;</span><span class="p">,</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a>                        <span class="s2">&quot;warning&quot;</span><span class="p">:</span> <span class="s2">&quot;background-color: #ffeb9c; color: #9c5700&quot;</span><span class="p">,</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>                        <span class="s2">&quot;critical&quot;</span><span class="p">:</span> <span class="s2">&quot;background-color: #ffc7ce; color: #9c0006&quot;</span><span class="p">,</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>                        <span class="s2">&quot;unknown&quot;</span><span class="p">:</span> <span class="s2">&quot;background-color: #eeeeee; color: #7f7f7f&quot;</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>                    <span class="p">}</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>                    <span class="k">return</span> <span class="n">colors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>                
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>                <span class="n">st</span><span class="o">.</span><span class="n">dataframe</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">color_status</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Status&quot;</span><span class="p">]))</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>                <span class="n">st</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No custom checks configured&quot;</span><span class="p">)</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No custom checks configured&quot;</span><span class="p">)</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>    <span class="k">with</span> <span class="n">tab4</span><span class="p">:</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>        <span class="n">page_health</span> <span class="o">=</span> <span class="n">health_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;streamlit_pages&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>        <span class="n">status</span> <span class="o">=</span> <span class="n">page_health</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>        <span class="n">error_count</span> <span class="o">=</span> <span class="n">page_health</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;error_count&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>        <span class="n">status_color</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>            <span class="s2">&quot;healthy&quot;</span><span class="p">:</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>            <span class="s2">&quot;critical&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>            <span class="s2">&quot;unknown&quot;</span><span class="p">:</span> <span class="s2">&quot;gray&quot;</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>        <span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>        
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;### Page Status: &lt;span style=&#39;color:</span><span class="si">{</span><span class="n">status_color</span><span class="si">}</span><span class="s2">&#39;&gt;</span><span class="si">{</span><span class="n">status</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&lt;/span&gt;&quot;</span><span class="p">,</span> <span class="n">unsafe_allow_html</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">metric</span><span class="p">(</span><span class="s2">&quot;Error Count&quot;</span><span class="p">,</span> <span class="n">error_count</span><span class="p">)</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>        <span class="k">if</span> <span class="n">error_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Pages with errors:&quot;</span><span class="p">)</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>            <span class="n">errors_dict</span> <span class="o">=</span> <span class="n">page_health</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;errors&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a>            
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">errors_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>                <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Invalid error data format&quot;</span><span class="p">)</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>                <span class="k">return</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>            
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>            <span class="k">for</span> <span class="n">page_name</span><span class="p">,</span> <span class="n">page_errors</span> <span class="ow">in</span> <span class="n">errors_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>                <span class="c1"># Create a meaningful page name for display</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>                <span class="n">display_name</span> <span class="o">=</span> <span class="n">page_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">page_name</span> <span class="k">else</span> <span class="n">page_name</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>                
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a>                <span class="k">for</span> <span class="n">error_info</span> <span class="ow">in</span> <span class="n">page_errors</span><span class="p">:</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">error_info</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>                        <span class="k">with</span> <span class="n">st</span><span class="o">.</span><span class="n">expander</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in </span><span class="si">{</span><span class="n">display_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a>                            <span class="c1"># Display error message without the &quot;Streamlit Error:&quot; prefix</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>                            <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown error&#39;</span><span class="p">))</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>                            
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a>                            <span class="c1"># Show additional error details</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>                            <span class="k">if</span> <span class="n">error_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;streamlit_error&#39;</span><span class="p">:</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>                                <span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;Type: Streamlit Error&quot;</span><span class="p">)</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>                                <span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;Type: Exception&quot;</span><span class="p">)</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>                                
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>                            <span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;Traceback:&quot;</span><span class="p">)</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a>                            <span class="n">st</span><span class="o">.</span><span class="n">code</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">error_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;traceback&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;No traceback available&#39;</span><span class="p">])))</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>                            <span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timestamp: </span><span class="si">{</span><span class="n">error_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;No timestamp&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>    
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>    <span class="c1"># Configuration section</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>    <span class="k">with</span> <span class="n">st</span><span class="o">.</span><span class="n">expander</span><span class="p">(</span><span class="s2">&quot;Health Check Configuration&quot;</span><span class="p">):</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">subheader</span><span class="p">(</span><span class="s2">&quot;System Check Thresholds&quot;</span><span class="p">)</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>        
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>        <span class="n">col1</span><span class="p">,</span> <span class="n">col2</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">columns</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>        <span class="k">with</span> <span class="n">col1</span><span class="p">:</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>            <span class="n">cpu_warning</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">slider</span><span class="p">(</span><span class="s2">&quot;CPU Warning Threshold (%)&quot;</span><span class="p">,</span> 
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>                                <span class="n">min_value</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> 
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>                                <span class="n">value</span><span class="o">=</span><span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cpu_warning&quot;</span><span class="p">,</span> <span class="mi">70</span><span class="p">),</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a>                                <span class="n">step</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>            <span class="n">memory_warning</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">slider</span><span class="p">(</span><span class="s2">&quot;Memory Warning Threshold (%)&quot;</span><span class="p">,</span> 
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a>                                   <span class="n">min_value</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> 
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a>                                   <span class="n">value</span><span class="o">=</span><span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_warning&quot;</span><span class="p">,</span> <span class="mi">70</span><span class="p">),</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a>                                   <span class="n">step</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a>            <span class="n">disk_warning</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">slider</span><span class="p">(</span><span class="s2">&quot;Disk Warning Threshold (%)&quot;</span><span class="p">,</span> 
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>                                 <span class="n">min_value</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> 
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a>                                 <span class="n">value</span><span class="o">=</span><span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;disk_warning&quot;</span><span class="p">,</span> <span class="mi">70</span><span class="p">),</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a>                                 <span class="n">step</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a>            <span class="n">streamlit_url_update</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">text_input</span><span class="p">(</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a>                <span class="s2">&quot;Streamlit Server URL&quot;</span><span class="p">,</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a>                <span class="n">value</span><span class="o">=</span><span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;streamlit_url&quot;</span><span class="p">,</span> <span class="s2">&quot;http://localhost&quot;</span><span class="p">)</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a>            <span class="p">)</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a>        
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a>        <span class="k">with</span> <span class="n">col2</span><span class="p">:</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a>            <span class="n">cpu_critical</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">slider</span><span class="p">(</span><span class="s2">&quot;CPU Critical Threshold (%)&quot;</span><span class="p">,</span> 
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a>                                 <span class="n">min_value</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">95</span><span class="p">,</span> 
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a>                                 <span class="n">value</span><span class="o">=</span><span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cpu_critical&quot;</span><span class="p">,</span> <span class="mi">90</span><span class="p">),</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a>                                 <span class="n">step</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a>            <span class="n">memory_critical</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">slider</span><span class="p">(</span><span class="s2">&quot;Memory Critical Threshold (%)&quot;</span><span class="p">,</span> 
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a>                                    <span class="n">min_value</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">95</span><span class="p">,</span> 
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a>                                    <span class="n">value</span><span class="o">=</span><span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_critical&quot;</span><span class="p">,</span> <span class="mi">90</span><span class="p">),</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a>                                    <span class="n">step</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a>            <span class="n">disk_critical</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">slider</span><span class="p">(</span><span class="s2">&quot;Disk Critical Threshold (%)&quot;</span><span class="p">,</span> 
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a>                                  <span class="n">min_value</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">95</span><span class="p">,</span> 
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a>                                  <span class="n">value</span><span class="o">=</span><span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;disk_critical&quot;</span><span class="p">,</span> <span class="mi">90</span><span class="p">),</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a>                                  <span class="n">step</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a>        
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a>            <span class="n">check_interval</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">slider</span><span class="p">(</span><span class="s2">&quot;Check Interval (seconds)&quot;</span><span class="p">,</span> 
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a>                                <span class="n">min_value</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> 
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a>                                <span class="n">value</span><span class="o">=</span><span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;check_interval&quot;</span><span class="p">,</span> <span class="mi">60</span><span class="p">),</span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a>                                <span class="n">step</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a>            <span class="n">streamlit_port_update</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a>                <span class="s2">&quot;Streamlit Server Port&quot;</span><span class="p">,</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a>                <span class="n">value</span><span class="o">=</span><span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;streamlit_port&quot;</span><span class="p">,</span> <span class="mi">8501</span><span class="p">),</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a>                <span class="n">step</span><span class="o">=</span><span class="mi">1</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a>            <span class="p">)</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a>        
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a>        <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s2">&quot;Save Configuration&quot;</span><span class="p">):</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a>            <span class="c1"># Update configuration</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a>            <span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">][</span><span class="s2">&quot;cpu_warning&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cpu_warning</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a>            <span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">][</span><span class="s2">&quot;cpu_critical&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cpu_critical</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a>            <span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">][</span><span class="s2">&quot;memory_warning&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">memory_warning</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a>            <span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">][</span><span class="s2">&quot;memory_critical&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">memory_critical</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a>            <span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">][</span><span class="s2">&quot;disk_warning&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">disk_warning</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a>            <span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">][</span><span class="s2">&quot;disk_critical&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">disk_critical</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a>            <span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;check_interval&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">check_interval</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a>            <span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;streamlit_url&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">streamlit_url_update</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a>            <span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;streamlit_port&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">streamlit_port_update</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a>            
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a>            <span class="c1"># Save to file</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a>            <span class="n">health_service</span><span class="o">.</span><span class="n">save_config</span><span class="p">()</span>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="s2">&quot;Configuration saved successfully&quot;</span><span class="p">)</span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a>            
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a>            <span class="c1"># Restart the service if interval changed</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a>            <span class="n">health_service</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a>            <span class="n">health_service</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></pre></div>


            </section>
                <section id="logger">
                    <div class="attr variable">
            <span class="name">logger</span>        =
<span class="default_value">&lt;Logger <a href="">streamlit_healthcheck.healthcheck</a> (INFO)&gt;</span>

        
    </div>
    <a class="headerlink" href="#logger"></a>
    
    

                </section>
                <section id="StreamlitPageMonitor">
                            <input id="StreamlitPageMonitor-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">StreamlitPageMonitor</span>:

                <label class="view-source-button" for="StreamlitPageMonitor-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StreamlitPageMonitor"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StreamlitPageMonitor-28"><a href="#StreamlitPageMonitor-28"><span class="linenos"> 28</span></a><span class="k">class</span><span class="w"> </span><span class="nc">StreamlitPageMonitor</span><span class="p">:</span>
</span><span id="StreamlitPageMonitor-29"><a href="#StreamlitPageMonitor-29"><span class="linenos"> 29</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="StreamlitPageMonitor-30"><a href="#StreamlitPageMonitor-30"><span class="linenos"> 30</span></a><span class="sd">    Singleton class to monitor and record errors and exceptions occurring in Streamlit pages.</span>
</span><span id="StreamlitPageMonitor-31"><a href="#StreamlitPageMonitor-31"><span class="linenos"> 31</span></a><span class="sd">    This class monkey-patches `st.error` to capture error messages and provides decorators and methods</span>
</span><span id="StreamlitPageMonitor-32"><a href="#StreamlitPageMonitor-32"><span class="linenos"> 32</span></a><span class="sd">    to track exceptions and errors per Streamlit page. Errors are stored in a class-level dictionary</span>
</span><span id="StreamlitPageMonitor-33"><a href="#StreamlitPageMonitor-33"><span class="linenos"> 33</span></a><span class="sd">    and can be retrieved or cleared as needed.</span>
</span><span id="StreamlitPageMonitor-34"><a href="#StreamlitPageMonitor-34"><span class="linenos"> 34</span></a><span class="sd">    Attributes:</span>
</span><span id="StreamlitPageMonitor-35"><a href="#StreamlitPageMonitor-35"><span class="linenos"> 35</span></a><span class="sd">        _instance (StreamlitPageMonitor): Singleton instance of the monitor.</span>
</span><span id="StreamlitPageMonitor-36"><a href="#StreamlitPageMonitor-36"><span class="linenos"> 36</span></a><span class="sd">        _errors (Dict[str, List[Dict[str, Any]]]): Dictionary mapping page names to lists of error records.</span>
</span><span id="StreamlitPageMonitor-37"><a href="#StreamlitPageMonitor-37"><span class="linenos"> 37</span></a><span class="sd">        _st_error (Callable): Original `st.error` function before monkey-patching.</span>
</span><span id="StreamlitPageMonitor-38"><a href="#StreamlitPageMonitor-38"><span class="linenos"> 38</span></a><span class="sd">        _current_page (str): Name of the current page being monitored.</span>
</span><span id="StreamlitPageMonitor-39"><a href="#StreamlitPageMonitor-39"><span class="linenos"> 39</span></a><span class="sd">    Methods:</span>
</span><span id="StreamlitPageMonitor-40"><a href="#StreamlitPageMonitor-40"><span class="linenos"> 40</span></a><span class="sd">        __new__(cls):</span>
</span><span id="StreamlitPageMonitor-41"><a href="#StreamlitPageMonitor-41"><span class="linenos"> 41</span></a><span class="sd">            Ensures singleton behavior and monkey-patches `st.error` to record error messages.</span>
</span><span id="StreamlitPageMonitor-42"><a href="#StreamlitPageMonitor-42"><span class="linenos"> 42</span></a><span class="sd">        _handle_st_error(cls, error_message: str):</span>
</span><span id="StreamlitPageMonitor-43"><a href="#StreamlitPageMonitor-43"><span class="linenos"> 43</span></a><span class="sd">            Handles calls to `st.error` and records error information for the current page.</span>
</span><span id="StreamlitPageMonitor-44"><a href="#StreamlitPageMonitor-44"><span class="linenos"> 44</span></a><span class="sd">        set_page_context(cls, page_name: str):</span>
</span><span id="StreamlitPageMonitor-45"><a href="#StreamlitPageMonitor-45"><span class="linenos"> 45</span></a><span class="sd">            Sets the current page context for error recording.</span>
</span><span id="StreamlitPageMonitor-46"><a href="#StreamlitPageMonitor-46"><span class="linenos"> 46</span></a><span class="sd">        monitor_page(cls, page_name: str):</span>
</span><span id="StreamlitPageMonitor-47"><a href="#StreamlitPageMonitor-47"><span class="linenos"> 47</span></a><span class="sd">            Decorator to monitor a Streamlit page for exceptions and `st.error` calls.</span>
</span><span id="StreamlitPageMonitor-48"><a href="#StreamlitPageMonitor-48"><span class="linenos"> 48</span></a><span class="sd">            Records exceptions and errors under the specified page name.</span>
</span><span id="StreamlitPageMonitor-49"><a href="#StreamlitPageMonitor-49"><span class="linenos"> 49</span></a><span class="sd">        get_page_errors(cls):</span>
</span><span id="StreamlitPageMonitor-50"><a href="#StreamlitPageMonitor-50"><span class="linenos"> 50</span></a><span class="sd">            Retrieves all recorded errors for all pages, grouped by page name.</span>
</span><span id="StreamlitPageMonitor-51"><a href="#StreamlitPageMonitor-51"><span class="linenos"> 51</span></a><span class="sd">        clear_errors(cls, page_name: Optional[str] = None):</span>
</span><span id="StreamlitPageMonitor-52"><a href="#StreamlitPageMonitor-52"><span class="linenos"> 52</span></a><span class="sd">            Clears recorded errors for a specific page or all pages.</span>
</span><span id="StreamlitPageMonitor-53"><a href="#StreamlitPageMonitor-53"><span class="linenos"> 53</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="StreamlitPageMonitor-54"><a href="#StreamlitPageMonitor-54"><span class="linenos"> 54</span></a>    
</span><span id="StreamlitPageMonitor-55"><a href="#StreamlitPageMonitor-55"><span class="linenos"> 55</span></a>    <span class="n">_instance</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="StreamlitPageMonitor-56"><a href="#StreamlitPageMonitor-56"><span class="linenos"> 56</span></a>    <span class="n">_errors</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="StreamlitPageMonitor-57"><a href="#StreamlitPageMonitor-57"><span class="linenos"> 57</span></a>    <span class="n">_st_error</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">error</span>
</span><span id="StreamlitPageMonitor-58"><a href="#StreamlitPageMonitor-58"><span class="linenos"> 58</span></a>    <span class="n">_current_page</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="StreamlitPageMonitor-59"><a href="#StreamlitPageMonitor-59"><span class="linenos"> 59</span></a>
</span><span id="StreamlitPageMonitor-60"><a href="#StreamlitPageMonitor-60"><span class="linenos"> 60</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
</span><span id="StreamlitPageMonitor-61"><a href="#StreamlitPageMonitor-61"><span class="linenos"> 61</span></a>        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StreamlitPageMonitor-62"><a href="#StreamlitPageMonitor-62"><span class="linenos"> 62</span></a>            <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">StreamlitPageMonitor</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span id="StreamlitPageMonitor-63"><a href="#StreamlitPageMonitor-63"><span class="linenos"> 63</span></a>            
</span><span id="StreamlitPageMonitor-64"><a href="#StreamlitPageMonitor-64"><span class="linenos"> 64</span></a>            <span class="c1"># Monkey patch st.error to capture error messages</span>
</span><span id="StreamlitPageMonitor-65"><a href="#StreamlitPageMonitor-65"><span class="linenos"> 65</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">patched_error</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="StreamlitPageMonitor-66"><a href="#StreamlitPageMonitor-66"><span class="linenos"> 66</span></a>                <span class="n">error_message</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">)</span>
</span><span id="StreamlitPageMonitor-67"><a href="#StreamlitPageMonitor-67"><span class="linenos"> 67</span></a>                <span class="n">current_page</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_current_page</span>
</span><span id="StreamlitPageMonitor-68"><a href="#StreamlitPageMonitor-68"><span class="linenos"> 68</span></a>                
</span><span id="StreamlitPageMonitor-69"><a href="#StreamlitPageMonitor-69"><span class="linenos"> 69</span></a>                <span class="n">error_info</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="StreamlitPageMonitor-70"><a href="#StreamlitPageMonitor-70"><span class="linenos"> 70</span></a>                    <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="n">error_message</span><span class="p">,</span>
</span><span id="StreamlitPageMonitor-71"><a href="#StreamlitPageMonitor-71"><span class="linenos"> 71</span></a>                    <span class="s1">&#39;traceback&#39;</span><span class="p">:</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_stack</span><span class="p">(),</span>
</span><span id="StreamlitPageMonitor-72"><a href="#StreamlitPageMonitor-72"><span class="linenos"> 72</span></a>                    <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="StreamlitPageMonitor-73"><a href="#StreamlitPageMonitor-73"><span class="linenos"> 73</span></a>                    <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;critical&#39;</span><span class="p">,</span>
</span><span id="StreamlitPageMonitor-74"><a href="#StreamlitPageMonitor-74"><span class="linenos"> 74</span></a>                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;streamlit_error&#39;</span><span class="p">,</span>
</span><span id="StreamlitPageMonitor-75"><a href="#StreamlitPageMonitor-75"><span class="linenos"> 75</span></a>                    <span class="s1">&#39;page&#39;</span><span class="p">:</span> <span class="n">current_page</span>
</span><span id="StreamlitPageMonitor-76"><a href="#StreamlitPageMonitor-76"><span class="linenos"> 76</span></a>                <span class="p">}</span>
</span><span id="StreamlitPageMonitor-77"><a href="#StreamlitPageMonitor-77"><span class="linenos"> 77</span></a>
</span><span id="StreamlitPageMonitor-78"><a href="#StreamlitPageMonitor-78"><span class="linenos"> 78</span></a>                <span class="c1"># Ensure current_page is a string, not None</span>
</span><span id="StreamlitPageMonitor-79"><a href="#StreamlitPageMonitor-79"><span class="linenos"> 79</span></a>                <span class="k">if</span> <span class="n">current_page</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StreamlitPageMonitor-80"><a href="#StreamlitPageMonitor-80"><span class="linenos"> 80</span></a>                    <span class="n">current_page</span> <span class="o">=</span> <span class="s2">&quot;unknown_page&quot;</span>
</span><span id="StreamlitPageMonitor-81"><a href="#StreamlitPageMonitor-81"><span class="linenos"> 81</span></a>                <span class="k">if</span> <span class="n">current_page</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">:</span>
</span><span id="StreamlitPageMonitor-82"><a href="#StreamlitPageMonitor-82"><span class="linenos"> 82</span></a>                    <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">[</span><span class="n">current_page</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="StreamlitPageMonitor-83"><a href="#StreamlitPageMonitor-83"><span class="linenos"> 83</span></a>                
</span><span id="StreamlitPageMonitor-84"><a href="#StreamlitPageMonitor-84"><span class="linenos"> 84</span></a>                <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">[</span><span class="n">current_page</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_info</span><span class="p">)</span>
</span><span id="StreamlitPageMonitor-85"><a href="#StreamlitPageMonitor-85"><span class="linenos"> 85</span></a>                
</span><span id="StreamlitPageMonitor-86"><a href="#StreamlitPageMonitor-86"><span class="linenos"> 86</span></a>                <span class="c1"># Call original st.error</span>
</span><span id="StreamlitPageMonitor-87"><a href="#StreamlitPageMonitor-87"><span class="linenos"> 87</span></a>                <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_st_error</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="StreamlitPageMonitor-88"><a href="#StreamlitPageMonitor-88"><span class="linenos"> 88</span></a>                
</span><span id="StreamlitPageMonitor-89"><a href="#StreamlitPageMonitor-89"><span class="linenos"> 89</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">patched_error</span>
</span><span id="StreamlitPageMonitor-90"><a href="#StreamlitPageMonitor-90"><span class="linenos"> 90</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span>
</span><span id="StreamlitPageMonitor-91"><a href="#StreamlitPageMonitor-91"><span class="linenos"> 91</span></a>
</span><span id="StreamlitPageMonitor-92"><a href="#StreamlitPageMonitor-92"><span class="linenos"> 92</span></a>    <span class="nd">@classmethod</span>
</span><span id="StreamlitPageMonitor-93"><a href="#StreamlitPageMonitor-93"><span class="linenos"> 93</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_st_error</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="StreamlitPageMonitor-94"><a href="#StreamlitPageMonitor-94"><span class="linenos"> 94</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="StreamlitPageMonitor-95"><a href="#StreamlitPageMonitor-95"><span class="linenos"> 95</span></a><span class="sd">        Handles Streamlit-specific errors by recording error details for the current page.</span>
</span><span id="StreamlitPageMonitor-96"><a href="#StreamlitPageMonitor-96"><span class="linenos"> 96</span></a><span class="sd">        Args:</span>
</span><span id="StreamlitPageMonitor-97"><a href="#StreamlitPageMonitor-97"><span class="linenos"> 97</span></a><span class="sd">            error_message (str): The error message to be logged.</span>
</span><span id="StreamlitPageMonitor-98"><a href="#StreamlitPageMonitor-98"><span class="linenos"> 98</span></a><span class="sd">        Side Effects:</span>
</span><span id="StreamlitPageMonitor-99"><a href="#StreamlitPageMonitor-99"><span class="linenos"> 99</span></a><span class="sd">            Updates the class-level _errors dictionary with error information for the current Streamlit page.</span>
</span><span id="StreamlitPageMonitor-100"><a href="#StreamlitPageMonitor-100"><span class="linenos">100</span></a><span class="sd">        Error Information Stored:</span>
</span><span id="StreamlitPageMonitor-101"><a href="#StreamlitPageMonitor-101"><span class="linenos">101</span></a><span class="sd">            - error: Formatted error message.</span>
</span><span id="StreamlitPageMonitor-102"><a href="#StreamlitPageMonitor-102"><span class="linenos">102</span></a><span class="sd">            - traceback: Stack trace at the point of error.</span>
</span><span id="StreamlitPageMonitor-103"><a href="#StreamlitPageMonitor-103"><span class="linenos">103</span></a><span class="sd">            - timestamp: Time when the error occurred (ISO format).</span>
</span><span id="StreamlitPageMonitor-104"><a href="#StreamlitPageMonitor-104"><span class="linenos">104</span></a><span class="sd">            - status: Error severity (&#39;critical&#39;).</span>
</span><span id="StreamlitPageMonitor-105"><a href="#StreamlitPageMonitor-105"><span class="linenos">105</span></a><span class="sd">            - type: Error type (&#39;streamlit_error&#39;).</span>
</span><span id="StreamlitPageMonitor-106"><a href="#StreamlitPageMonitor-106"><span class="linenos">106</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StreamlitPageMonitor-107"><a href="#StreamlitPageMonitor-107"><span class="linenos">107</span></a>        
</span><span id="StreamlitPageMonitor-108"><a href="#StreamlitPageMonitor-108"><span class="linenos">108</span></a>        <span class="c1"># Get current page name from Streamlit context</span>
</span><span id="StreamlitPageMonitor-109"><a href="#StreamlitPageMonitor-109"><span class="linenos">109</span></a>        <span class="n">current_page</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="s1">&#39;_current_page&#39;</span><span class="p">,</span> <span class="s1">&#39;unknown_page&#39;</span><span class="p">)</span>
</span><span id="StreamlitPageMonitor-110"><a href="#StreamlitPageMonitor-110"><span class="linenos">110</span></a>        
</span><span id="StreamlitPageMonitor-111"><a href="#StreamlitPageMonitor-111"><span class="linenos">111</span></a>        <span class="n">error_info</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="StreamlitPageMonitor-112"><a href="#StreamlitPageMonitor-112"><span class="linenos">112</span></a>            <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Streamlit Error: </span><span class="si">{</span><span class="n">error_message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="StreamlitPageMonitor-113"><a href="#StreamlitPageMonitor-113"><span class="linenos">113</span></a>            <span class="s1">&#39;traceback&#39;</span><span class="p">:</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_stack</span><span class="p">(),</span>
</span><span id="StreamlitPageMonitor-114"><a href="#StreamlitPageMonitor-114"><span class="linenos">114</span></a>            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="StreamlitPageMonitor-115"><a href="#StreamlitPageMonitor-115"><span class="linenos">115</span></a>            <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;critical&#39;</span><span class="p">,</span>
</span><span id="StreamlitPageMonitor-116"><a href="#StreamlitPageMonitor-116"><span class="linenos">116</span></a>            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;streamlit_error&#39;</span>
</span><span id="StreamlitPageMonitor-117"><a href="#StreamlitPageMonitor-117"><span class="linenos">117</span></a>        <span class="p">}</span>
</span><span id="StreamlitPageMonitor-118"><a href="#StreamlitPageMonitor-118"><span class="linenos">118</span></a>
</span><span id="StreamlitPageMonitor-119"><a href="#StreamlitPageMonitor-119"><span class="linenos">119</span></a>        <span class="c1"># Initialize list for page if not exists</span>
</span><span id="StreamlitPageMonitor-120"><a href="#StreamlitPageMonitor-120"><span class="linenos">120</span></a>        <span class="k">if</span> <span class="n">current_page</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">:</span>
</span><span id="StreamlitPageMonitor-121"><a href="#StreamlitPageMonitor-121"><span class="linenos">121</span></a>            <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">[</span><span class="n">current_page</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="StreamlitPageMonitor-122"><a href="#StreamlitPageMonitor-122"><span class="linenos">122</span></a>
</span><span id="StreamlitPageMonitor-123"><a href="#StreamlitPageMonitor-123"><span class="linenos">123</span></a>        <span class="c1"># Add new error</span>
</span><span id="StreamlitPageMonitor-124"><a href="#StreamlitPageMonitor-124"><span class="linenos">124</span></a>        <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">[</span><span class="n">current_page</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_info</span><span class="p">)</span>
</span><span id="StreamlitPageMonitor-125"><a href="#StreamlitPageMonitor-125"><span class="linenos">125</span></a>
</span><span id="StreamlitPageMonitor-126"><a href="#StreamlitPageMonitor-126"><span class="linenos">126</span></a>    <span class="nd">@classmethod</span>
</span><span id="StreamlitPageMonitor-127"><a href="#StreamlitPageMonitor-127"><span class="linenos">127</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_page_context</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">page_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="StreamlitPageMonitor-128"><a href="#StreamlitPageMonitor-128"><span class="linenos">128</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the current page context&quot;&quot;&quot;</span>
</span><span id="StreamlitPageMonitor-129"><a href="#StreamlitPageMonitor-129"><span class="linenos">129</span></a>        <span class="bp">cls</span><span class="o">.</span><span class="n">_current_page</span> <span class="o">=</span> <span class="n">page_name</span>
</span><span id="StreamlitPageMonitor-130"><a href="#StreamlitPageMonitor-130"><span class="linenos">130</span></a>
</span><span id="StreamlitPageMonitor-131"><a href="#StreamlitPageMonitor-131"><span class="linenos">131</span></a>    <span class="nd">@classmethod</span>
</span><span id="StreamlitPageMonitor-132"><a href="#StreamlitPageMonitor-132"><span class="linenos">132</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">monitor_page</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">page_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="StreamlitPageMonitor-133"><a href="#StreamlitPageMonitor-133"><span class="linenos">133</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="StreamlitPageMonitor-134"><a href="#StreamlitPageMonitor-134"><span class="linenos">134</span></a><span class="sd">        Decorator to monitor and log exceptions for a specific Streamlit page.</span>
</span><span id="StreamlitPageMonitor-135"><a href="#StreamlitPageMonitor-135"><span class="linenos">135</span></a><span class="sd">        Args:</span>
</span><span id="StreamlitPageMonitor-136"><a href="#StreamlitPageMonitor-136"><span class="linenos">136</span></a><span class="sd">            page_name (str): The name of the page to monitor.</span>
</span><span id="StreamlitPageMonitor-137"><a href="#StreamlitPageMonitor-137"><span class="linenos">137</span></a><span class="sd">        Returns:</span>
</span><span id="StreamlitPageMonitor-138"><a href="#StreamlitPageMonitor-138"><span class="linenos">138</span></a><span class="sd">            Callable: A decorator that wraps the target function, sets the page context,</span>
</span><span id="StreamlitPageMonitor-139"><a href="#StreamlitPageMonitor-139"><span class="linenos">139</span></a><span class="sd">            clears previous non-Streamlit errors, and logs any exceptions that occur during execution.</span>
</span><span id="StreamlitPageMonitor-140"><a href="#StreamlitPageMonitor-140"><span class="linenos">140</span></a><span class="sd">        The decorator performs the following actions:</span>
</span><span id="StreamlitPageMonitor-141"><a href="#StreamlitPageMonitor-141"><span class="linenos">141</span></a><span class="sd">            - Sets the current page context using `cls.set_page_context`.</span>
</span><span id="StreamlitPageMonitor-142"><a href="#StreamlitPageMonitor-142"><span class="linenos">142</span></a><span class="sd">            - Clears previous exception errors for the page, retaining only those marked as &#39;streamlit_error&#39;.</span>
</span><span id="StreamlitPageMonitor-143"><a href="#StreamlitPageMonitor-143"><span class="linenos">143</span></a><span class="sd">            - Executes the wrapped function.</span>
</span><span id="StreamlitPageMonitor-144"><a href="#StreamlitPageMonitor-144"><span class="linenos">144</span></a><span class="sd">            - If an exception occurs, logs detailed error information (error message, traceback, timestamp, status, type, and page)</span>
</span><span id="StreamlitPageMonitor-145"><a href="#StreamlitPageMonitor-145"><span class="linenos">145</span></a><span class="sd">              to `cls._errors` under the given page name, then re-raises the exception.</span>
</span><span id="StreamlitPageMonitor-146"><a href="#StreamlitPageMonitor-146"><span class="linenos">146</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StreamlitPageMonitor-147"><a href="#StreamlitPageMonitor-147"><span class="linenos">147</span></a>        
</span><span id="StreamlitPageMonitor-148"><a href="#StreamlitPageMonitor-148"><span class="linenos">148</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
</span><span id="StreamlitPageMonitor-149"><a href="#StreamlitPageMonitor-149"><span class="linenos">149</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="StreamlitPageMonitor-150"><a href="#StreamlitPageMonitor-150"><span class="linenos">150</span></a><span class="sd">            Decorator to manage page-specific error handling and context setting.</span>
</span><span id="StreamlitPageMonitor-151"><a href="#StreamlitPageMonitor-151"><span class="linenos">151</span></a><span class="sd">            This decorator sets the current page context before executing the decorated function.</span>
</span><span id="StreamlitPageMonitor-152"><a href="#StreamlitPageMonitor-152"><span class="linenos">152</span></a><span class="sd">            It clears previous exception errors for the page, retaining only Streamlit error calls.</span>
</span><span id="StreamlitPageMonitor-153"><a href="#StreamlitPageMonitor-153"><span class="linenos">153</span></a><span class="sd">            If an exception occurs during function execution, it captures error details including</span>
</span><span id="StreamlitPageMonitor-154"><a href="#StreamlitPageMonitor-154"><span class="linenos">154</span></a><span class="sd">            the error message, traceback, timestamp, status, type, and page name, and appends them</span>
</span><span id="StreamlitPageMonitor-155"><a href="#StreamlitPageMonitor-155"><span class="linenos">155</span></a><span class="sd">            to the page&#39;s error log. The exception is then re-raised.</span>
</span><span id="StreamlitPageMonitor-156"><a href="#StreamlitPageMonitor-156"><span class="linenos">156</span></a><span class="sd">            Args:</span>
</span><span id="StreamlitPageMonitor-157"><a href="#StreamlitPageMonitor-157"><span class="linenos">157</span></a><span class="sd">                func (Callable): The function to be decorated.</span>
</span><span id="StreamlitPageMonitor-158"><a href="#StreamlitPageMonitor-158"><span class="linenos">158</span></a><span class="sd">            Returns:</span>
</span><span id="StreamlitPageMonitor-159"><a href="#StreamlitPageMonitor-159"><span class="linenos">159</span></a><span class="sd">                Callable: The wrapped function with error handling and context management.</span>
</span><span id="StreamlitPageMonitor-160"><a href="#StreamlitPageMonitor-160"><span class="linenos">160</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="StreamlitPageMonitor-161"><a href="#StreamlitPageMonitor-161"><span class="linenos">161</span></a>            
</span><span id="StreamlitPageMonitor-162"><a href="#StreamlitPageMonitor-162"><span class="linenos">162</span></a>            <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</span><span id="StreamlitPageMonitor-163"><a href="#StreamlitPageMonitor-163"><span class="linenos">163</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="StreamlitPageMonitor-164"><a href="#StreamlitPageMonitor-164"><span class="linenos">164</span></a>                <span class="c1"># Set the current page context</span>
</span><span id="StreamlitPageMonitor-165"><a href="#StreamlitPageMonitor-165"><span class="linenos">165</span></a>                <span class="bp">cls</span><span class="o">.</span><span class="n">set_page_context</span><span class="p">(</span><span class="n">page_name</span><span class="p">)</span>
</span><span id="StreamlitPageMonitor-166"><a href="#StreamlitPageMonitor-166"><span class="linenos">166</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="StreamlitPageMonitor-167"><a href="#StreamlitPageMonitor-167"><span class="linenos">167</span></a>                    <span class="c1"># Clear previous exception errors but keep st.error calls</span>
</span><span id="StreamlitPageMonitor-168"><a href="#StreamlitPageMonitor-168"><span class="linenos">168</span></a>                    <span class="k">if</span> <span class="n">page_name</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">:</span>
</span><span id="StreamlitPageMonitor-169"><a href="#StreamlitPageMonitor-169"><span class="linenos">169</span></a>                        <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">[</span><span class="n">page_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="StreamlitPageMonitor-170"><a href="#StreamlitPageMonitor-170"><span class="linenos">170</span></a>                            <span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">[</span><span class="n">page_name</span><span class="p">]</span>
</span><span id="StreamlitPageMonitor-171"><a href="#StreamlitPageMonitor-171"><span class="linenos">171</span></a>                            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;streamlit_error&#39;</span>
</span><span id="StreamlitPageMonitor-172"><a href="#StreamlitPageMonitor-172"><span class="linenos">172</span></a>                        <span class="p">]</span>
</span><span id="StreamlitPageMonitor-173"><a href="#StreamlitPageMonitor-173"><span class="linenos">173</span></a>                    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="StreamlitPageMonitor-174"><a href="#StreamlitPageMonitor-174"><span class="linenos">174</span></a>                    <span class="k">return</span> <span class="n">result</span>
</span><span id="StreamlitPageMonitor-175"><a href="#StreamlitPageMonitor-175"><span class="linenos">175</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="StreamlitPageMonitor-176"><a href="#StreamlitPageMonitor-176"><span class="linenos">176</span></a>                    <span class="n">error_info</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="StreamlitPageMonitor-177"><a href="#StreamlitPageMonitor-177"><span class="linenos">177</span></a>                        <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="StreamlitPageMonitor-178"><a href="#StreamlitPageMonitor-178"><span class="linenos">178</span></a>                        <span class="s1">&#39;traceback&#39;</span><span class="p">:</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">(),</span>
</span><span id="StreamlitPageMonitor-179"><a href="#StreamlitPageMonitor-179"><span class="linenos">179</span></a>                        <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="StreamlitPageMonitor-180"><a href="#StreamlitPageMonitor-180"><span class="linenos">180</span></a>                        <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;critical&#39;</span><span class="p">,</span>
</span><span id="StreamlitPageMonitor-181"><a href="#StreamlitPageMonitor-181"><span class="linenos">181</span></a>                        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;exception&#39;</span><span class="p">,</span>
</span><span id="StreamlitPageMonitor-182"><a href="#StreamlitPageMonitor-182"><span class="linenos">182</span></a>                        <span class="s1">&#39;page&#39;</span><span class="p">:</span> <span class="n">page_name</span>
</span><span id="StreamlitPageMonitor-183"><a href="#StreamlitPageMonitor-183"><span class="linenos">183</span></a>                    <span class="p">}</span>
</span><span id="StreamlitPageMonitor-184"><a href="#StreamlitPageMonitor-184"><span class="linenos">184</span></a>                    <span class="k">if</span> <span class="n">page_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">:</span>
</span><span id="StreamlitPageMonitor-185"><a href="#StreamlitPageMonitor-185"><span class="linenos">185</span></a>                        <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">[</span><span class="n">page_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="StreamlitPageMonitor-186"><a href="#StreamlitPageMonitor-186"><span class="linenos">186</span></a>                    <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">[</span><span class="n">page_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_info</span><span class="p">)</span>
</span><span id="StreamlitPageMonitor-187"><a href="#StreamlitPageMonitor-187"><span class="linenos">187</span></a>                    <span class="k">raise</span>
</span><span id="StreamlitPageMonitor-188"><a href="#StreamlitPageMonitor-188"><span class="linenos">188</span></a>            <span class="k">return</span> <span class="n">wrapper</span>
</span><span id="StreamlitPageMonitor-189"><a href="#StreamlitPageMonitor-189"><span class="linenos">189</span></a>        <span class="k">return</span> <span class="n">decorator</span>
</span><span id="StreamlitPageMonitor-190"><a href="#StreamlitPageMonitor-190"><span class="linenos">190</span></a>
</span><span id="StreamlitPageMonitor-191"><a href="#StreamlitPageMonitor-191"><span class="linenos">191</span></a>    <span class="nd">@classmethod</span>
</span><span id="StreamlitPageMonitor-192"><a href="#StreamlitPageMonitor-192"><span class="linenos">192</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_page_errors</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
</span><span id="StreamlitPageMonitor-193"><a href="#StreamlitPageMonitor-193"><span class="linenos">193</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="StreamlitPageMonitor-194"><a href="#StreamlitPageMonitor-194"><span class="linenos">194</span></a><span class="sd">        Collects and returns errors for each page that has recorded errors.</span>
</span><span id="StreamlitPageMonitor-195"><a href="#StreamlitPageMonitor-195"><span class="linenos">195</span></a><span class="sd">        Iterates through the internal `_errors` dictionary, and for each page with errors,</span>
</span><span id="StreamlitPageMonitor-196"><a href="#StreamlitPageMonitor-196"><span class="linenos">196</span></a><span class="sd">        constructs a list of error details including the error message, traceback, timestamp,</span>
</span><span id="StreamlitPageMonitor-197"><a href="#StreamlitPageMonitor-197"><span class="linenos">197</span></a><span class="sd">        and error type.</span>
</span><span id="StreamlitPageMonitor-198"><a href="#StreamlitPageMonitor-198"><span class="linenos">198</span></a><span class="sd">        Returns:</span>
</span><span id="StreamlitPageMonitor-199"><a href="#StreamlitPageMonitor-199"><span class="linenos">199</span></a><span class="sd">            dict: A dictionary where keys are page names and values are lists of error details.</span>
</span><span id="StreamlitPageMonitor-200"><a href="#StreamlitPageMonitor-200"><span class="linenos">200</span></a><span class="sd">                  Each error detail is a dictionary with the following keys:</span>
</span><span id="StreamlitPageMonitor-201"><a href="#StreamlitPageMonitor-201"><span class="linenos">201</span></a><span class="sd">                      - &#39;error&#39; (str): The error message or &#39;Unknown error&#39; if not present.</span>
</span><span id="StreamlitPageMonitor-202"><a href="#StreamlitPageMonitor-202"><span class="linenos">202</span></a><span class="sd">                      - &#39;traceback&#39; (list): The traceback information or empty list if not present.</span>
</span><span id="StreamlitPageMonitor-203"><a href="#StreamlitPageMonitor-203"><span class="linenos">203</span></a><span class="sd">                      - &#39;timestamp&#39; (str): The timestamp of the error or empty string if not present.</span>
</span><span id="StreamlitPageMonitor-204"><a href="#StreamlitPageMonitor-204"><span class="linenos">204</span></a><span class="sd">                      - &#39;type&#39; (str): The type of error or &#39;unknown&#39; if not present.</span>
</span><span id="StreamlitPageMonitor-205"><a href="#StreamlitPageMonitor-205"><span class="linenos">205</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StreamlitPageMonitor-206"><a href="#StreamlitPageMonitor-206"><span class="linenos">206</span></a>        
</span><span id="StreamlitPageMonitor-207"><a href="#StreamlitPageMonitor-207"><span class="linenos">207</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="StreamlitPageMonitor-208"><a href="#StreamlitPageMonitor-208"><span class="linenos">208</span></a>        <span class="k">for</span> <span class="n">page</span><span class="p">,</span> <span class="n">errors</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="StreamlitPageMonitor-209"><a href="#StreamlitPageMonitor-209"><span class="linenos">209</span></a>            <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>  <span class="c1"># Only include pages with errors</span>
</span><span id="StreamlitPageMonitor-210"><a href="#StreamlitPageMonitor-210"><span class="linenos">210</span></a>                <span class="n">result</span><span class="p">[</span><span class="n">page</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="StreamlitPageMonitor-211"><a href="#StreamlitPageMonitor-211"><span class="linenos">211</span></a>                    <span class="p">{</span>
</span><span id="StreamlitPageMonitor-212"><a href="#StreamlitPageMonitor-212"><span class="linenos">212</span></a>                        <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="n">err</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown error&#39;</span><span class="p">),</span>
</span><span id="StreamlitPageMonitor-213"><a href="#StreamlitPageMonitor-213"><span class="linenos">213</span></a>                        <span class="s1">&#39;traceback&#39;</span><span class="p">:</span> <span class="n">err</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;traceback&#39;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="StreamlitPageMonitor-214"><a href="#StreamlitPageMonitor-214"><span class="linenos">214</span></a>                        <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">err</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
</span><span id="StreamlitPageMonitor-215"><a href="#StreamlitPageMonitor-215"><span class="linenos">215</span></a>                        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">err</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span><span class="p">)</span>
</span><span id="StreamlitPageMonitor-216"><a href="#StreamlitPageMonitor-216"><span class="linenos">216</span></a>                    <span class="p">}</span>
</span><span id="StreamlitPageMonitor-217"><a href="#StreamlitPageMonitor-217"><span class="linenos">217</span></a>                    <span class="k">for</span> <span class="n">err</span> <span class="ow">in</span> <span class="n">errors</span>
</span><span id="StreamlitPageMonitor-218"><a href="#StreamlitPageMonitor-218"><span class="linenos">218</span></a>                <span class="p">]</span>
</span><span id="StreamlitPageMonitor-219"><a href="#StreamlitPageMonitor-219"><span class="linenos">219</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="StreamlitPageMonitor-220"><a href="#StreamlitPageMonitor-220"><span class="linenos">220</span></a>
</span><span id="StreamlitPageMonitor-221"><a href="#StreamlitPageMonitor-221"><span class="linenos">221</span></a>    <span class="nd">@classmethod</span>
</span><span id="StreamlitPageMonitor-222"><a href="#StreamlitPageMonitor-222"><span class="linenos">222</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">clear_errors</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">page_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="StreamlitPageMonitor-223"><a href="#StreamlitPageMonitor-223"><span class="linenos">223</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear errors for a specific page or all pages&quot;&quot;&quot;</span>
</span><span id="StreamlitPageMonitor-224"><a href="#StreamlitPageMonitor-224"><span class="linenos">224</span></a>        <span class="k">if</span> <span class="n">page_name</span><span class="p">:</span>
</span><span id="StreamlitPageMonitor-225"><a href="#StreamlitPageMonitor-225"><span class="linenos">225</span></a>            <span class="k">if</span> <span class="n">page_name</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">:</span>
</span><span id="StreamlitPageMonitor-226"><a href="#StreamlitPageMonitor-226"><span class="linenos">226</span></a>                <span class="k">del</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">[</span><span class="n">page_name</span><span class="p">]</span>
</span><span id="StreamlitPageMonitor-227"><a href="#StreamlitPageMonitor-227"><span class="linenos">227</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StreamlitPageMonitor-228"><a href="#StreamlitPageMonitor-228"><span class="linenos">228</span></a>            <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span> <span class="o">=</span> <span class="p">{}</span>
</span></pre></div>


            <div class="docstring"><p>Singleton class to monitor and record errors and exceptions occurring in Streamlit pages.
This class monkey-patches <code>st.error</code> to capture error messages and provides decorators and methods
to track exceptions and errors per Streamlit page. Errors are stored in a class-level dictionary
and can be retrieved or cleared as needed.
Attributes:
    _instance (StreamlitPageMonitor): Singleton instance of the monitor.
    _errors (Dict[str, List[Dict[str, Any]]]): Dictionary mapping page names to lists of error records.
    _st_error (Callable): Original <code>st.error</code> function before monkey-patching.
    _current_page (str): Name of the current page being monitored.
Methods:
    __new__(cls):
        Ensures singleton behavior and monkey-patches <code>st.error</code> to record error messages.
    _handle_st_error(cls, error_message: str):
        Handles calls to <code>st.error</code> and records error information for the current page.
    set_page_context(cls, page_name: str):
        Sets the current page context for error recording.
    monitor_page(cls, page_name: str):
        Decorator to monitor a Streamlit page for exceptions and <code>st.error</code> calls.
        Records exceptions and errors under the specified page name.
    get_page_errors(cls):
        Retrieves all recorded errors for all pages, grouped by page name.
    clear_errors(cls, page_name: Optional[str] = None):
        Clears recorded errors for a specific page or all pages.</p>
</div>


                            <div id="StreamlitPageMonitor.set_page_context" class="classattr">
                                        <input id="StreamlitPageMonitor.set_page_context-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-classmethod">@classmethod</div>

        <span class="def">def</span>
        <span class="name">set_page_context</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">page_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StreamlitPageMonitor.set_page_context-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StreamlitPageMonitor.set_page_context"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StreamlitPageMonitor.set_page_context-126"><a href="#StreamlitPageMonitor.set_page_context-126"><span class="linenos">126</span></a>    <span class="nd">@classmethod</span>
</span><span id="StreamlitPageMonitor.set_page_context-127"><a href="#StreamlitPageMonitor.set_page_context-127"><span class="linenos">127</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_page_context</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">page_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="StreamlitPageMonitor.set_page_context-128"><a href="#StreamlitPageMonitor.set_page_context-128"><span class="linenos">128</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the current page context&quot;&quot;&quot;</span>
</span><span id="StreamlitPageMonitor.set_page_context-129"><a href="#StreamlitPageMonitor.set_page_context-129"><span class="linenos">129</span></a>        <span class="bp">cls</span><span class="o">.</span><span class="n">_current_page</span> <span class="o">=</span> <span class="n">page_name</span>
</span></pre></div>


            <div class="docstring"><p>Set the current page context</p>
</div>


                            </div>
                            <div id="StreamlitPageMonitor.monitor_page" class="classattr">
                                        <input id="StreamlitPageMonitor.monitor_page-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-classmethod">@classmethod</div>

        <span class="def">def</span>
        <span class="name">monitor_page</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">page_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StreamlitPageMonitor.monitor_page-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StreamlitPageMonitor.monitor_page"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StreamlitPageMonitor.monitor_page-131"><a href="#StreamlitPageMonitor.monitor_page-131"><span class="linenos">131</span></a>    <span class="nd">@classmethod</span>
</span><span id="StreamlitPageMonitor.monitor_page-132"><a href="#StreamlitPageMonitor.monitor_page-132"><span class="linenos">132</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">monitor_page</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">page_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="StreamlitPageMonitor.monitor_page-133"><a href="#StreamlitPageMonitor.monitor_page-133"><span class="linenos">133</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="StreamlitPageMonitor.monitor_page-134"><a href="#StreamlitPageMonitor.monitor_page-134"><span class="linenos">134</span></a><span class="sd">        Decorator to monitor and log exceptions for a specific Streamlit page.</span>
</span><span id="StreamlitPageMonitor.monitor_page-135"><a href="#StreamlitPageMonitor.monitor_page-135"><span class="linenos">135</span></a><span class="sd">        Args:</span>
</span><span id="StreamlitPageMonitor.monitor_page-136"><a href="#StreamlitPageMonitor.monitor_page-136"><span class="linenos">136</span></a><span class="sd">            page_name (str): The name of the page to monitor.</span>
</span><span id="StreamlitPageMonitor.monitor_page-137"><a href="#StreamlitPageMonitor.monitor_page-137"><span class="linenos">137</span></a><span class="sd">        Returns:</span>
</span><span id="StreamlitPageMonitor.monitor_page-138"><a href="#StreamlitPageMonitor.monitor_page-138"><span class="linenos">138</span></a><span class="sd">            Callable: A decorator that wraps the target function, sets the page context,</span>
</span><span id="StreamlitPageMonitor.monitor_page-139"><a href="#StreamlitPageMonitor.monitor_page-139"><span class="linenos">139</span></a><span class="sd">            clears previous non-Streamlit errors, and logs any exceptions that occur during execution.</span>
</span><span id="StreamlitPageMonitor.monitor_page-140"><a href="#StreamlitPageMonitor.monitor_page-140"><span class="linenos">140</span></a><span class="sd">        The decorator performs the following actions:</span>
</span><span id="StreamlitPageMonitor.monitor_page-141"><a href="#StreamlitPageMonitor.monitor_page-141"><span class="linenos">141</span></a><span class="sd">            - Sets the current page context using `cls.set_page_context`.</span>
</span><span id="StreamlitPageMonitor.monitor_page-142"><a href="#StreamlitPageMonitor.monitor_page-142"><span class="linenos">142</span></a><span class="sd">            - Clears previous exception errors for the page, retaining only those marked as &#39;streamlit_error&#39;.</span>
</span><span id="StreamlitPageMonitor.monitor_page-143"><a href="#StreamlitPageMonitor.monitor_page-143"><span class="linenos">143</span></a><span class="sd">            - Executes the wrapped function.</span>
</span><span id="StreamlitPageMonitor.monitor_page-144"><a href="#StreamlitPageMonitor.monitor_page-144"><span class="linenos">144</span></a><span class="sd">            - If an exception occurs, logs detailed error information (error message, traceback, timestamp, status, type, and page)</span>
</span><span id="StreamlitPageMonitor.monitor_page-145"><a href="#StreamlitPageMonitor.monitor_page-145"><span class="linenos">145</span></a><span class="sd">              to `cls._errors` under the given page name, then re-raises the exception.</span>
</span><span id="StreamlitPageMonitor.monitor_page-146"><a href="#StreamlitPageMonitor.monitor_page-146"><span class="linenos">146</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StreamlitPageMonitor.monitor_page-147"><a href="#StreamlitPageMonitor.monitor_page-147"><span class="linenos">147</span></a>        
</span><span id="StreamlitPageMonitor.monitor_page-148"><a href="#StreamlitPageMonitor.monitor_page-148"><span class="linenos">148</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">decorator</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
</span><span id="StreamlitPageMonitor.monitor_page-149"><a href="#StreamlitPageMonitor.monitor_page-149"><span class="linenos">149</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="StreamlitPageMonitor.monitor_page-150"><a href="#StreamlitPageMonitor.monitor_page-150"><span class="linenos">150</span></a><span class="sd">            Decorator to manage page-specific error handling and context setting.</span>
</span><span id="StreamlitPageMonitor.monitor_page-151"><a href="#StreamlitPageMonitor.monitor_page-151"><span class="linenos">151</span></a><span class="sd">            This decorator sets the current page context before executing the decorated function.</span>
</span><span id="StreamlitPageMonitor.monitor_page-152"><a href="#StreamlitPageMonitor.monitor_page-152"><span class="linenos">152</span></a><span class="sd">            It clears previous exception errors for the page, retaining only Streamlit error calls.</span>
</span><span id="StreamlitPageMonitor.monitor_page-153"><a href="#StreamlitPageMonitor.monitor_page-153"><span class="linenos">153</span></a><span class="sd">            If an exception occurs during function execution, it captures error details including</span>
</span><span id="StreamlitPageMonitor.monitor_page-154"><a href="#StreamlitPageMonitor.monitor_page-154"><span class="linenos">154</span></a><span class="sd">            the error message, traceback, timestamp, status, type, and page name, and appends them</span>
</span><span id="StreamlitPageMonitor.monitor_page-155"><a href="#StreamlitPageMonitor.monitor_page-155"><span class="linenos">155</span></a><span class="sd">            to the page&#39;s error log. The exception is then re-raised.</span>
</span><span id="StreamlitPageMonitor.monitor_page-156"><a href="#StreamlitPageMonitor.monitor_page-156"><span class="linenos">156</span></a><span class="sd">            Args:</span>
</span><span id="StreamlitPageMonitor.monitor_page-157"><a href="#StreamlitPageMonitor.monitor_page-157"><span class="linenos">157</span></a><span class="sd">                func (Callable): The function to be decorated.</span>
</span><span id="StreamlitPageMonitor.monitor_page-158"><a href="#StreamlitPageMonitor.monitor_page-158"><span class="linenos">158</span></a><span class="sd">            Returns:</span>
</span><span id="StreamlitPageMonitor.monitor_page-159"><a href="#StreamlitPageMonitor.monitor_page-159"><span class="linenos">159</span></a><span class="sd">                Callable: The wrapped function with error handling and context management.</span>
</span><span id="StreamlitPageMonitor.monitor_page-160"><a href="#StreamlitPageMonitor.monitor_page-160"><span class="linenos">160</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="StreamlitPageMonitor.monitor_page-161"><a href="#StreamlitPageMonitor.monitor_page-161"><span class="linenos">161</span></a>            
</span><span id="StreamlitPageMonitor.monitor_page-162"><a href="#StreamlitPageMonitor.monitor_page-162"><span class="linenos">162</span></a>            <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</span><span id="StreamlitPageMonitor.monitor_page-163"><a href="#StreamlitPageMonitor.monitor_page-163"><span class="linenos">163</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="StreamlitPageMonitor.monitor_page-164"><a href="#StreamlitPageMonitor.monitor_page-164"><span class="linenos">164</span></a>                <span class="c1"># Set the current page context</span>
</span><span id="StreamlitPageMonitor.monitor_page-165"><a href="#StreamlitPageMonitor.monitor_page-165"><span class="linenos">165</span></a>                <span class="bp">cls</span><span class="o">.</span><span class="n">set_page_context</span><span class="p">(</span><span class="n">page_name</span><span class="p">)</span>
</span><span id="StreamlitPageMonitor.monitor_page-166"><a href="#StreamlitPageMonitor.monitor_page-166"><span class="linenos">166</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="StreamlitPageMonitor.monitor_page-167"><a href="#StreamlitPageMonitor.monitor_page-167"><span class="linenos">167</span></a>                    <span class="c1"># Clear previous exception errors but keep st.error calls</span>
</span><span id="StreamlitPageMonitor.monitor_page-168"><a href="#StreamlitPageMonitor.monitor_page-168"><span class="linenos">168</span></a>                    <span class="k">if</span> <span class="n">page_name</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">:</span>
</span><span id="StreamlitPageMonitor.monitor_page-169"><a href="#StreamlitPageMonitor.monitor_page-169"><span class="linenos">169</span></a>                        <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">[</span><span class="n">page_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="StreamlitPageMonitor.monitor_page-170"><a href="#StreamlitPageMonitor.monitor_page-170"><span class="linenos">170</span></a>                            <span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">[</span><span class="n">page_name</span><span class="p">]</span>
</span><span id="StreamlitPageMonitor.monitor_page-171"><a href="#StreamlitPageMonitor.monitor_page-171"><span class="linenos">171</span></a>                            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;streamlit_error&#39;</span>
</span><span id="StreamlitPageMonitor.monitor_page-172"><a href="#StreamlitPageMonitor.monitor_page-172"><span class="linenos">172</span></a>                        <span class="p">]</span>
</span><span id="StreamlitPageMonitor.monitor_page-173"><a href="#StreamlitPageMonitor.monitor_page-173"><span class="linenos">173</span></a>                    <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="StreamlitPageMonitor.monitor_page-174"><a href="#StreamlitPageMonitor.monitor_page-174"><span class="linenos">174</span></a>                    <span class="k">return</span> <span class="n">result</span>
</span><span id="StreamlitPageMonitor.monitor_page-175"><a href="#StreamlitPageMonitor.monitor_page-175"><span class="linenos">175</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="StreamlitPageMonitor.monitor_page-176"><a href="#StreamlitPageMonitor.monitor_page-176"><span class="linenos">176</span></a>                    <span class="n">error_info</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="StreamlitPageMonitor.monitor_page-177"><a href="#StreamlitPageMonitor.monitor_page-177"><span class="linenos">177</span></a>                        <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="StreamlitPageMonitor.monitor_page-178"><a href="#StreamlitPageMonitor.monitor_page-178"><span class="linenos">178</span></a>                        <span class="s1">&#39;traceback&#39;</span><span class="p">:</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">(),</span>
</span><span id="StreamlitPageMonitor.monitor_page-179"><a href="#StreamlitPageMonitor.monitor_page-179"><span class="linenos">179</span></a>                        <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span><span id="StreamlitPageMonitor.monitor_page-180"><a href="#StreamlitPageMonitor.monitor_page-180"><span class="linenos">180</span></a>                        <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;critical&#39;</span><span class="p">,</span>
</span><span id="StreamlitPageMonitor.monitor_page-181"><a href="#StreamlitPageMonitor.monitor_page-181"><span class="linenos">181</span></a>                        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;exception&#39;</span><span class="p">,</span>
</span><span id="StreamlitPageMonitor.monitor_page-182"><a href="#StreamlitPageMonitor.monitor_page-182"><span class="linenos">182</span></a>                        <span class="s1">&#39;page&#39;</span><span class="p">:</span> <span class="n">page_name</span>
</span><span id="StreamlitPageMonitor.monitor_page-183"><a href="#StreamlitPageMonitor.monitor_page-183"><span class="linenos">183</span></a>                    <span class="p">}</span>
</span><span id="StreamlitPageMonitor.monitor_page-184"><a href="#StreamlitPageMonitor.monitor_page-184"><span class="linenos">184</span></a>                    <span class="k">if</span> <span class="n">page_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">:</span>
</span><span id="StreamlitPageMonitor.monitor_page-185"><a href="#StreamlitPageMonitor.monitor_page-185"><span class="linenos">185</span></a>                        <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">[</span><span class="n">page_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="StreamlitPageMonitor.monitor_page-186"><a href="#StreamlitPageMonitor.monitor_page-186"><span class="linenos">186</span></a>                    <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">[</span><span class="n">page_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_info</span><span class="p">)</span>
</span><span id="StreamlitPageMonitor.monitor_page-187"><a href="#StreamlitPageMonitor.monitor_page-187"><span class="linenos">187</span></a>                    <span class="k">raise</span>
</span><span id="StreamlitPageMonitor.monitor_page-188"><a href="#StreamlitPageMonitor.monitor_page-188"><span class="linenos">188</span></a>            <span class="k">return</span> <span class="n">wrapper</span>
</span><span id="StreamlitPageMonitor.monitor_page-189"><a href="#StreamlitPageMonitor.monitor_page-189"><span class="linenos">189</span></a>        <span class="k">return</span> <span class="n">decorator</span>
</span></pre></div>


            <div class="docstring"><p>Decorator to monitor and log exceptions for a specific Streamlit page.
Args:
    page_name (str): The name of the page to monitor.
Returns:
    Callable: A decorator that wraps the target function, sets the page context,
    clears previous non-Streamlit errors, and logs any exceptions that occur during execution.
The decorator performs the following actions:
    - Sets the current page context using <code>cls.set_page_context</code>.
    - Clears previous exception errors for the page, retaining only those marked as 'streamlit_error'.
    - Executes the wrapped function.
    - If an exception occurs, logs detailed error information (error message, traceback, timestamp, status, type, and page)
      to <code>cls._errors</code> under the given page name, then re-raises the exception.</p>
</div>


                            </div>
                            <div id="StreamlitPageMonitor.get_page_errors" class="classattr">
                                        <input id="StreamlitPageMonitor.get_page_errors-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-classmethod">@classmethod</div>

        <span class="def">def</span>
        <span class="name">get_page_errors</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StreamlitPageMonitor.get_page_errors-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StreamlitPageMonitor.get_page_errors"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StreamlitPageMonitor.get_page_errors-191"><a href="#StreamlitPageMonitor.get_page_errors-191"><span class="linenos">191</span></a>    <span class="nd">@classmethod</span>
</span><span id="StreamlitPageMonitor.get_page_errors-192"><a href="#StreamlitPageMonitor.get_page_errors-192"><span class="linenos">192</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_page_errors</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
</span><span id="StreamlitPageMonitor.get_page_errors-193"><a href="#StreamlitPageMonitor.get_page_errors-193"><span class="linenos">193</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="StreamlitPageMonitor.get_page_errors-194"><a href="#StreamlitPageMonitor.get_page_errors-194"><span class="linenos">194</span></a><span class="sd">        Collects and returns errors for each page that has recorded errors.</span>
</span><span id="StreamlitPageMonitor.get_page_errors-195"><a href="#StreamlitPageMonitor.get_page_errors-195"><span class="linenos">195</span></a><span class="sd">        Iterates through the internal `_errors` dictionary, and for each page with errors,</span>
</span><span id="StreamlitPageMonitor.get_page_errors-196"><a href="#StreamlitPageMonitor.get_page_errors-196"><span class="linenos">196</span></a><span class="sd">        constructs a list of error details including the error message, traceback, timestamp,</span>
</span><span id="StreamlitPageMonitor.get_page_errors-197"><a href="#StreamlitPageMonitor.get_page_errors-197"><span class="linenos">197</span></a><span class="sd">        and error type.</span>
</span><span id="StreamlitPageMonitor.get_page_errors-198"><a href="#StreamlitPageMonitor.get_page_errors-198"><span class="linenos">198</span></a><span class="sd">        Returns:</span>
</span><span id="StreamlitPageMonitor.get_page_errors-199"><a href="#StreamlitPageMonitor.get_page_errors-199"><span class="linenos">199</span></a><span class="sd">            dict: A dictionary where keys are page names and values are lists of error details.</span>
</span><span id="StreamlitPageMonitor.get_page_errors-200"><a href="#StreamlitPageMonitor.get_page_errors-200"><span class="linenos">200</span></a><span class="sd">                  Each error detail is a dictionary with the following keys:</span>
</span><span id="StreamlitPageMonitor.get_page_errors-201"><a href="#StreamlitPageMonitor.get_page_errors-201"><span class="linenos">201</span></a><span class="sd">                      - &#39;error&#39; (str): The error message or &#39;Unknown error&#39; if not present.</span>
</span><span id="StreamlitPageMonitor.get_page_errors-202"><a href="#StreamlitPageMonitor.get_page_errors-202"><span class="linenos">202</span></a><span class="sd">                      - &#39;traceback&#39; (list): The traceback information or empty list if not present.</span>
</span><span id="StreamlitPageMonitor.get_page_errors-203"><a href="#StreamlitPageMonitor.get_page_errors-203"><span class="linenos">203</span></a><span class="sd">                      - &#39;timestamp&#39; (str): The timestamp of the error or empty string if not present.</span>
</span><span id="StreamlitPageMonitor.get_page_errors-204"><a href="#StreamlitPageMonitor.get_page_errors-204"><span class="linenos">204</span></a><span class="sd">                      - &#39;type&#39; (str): The type of error or &#39;unknown&#39; if not present.</span>
</span><span id="StreamlitPageMonitor.get_page_errors-205"><a href="#StreamlitPageMonitor.get_page_errors-205"><span class="linenos">205</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="StreamlitPageMonitor.get_page_errors-206"><a href="#StreamlitPageMonitor.get_page_errors-206"><span class="linenos">206</span></a>        
</span><span id="StreamlitPageMonitor.get_page_errors-207"><a href="#StreamlitPageMonitor.get_page_errors-207"><span class="linenos">207</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="StreamlitPageMonitor.get_page_errors-208"><a href="#StreamlitPageMonitor.get_page_errors-208"><span class="linenos">208</span></a>        <span class="k">for</span> <span class="n">page</span><span class="p">,</span> <span class="n">errors</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="StreamlitPageMonitor.get_page_errors-209"><a href="#StreamlitPageMonitor.get_page_errors-209"><span class="linenos">209</span></a>            <span class="k">if</span> <span class="n">errors</span><span class="p">:</span>  <span class="c1"># Only include pages with errors</span>
</span><span id="StreamlitPageMonitor.get_page_errors-210"><a href="#StreamlitPageMonitor.get_page_errors-210"><span class="linenos">210</span></a>                <span class="n">result</span><span class="p">[</span><span class="n">page</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="StreamlitPageMonitor.get_page_errors-211"><a href="#StreamlitPageMonitor.get_page_errors-211"><span class="linenos">211</span></a>                    <span class="p">{</span>
</span><span id="StreamlitPageMonitor.get_page_errors-212"><a href="#StreamlitPageMonitor.get_page_errors-212"><span class="linenos">212</span></a>                        <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="n">err</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown error&#39;</span><span class="p">),</span>
</span><span id="StreamlitPageMonitor.get_page_errors-213"><a href="#StreamlitPageMonitor.get_page_errors-213"><span class="linenos">213</span></a>                        <span class="s1">&#39;traceback&#39;</span><span class="p">:</span> <span class="n">err</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;traceback&#39;</span><span class="p">,</span> <span class="p">[]),</span>
</span><span id="StreamlitPageMonitor.get_page_errors-214"><a href="#StreamlitPageMonitor.get_page_errors-214"><span class="linenos">214</span></a>                        <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">err</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
</span><span id="StreamlitPageMonitor.get_page_errors-215"><a href="#StreamlitPageMonitor.get_page_errors-215"><span class="linenos">215</span></a>                        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">err</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;unknown&#39;</span><span class="p">)</span>
</span><span id="StreamlitPageMonitor.get_page_errors-216"><a href="#StreamlitPageMonitor.get_page_errors-216"><span class="linenos">216</span></a>                    <span class="p">}</span>
</span><span id="StreamlitPageMonitor.get_page_errors-217"><a href="#StreamlitPageMonitor.get_page_errors-217"><span class="linenos">217</span></a>                    <span class="k">for</span> <span class="n">err</span> <span class="ow">in</span> <span class="n">errors</span>
</span><span id="StreamlitPageMonitor.get_page_errors-218"><a href="#StreamlitPageMonitor.get_page_errors-218"><span class="linenos">218</span></a>                <span class="p">]</span>
</span><span id="StreamlitPageMonitor.get_page_errors-219"><a href="#StreamlitPageMonitor.get_page_errors-219"><span class="linenos">219</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Collects and returns errors for each page that has recorded errors.
Iterates through the internal <code>_errors</code> dictionary, and for each page with errors,
constructs a list of error details including the error message, traceback, timestamp,
and error type.
Returns:
    dict: A dictionary where keys are page names and values are lists of error details.
          Each error detail is a dictionary with the following keys:
              - 'error' (str): The error message or 'Unknown error' if not present.
              - 'traceback' (list): The traceback information or empty list if not present.
              - 'timestamp' (str): The timestamp of the error or empty string if not present.
              - 'type' (str): The type of error or 'unknown' if not present.</p>
</div>


                            </div>
                            <div id="StreamlitPageMonitor.clear_errors" class="classattr">
                                        <input id="StreamlitPageMonitor.clear_errors-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-classmethod">@classmethod</div>

        <span class="def">def</span>
        <span class="name">clear_errors</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">page_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StreamlitPageMonitor.clear_errors-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StreamlitPageMonitor.clear_errors"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StreamlitPageMonitor.clear_errors-221"><a href="#StreamlitPageMonitor.clear_errors-221"><span class="linenos">221</span></a>    <span class="nd">@classmethod</span>
</span><span id="StreamlitPageMonitor.clear_errors-222"><a href="#StreamlitPageMonitor.clear_errors-222"><span class="linenos">222</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">clear_errors</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">page_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="StreamlitPageMonitor.clear_errors-223"><a href="#StreamlitPageMonitor.clear_errors-223"><span class="linenos">223</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear errors for a specific page or all pages&quot;&quot;&quot;</span>
</span><span id="StreamlitPageMonitor.clear_errors-224"><a href="#StreamlitPageMonitor.clear_errors-224"><span class="linenos">224</span></a>        <span class="k">if</span> <span class="n">page_name</span><span class="p">:</span>
</span><span id="StreamlitPageMonitor.clear_errors-225"><a href="#StreamlitPageMonitor.clear_errors-225"><span class="linenos">225</span></a>            <span class="k">if</span> <span class="n">page_name</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">:</span>
</span><span id="StreamlitPageMonitor.clear_errors-226"><a href="#StreamlitPageMonitor.clear_errors-226"><span class="linenos">226</span></a>                <span class="k">del</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span><span class="p">[</span><span class="n">page_name</span><span class="p">]</span>
</span><span id="StreamlitPageMonitor.clear_errors-227"><a href="#StreamlitPageMonitor.clear_errors-227"><span class="linenos">227</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="StreamlitPageMonitor.clear_errors-228"><a href="#StreamlitPageMonitor.clear_errors-228"><span class="linenos">228</span></a>            <span class="bp">cls</span><span class="o">.</span><span class="n">_errors</span> <span class="o">=</span> <span class="p">{}</span>
</span></pre></div>


            <div class="docstring"><p>Clear errors for a specific page or all pages</p>
</div>


                            </div>
                </section>
                <section id="HealthCheckService">
                            <input id="HealthCheckService-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">HealthCheckService</span>:

                <label class="view-source-button" for="HealthCheckService-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HealthCheckService"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HealthCheckService-230"><a href="#HealthCheckService-230"><span class="linenos">230</span></a><span class="k">class</span><span class="w"> </span><span class="nc">HealthCheckService</span><span class="p">:</span>
</span><span id="HealthCheckService-231"><a href="#HealthCheckService-231"><span class="linenos">231</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HealthCheckService-232"><a href="#HealthCheckService-232"><span class="linenos">232</span></a><span class="sd">    HealthCheckService provides a comprehensive health monitoring solution for Streamlit applications.</span>
</span><span id="HealthCheckService-233"><a href="#HealthCheckService-233"><span class="linenos">233</span></a><span class="sd">    It periodically checks system resources, external dependencies, custom health checks, and Streamlit server/page status,</span>
</span><span id="HealthCheckService-234"><a href="#HealthCheckService-234"><span class="linenos">234</span></a><span class="sd">    updating and reporting the overall health status.</span>
</span><span id="HealthCheckService-235"><a href="#HealthCheckService-235"><span class="linenos">235</span></a><span class="sd">    Attributes:</span>
</span><span id="HealthCheckService-236"><a href="#HealthCheckService-236"><span class="linenos">236</span></a><span class="sd">        logger (logging.Logger): Logger for health check events.</span>
</span><span id="HealthCheckService-237"><a href="#HealthCheckService-237"><span class="linenos">237</span></a><span class="sd">        config_path (str): Path to the health check configuration file.</span>
</span><span id="HealthCheckService-238"><a href="#HealthCheckService-238"><span class="linenos">238</span></a><span class="sd">        health_data (Dict[str, Any]): Stores the latest health check results.</span>
</span><span id="HealthCheckService-239"><a href="#HealthCheckService-239"><span class="linenos">239</span></a><span class="sd">        config (Dict): Loaded health check configuration.</span>
</span><span id="HealthCheckService-240"><a href="#HealthCheckService-240"><span class="linenos">240</span></a><span class="sd">        check_interval (int): Interval (in seconds) between health checks.</span>
</span><span id="HealthCheckService-241"><a href="#HealthCheckService-241"><span class="linenos">241</span></a><span class="sd">        _running (bool): Indicates if the health check service is running.</span>
</span><span id="HealthCheckService-242"><a href="#HealthCheckService-242"><span class="linenos">242</span></a><span class="sd">        _thread (threading.Thread): Background thread for periodic checks.</span>
</span><span id="HealthCheckService-243"><a href="#HealthCheckService-243"><span class="linenos">243</span></a><span class="sd">        streamlit_url (str): URL of the Streamlit server.</span>
</span><span id="HealthCheckService-244"><a href="#HealthCheckService-244"><span class="linenos">244</span></a><span class="sd">        streamlit_port (int): Port of the Streamlit server.</span>
</span><span id="HealthCheckService-245"><a href="#HealthCheckService-245"><span class="linenos">245</span></a><span class="sd">    Methods:</span>
</span><span id="HealthCheckService-246"><a href="#HealthCheckService-246"><span class="linenos">246</span></a><span class="sd">        __init__(config_path: str = &quot;health_check_config.json&quot;):</span>
</span><span id="HealthCheckService-247"><a href="#HealthCheckService-247"><span class="linenos">247</span></a><span class="sd">            Initializes the HealthCheckService with configuration and default health data.</span>
</span><span id="HealthCheckService-248"><a href="#HealthCheckService-248"><span class="linenos">248</span></a><span class="sd">        _load_config() -&gt; Dict:</span>
</span><span id="HealthCheckService-249"><a href="#HealthCheckService-249"><span class="linenos">249</span></a><span class="sd">            Loads health check configuration from file or returns default configuration.</span>
</span><span id="HealthCheckService-250"><a href="#HealthCheckService-250"><span class="linenos">250</span></a><span class="sd">        _get_default_config() -&gt; Dict:</span>
</span><span id="HealthCheckService-251"><a href="#HealthCheckService-251"><span class="linenos">251</span></a><span class="sd">            Returns the default health check configuration.</span>
</span><span id="HealthCheckService-252"><a href="#HealthCheckService-252"><span class="linenos">252</span></a><span class="sd">        start():</span>
</span><span id="HealthCheckService-253"><a href="#HealthCheckService-253"><span class="linenos">253</span></a><span class="sd">            Starts the health check service in a background thread.</span>
</span><span id="HealthCheckService-254"><a href="#HealthCheckService-254"><span class="linenos">254</span></a><span class="sd">        stop():</span>
</span><span id="HealthCheckService-255"><a href="#HealthCheckService-255"><span class="linenos">255</span></a><span class="sd">            Stops the health check service.</span>
</span><span id="HealthCheckService-256"><a href="#HealthCheckService-256"><span class="linenos">256</span></a><span class="sd">        _run_checks_periodically():</span>
</span><span id="HealthCheckService-257"><a href="#HealthCheckService-257"><span class="linenos">257</span></a><span class="sd">            Runs health checks periodically based on the configured interval.</span>
</span><span id="HealthCheckService-258"><a href="#HealthCheckService-258"><span class="linenos">258</span></a><span class="sd">        run_all_checks():</span>
</span><span id="HealthCheckService-259"><a href="#HealthCheckService-259"><span class="linenos">259</span></a><span class="sd">            Executes all configured health checks and updates health data.</span>
</span><span id="HealthCheckService-260"><a href="#HealthCheckService-260"><span class="linenos">260</span></a><span class="sd">        check_cpu():</span>
</span><span id="HealthCheckService-261"><a href="#HealthCheckService-261"><span class="linenos">261</span></a><span class="sd">            Checks CPU usage and updates health data.</span>
</span><span id="HealthCheckService-262"><a href="#HealthCheckService-262"><span class="linenos">262</span></a><span class="sd">        check_memory():</span>
</span><span id="HealthCheckService-263"><a href="#HealthCheckService-263"><span class="linenos">263</span></a><span class="sd">            Checks memory usage and updates health data.</span>
</span><span id="HealthCheckService-264"><a href="#HealthCheckService-264"><span class="linenos">264</span></a><span class="sd">        check_disk():</span>
</span><span id="HealthCheckService-265"><a href="#HealthCheckService-265"><span class="linenos">265</span></a><span class="sd">            Checks disk usage and updates health data.</span>
</span><span id="HealthCheckService-266"><a href="#HealthCheckService-266"><span class="linenos">266</span></a><span class="sd">        check_dependencies():</span>
</span><span id="HealthCheckService-267"><a href="#HealthCheckService-267"><span class="linenos">267</span></a><span class="sd">            Checks external dependencies such as APIs and databases.</span>
</span><span id="HealthCheckService-268"><a href="#HealthCheckService-268"><span class="linenos">268</span></a><span class="sd">        _check_api_endpoint(endpoint: Dict):</span>
</span><span id="HealthCheckService-269"><a href="#HealthCheckService-269"><span class="linenos">269</span></a><span class="sd">            Checks if an API endpoint is accessible and updates health data.</span>
</span><span id="HealthCheckService-270"><a href="#HealthCheckService-270"><span class="linenos">270</span></a><span class="sd">        _check_database(db_config: Dict):</span>
</span><span id="HealthCheckService-271"><a href="#HealthCheckService-271"><span class="linenos">271</span></a><span class="sd">            Checks database connection (placeholder for actual implementation).</span>
</span><span id="HealthCheckService-272"><a href="#HealthCheckService-272"><span class="linenos">272</span></a><span class="sd">        register_custom_check(name: str, check_func: Callable[[], Dict[str, Any]]):</span>
</span><span id="HealthCheckService-273"><a href="#HealthCheckService-273"><span class="linenos">273</span></a><span class="sd">            Registers a custom health check function.</span>
</span><span id="HealthCheckService-274"><a href="#HealthCheckService-274"><span class="linenos">274</span></a><span class="sd">        run_custom_checks():</span>
</span><span id="HealthCheckService-275"><a href="#HealthCheckService-275"><span class="linenos">275</span></a><span class="sd">            Executes all registered custom health checks.</span>
</span><span id="HealthCheckService-276"><a href="#HealthCheckService-276"><span class="linenos">276</span></a><span class="sd">        _update_overall_status():</span>
</span><span id="HealthCheckService-277"><a href="#HealthCheckService-277"><span class="linenos">277</span></a><span class="sd">            Updates the overall health status based on individual checks.</span>
</span><span id="HealthCheckService-278"><a href="#HealthCheckService-278"><span class="linenos">278</span></a><span class="sd">        get_health_data() -&gt; Dict:</span>
</span><span id="HealthCheckService-279"><a href="#HealthCheckService-279"><span class="linenos">279</span></a><span class="sd">            Returns the latest health check data, excluding function references.</span>
</span><span id="HealthCheckService-280"><a href="#HealthCheckService-280"><span class="linenos">280</span></a><span class="sd">        save_config():</span>
</span><span id="HealthCheckService-281"><a href="#HealthCheckService-281"><span class="linenos">281</span></a><span class="sd">            Saves the current configuration to file.</span>
</span><span id="HealthCheckService-282"><a href="#HealthCheckService-282"><span class="linenos">282</span></a><span class="sd">        check_streamlit_pages():</span>
</span><span id="HealthCheckService-283"><a href="#HealthCheckService-283"><span class="linenos">283</span></a><span class="sd">            Checks for errors in Streamlit pages and updates health data.</span>
</span><span id="HealthCheckService-284"><a href="#HealthCheckService-284"><span class="linenos">284</span></a><span class="sd">        check_streamlit_server() -&gt; Dict[str, Any]:</span>
</span><span id="HealthCheckService-285"><a href="#HealthCheckService-285"><span class="linenos">285</span></a><span class="sd">            Checks if the Streamlit server is running and responding.</span>
</span><span id="HealthCheckService-286"><a href="#HealthCheckService-286"><span class="linenos">286</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="HealthCheckService-287"><a href="#HealthCheckService-287"><span class="linenos">287</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;health_check_config.json&quot;</span><span class="p">):</span>
</span><span id="HealthCheckService-288"><a href="#HealthCheckService-288"><span class="linenos">288</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HealthCheckService-289"><a href="#HealthCheckService-289"><span class="linenos">289</span></a><span class="sd">        Initializes the HealthCheckService instance.</span>
</span><span id="HealthCheckService-290"><a href="#HealthCheckService-290"><span class="linenos">290</span></a><span class="sd">        Args:</span>
</span><span id="HealthCheckService-291"><a href="#HealthCheckService-291"><span class="linenos">291</span></a><span class="sd">            config_path (str): Path to the health check configuration file. Defaults to &quot;health_check_config.json&quot;.</span>
</span><span id="HealthCheckService-292"><a href="#HealthCheckService-292"><span class="linenos">292</span></a><span class="sd">        Attributes:</span>
</span><span id="HealthCheckService-293"><a href="#HealthCheckService-293"><span class="linenos">293</span></a><span class="sd">            logger (logging.Logger): Logger for the HealthCheckService.</span>
</span><span id="HealthCheckService-294"><a href="#HealthCheckService-294"><span class="linenos">294</span></a><span class="sd">            config_path (str): Path to the configuration file.</span>
</span><span id="HealthCheckService-295"><a href="#HealthCheckService-295"><span class="linenos">295</span></a><span class="sd">            health_data (Dict[str, Any]): Dictionary storing health check data.</span>
</span><span id="HealthCheckService-296"><a href="#HealthCheckService-296"><span class="linenos">296</span></a><span class="sd">            config (dict): Loaded configuration from the config file.</span>
</span><span id="HealthCheckService-297"><a href="#HealthCheckService-297"><span class="linenos">297</span></a><span class="sd">            check_interval (int): Interval in seconds between health checks. Defaults to 60.</span>
</span><span id="HealthCheckService-298"><a href="#HealthCheckService-298"><span class="linenos">298</span></a><span class="sd">            _running (bool): Indicates if the health check service is running.</span>
</span><span id="HealthCheckService-299"><a href="#HealthCheckService-299"><span class="linenos">299</span></a><span class="sd">            _thread (threading.Thread or None): Thread running the health check loop.</span>
</span><span id="HealthCheckService-300"><a href="#HealthCheckService-300"><span class="linenos">300</span></a><span class="sd">            streamlit_url (str): URL of the Streamlit service. Defaults to &quot;http://localhost&quot;.</span>
</span><span id="HealthCheckService-301"><a href="#HealthCheckService-301"><span class="linenos">301</span></a><span class="sd">            streamlit_port (int): Port of the Streamlit service. Defaults to 8501.</span>
</span><span id="HealthCheckService-302"><a href="#HealthCheckService-302"><span class="linenos">302</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HealthCheckService-303"><a href="#HealthCheckService-303"><span class="linenos">303</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.HealthCheckService&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService-304"><a href="#HealthCheckService-304"><span class="linenos">304</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Initializing HealthCheckService&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService-305"><a href="#HealthCheckService-305"><span class="linenos">305</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config_path</span> <span class="o">=</span> <span class="n">config_path</span>
</span><span id="HealthCheckService-306"><a href="#HealthCheckService-306"><span class="linenos">306</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="HealthCheckService-307"><a href="#HealthCheckService-307"><span class="linenos">307</span></a>            <span class="s2">&quot;last_updated&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="HealthCheckService-308"><a href="#HealthCheckService-308"><span class="linenos">308</span></a>            <span class="s2">&quot;system&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="HealthCheckService-309"><a href="#HealthCheckService-309"><span class="linenos">309</span></a>            <span class="s2">&quot;dependencies&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="HealthCheckService-310"><a href="#HealthCheckService-310"><span class="linenos">310</span></a>            <span class="s2">&quot;custom_checks&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="HealthCheckService-311"><a href="#HealthCheckService-311"><span class="linenos">311</span></a>            <span class="s2">&quot;overall_status&quot;</span><span class="p">:</span> <span class="s2">&quot;unknown&quot;</span>
</span><span id="HealthCheckService-312"><a href="#HealthCheckService-312"><span class="linenos">312</span></a>        <span class="p">}</span>
</span><span id="HealthCheckService-313"><a href="#HealthCheckService-313"><span class="linenos">313</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_config</span><span class="p">()</span>
</span><span id="HealthCheckService-314"><a href="#HealthCheckService-314"><span class="linenos">314</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">check_interval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;check_interval&quot;</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>  <span class="c1"># Default: 60 seconds</span>
</span><span id="HealthCheckService-315"><a href="#HealthCheckService-315"><span class="linenos">315</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_running</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="HealthCheckService-316"><a href="#HealthCheckService-316"><span class="linenos">316</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="HealthCheckService-317"><a href="#HealthCheckService-317"><span class="linenos">317</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">streamlit_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;streamlit_url&quot;</span><span class="p">,</span> <span class="s2">&quot;http://localhost&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService-318"><a href="#HealthCheckService-318"><span class="linenos">318</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">streamlit_port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;streamlit_port&quot;</span><span class="p">,</span> <span class="mi">8501</span><span class="p">)</span>  <span class="c1"># Default: 8501</span>
</span><span id="HealthCheckService-319"><a href="#HealthCheckService-319"><span class="linenos">319</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_load_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="HealthCheckService-320"><a href="#HealthCheckService-320"><span class="linenos">320</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Load health check configuration from file.&quot;&quot;&quot;</span>
</span><span id="HealthCheckService-321"><a href="#HealthCheckService-321"><span class="linenos">321</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">):</span>
</span><span id="HealthCheckService-322"><a href="#HealthCheckService-322"><span class="linenos">322</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="HealthCheckService-323"><a href="#HealthCheckService-323"><span class="linenos">323</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="HealthCheckService-324"><a href="#HealthCheckService-324"><span class="linenos">324</span></a>                    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="HealthCheckService-325"><a href="#HealthCheckService-325"><span class="linenos">325</span></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="HealthCheckService-326"><a href="#HealthCheckService-326"><span class="linenos">326</span></a>                <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading health check config: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService-327"><a href="#HealthCheckService-327"><span class="linenos">327</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_config</span><span class="p">()</span>
</span><span id="HealthCheckService-328"><a href="#HealthCheckService-328"><span class="linenos">328</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="HealthCheckService-329"><a href="#HealthCheckService-329"><span class="linenos">329</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_config</span><span class="p">()</span>
</span><span id="HealthCheckService-330"><a href="#HealthCheckService-330"><span class="linenos">330</span></a>            
</span><span id="HealthCheckService-331"><a href="#HealthCheckService-331"><span class="linenos">331</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_default_config</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="HealthCheckService-332"><a href="#HealthCheckService-332"><span class="linenos">332</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return default health check configuration.&quot;&quot;&quot;</span>
</span><span id="HealthCheckService-333"><a href="#HealthCheckService-333"><span class="linenos">333</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="HealthCheckService-334"><a href="#HealthCheckService-334"><span class="linenos">334</span></a>            <span class="s2">&quot;check_interval&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
</span><span id="HealthCheckService-335"><a href="#HealthCheckService-335"><span class="linenos">335</span></a>            <span class="s2">&quot;streamlit_url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://localhost&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService-336"><a href="#HealthCheckService-336"><span class="linenos">336</span></a>            <span class="s2">&quot;streamlit_port&quot;</span><span class="p">:</span> <span class="mi">8501</span><span class="p">,</span>
</span><span id="HealthCheckService-337"><a href="#HealthCheckService-337"><span class="linenos">337</span></a>            <span class="s2">&quot;system_checks&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="HealthCheckService-338"><a href="#HealthCheckService-338"><span class="linenos">338</span></a>                <span class="s2">&quot;cpu&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="HealthCheckService-339"><a href="#HealthCheckService-339"><span class="linenos">339</span></a>                <span class="s2">&quot;memory&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="HealthCheckService-340"><a href="#HealthCheckService-340"><span class="linenos">340</span></a>                <span class="s2">&quot;disk&quot;</span><span class="p">:</span> <span class="kc">True</span>
</span><span id="HealthCheckService-341"><a href="#HealthCheckService-341"><span class="linenos">341</span></a>            <span class="p">},</span>
</span><span id="HealthCheckService-342"><a href="#HealthCheckService-342"><span class="linenos">342</span></a>            <span class="s2">&quot;dependencies&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="HealthCheckService-343"><a href="#HealthCheckService-343"><span class="linenos">343</span></a>                <span class="s2">&quot;api_endpoints&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="HealthCheckService-344"><a href="#HealthCheckService-344"><span class="linenos">344</span></a>                    <span class="c1"># Example API endpoint to check</span>
</span><span id="HealthCheckService-345"><a href="#HealthCheckService-345"><span class="linenos">345</span></a>                    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;example_api&quot;</span><span class="p">,</span> <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://httpbin.org/get&quot;</span><span class="p">,</span> <span class="s2">&quot;timeout&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>
</span><span id="HealthCheckService-346"><a href="#HealthCheckService-346"><span class="linenos">346</span></a>                <span class="p">],</span>
</span><span id="HealthCheckService-347"><a href="#HealthCheckService-347"><span class="linenos">347</span></a>                <span class="s2">&quot;databases&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="HealthCheckService-348"><a href="#HealthCheckService-348"><span class="linenos">348</span></a>                    <span class="c1"># Example database connection to check</span>
</span><span id="HealthCheckService-349"><a href="#HealthCheckService-349"><span class="linenos">349</span></a>                    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;main_db&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;postgres&quot;</span><span class="p">,</span> <span class="s2">&quot;connection_string&quot;</span><span class="p">:</span> <span class="s2">&quot;...&quot;</span><span class="p">}</span>
</span><span id="HealthCheckService-350"><a href="#HealthCheckService-350"><span class="linenos">350</span></a>                <span class="p">]</span>
</span><span id="HealthCheckService-351"><a href="#HealthCheckService-351"><span class="linenos">351</span></a>            <span class="p">},</span>
</span><span id="HealthCheckService-352"><a href="#HealthCheckService-352"><span class="linenos">352</span></a>            <span class="s2">&quot;thresholds&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="HealthCheckService-353"><a href="#HealthCheckService-353"><span class="linenos">353</span></a>                <span class="s2">&quot;cpu_warning&quot;</span><span class="p">:</span> <span class="mi">70</span><span class="p">,</span>
</span><span id="HealthCheckService-354"><a href="#HealthCheckService-354"><span class="linenos">354</span></a>                <span class="s2">&quot;cpu_critical&quot;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span>
</span><span id="HealthCheckService-355"><a href="#HealthCheckService-355"><span class="linenos">355</span></a>                <span class="s2">&quot;memory_warning&quot;</span><span class="p">:</span> <span class="mi">70</span><span class="p">,</span>
</span><span id="HealthCheckService-356"><a href="#HealthCheckService-356"><span class="linenos">356</span></a>                <span class="s2">&quot;memory_critical&quot;</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span>
</span><span id="HealthCheckService-357"><a href="#HealthCheckService-357"><span class="linenos">357</span></a>                <span class="s2">&quot;disk_warning&quot;</span><span class="p">:</span> <span class="mi">70</span><span class="p">,</span>
</span><span id="HealthCheckService-358"><a href="#HealthCheckService-358"><span class="linenos">358</span></a>                <span class="s2">&quot;disk_critical&quot;</span><span class="p">:</span> <span class="mi">90</span>
</span><span id="HealthCheckService-359"><a href="#HealthCheckService-359"><span class="linenos">359</span></a>            <span class="p">}</span>
</span><span id="HealthCheckService-360"><a href="#HealthCheckService-360"><span class="linenos">360</span></a>        <span class="p">}</span>
</span><span id="HealthCheckService-361"><a href="#HealthCheckService-361"><span class="linenos">361</span></a>    
</span><span id="HealthCheckService-362"><a href="#HealthCheckService-362"><span class="linenos">362</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="HealthCheckService-363"><a href="#HealthCheckService-363"><span class="linenos">363</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Start the health check service in a background thread.&quot;&quot;&quot;</span>
</span><span id="HealthCheckService-364"><a href="#HealthCheckService-364"><span class="linenos">364</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running</span><span class="p">:</span>
</span><span id="HealthCheckService-365"><a href="#HealthCheckService-365"><span class="linenos">365</span></a>            <span class="k">return</span>
</span><span id="HealthCheckService-366"><a href="#HealthCheckService-366"><span class="linenos">366</span></a>            
</span><span id="HealthCheckService-367"><a href="#HealthCheckService-367"><span class="linenos">367</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_running</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="HealthCheckService-368"><a href="#HealthCheckService-368"><span class="linenos">368</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_run_checks_periodically</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="HealthCheckService-369"><a href="#HealthCheckService-369"><span class="linenos">369</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="HealthCheckService-370"><a href="#HealthCheckService-370"><span class="linenos">370</span></a>        
</span><span id="HealthCheckService-371"><a href="#HealthCheckService-371"><span class="linenos">371</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="HealthCheckService-372"><a href="#HealthCheckService-372"><span class="linenos">372</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stop the health check service.&quot;&quot;&quot;</span>
</span><span id="HealthCheckService-373"><a href="#HealthCheckService-373"><span class="linenos">373</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_running</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="HealthCheckService-374"><a href="#HealthCheckService-374"><span class="linenos">374</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="p">:</span>
</span><span id="HealthCheckService-375"><a href="#HealthCheckService-375"><span class="linenos">375</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="HealthCheckService-376"><a href="#HealthCheckService-376"><span class="linenos">376</span></a>            
</span><span id="HealthCheckService-377"><a href="#HealthCheckService-377"><span class="linenos">377</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_run_checks_periodically</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="HealthCheckService-378"><a href="#HealthCheckService-378"><span class="linenos">378</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Run health checks periodically based on check interval.&quot;&quot;&quot;</span>
</span><span id="HealthCheckService-379"><a href="#HealthCheckService-379"><span class="linenos">379</span></a>        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running</span><span class="p">:</span>
</span><span id="HealthCheckService-380"><a href="#HealthCheckService-380"><span class="linenos">380</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">run_all_checks</span><span class="p">()</span>
</span><span id="HealthCheckService-381"><a href="#HealthCheckService-381"><span class="linenos">381</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">check_interval</span><span class="p">)</span>
</span><span id="HealthCheckService-382"><a href="#HealthCheckService-382"><span class="linenos">382</span></a>            
</span><span id="HealthCheckService-383"><a href="#HealthCheckService-383"><span class="linenos">383</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run_all_checks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="HealthCheckService-384"><a href="#HealthCheckService-384"><span class="linenos">384</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Run all configured health checks and update health data.&quot;&quot;&quot;</span>
</span><span id="HealthCheckService-385"><a href="#HealthCheckService-385"><span class="linenos">385</span></a>        <span class="c1"># Update timestamp</span>
</span><span id="HealthCheckService-386"><a href="#HealthCheckService-386"><span class="linenos">386</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;last_updated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="HealthCheckService-387"><a href="#HealthCheckService-387"><span class="linenos">387</span></a>        
</span><span id="HealthCheckService-388"><a href="#HealthCheckService-388"><span class="linenos">388</span></a>        <span class="c1"># Check Streamlit server</span>
</span><span id="HealthCheckService-389"><a href="#HealthCheckService-389"><span class="linenos">389</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;streamlit_server&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_streamlit_server</span><span class="p">()</span>
</span><span id="HealthCheckService-390"><a href="#HealthCheckService-390"><span class="linenos">390</span></a>        
</span><span id="HealthCheckService-391"><a href="#HealthCheckService-391"><span class="linenos">391</span></a>        <span class="c1"># System checks</span>
</span><span id="HealthCheckService-392"><a href="#HealthCheckService-392"><span class="linenos">392</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;system_checks&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="HealthCheckService-393"><a href="#HealthCheckService-393"><span class="linenos">393</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">check_cpu</span><span class="p">()</span>
</span><span id="HealthCheckService-394"><a href="#HealthCheckService-394"><span class="linenos">394</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;system_checks&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="HealthCheckService-395"><a href="#HealthCheckService-395"><span class="linenos">395</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">check_memory</span><span class="p">()</span>
</span><span id="HealthCheckService-396"><a href="#HealthCheckService-396"><span class="linenos">396</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;system_checks&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;disk&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="HealthCheckService-397"><a href="#HealthCheckService-397"><span class="linenos">397</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">check_disk</span><span class="p">()</span>
</span><span id="HealthCheckService-398"><a href="#HealthCheckService-398"><span class="linenos">398</span></a>            
</span><span id="HealthCheckService-399"><a href="#HealthCheckService-399"><span class="linenos">399</span></a>        <span class="c1"># Rest of the existing checks...</span>
</span><span id="HealthCheckService-400"><a href="#HealthCheckService-400"><span class="linenos">400</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">check_dependencies</span><span class="p">()</span>
</span><span id="HealthCheckService-401"><a href="#HealthCheckService-401"><span class="linenos">401</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">run_custom_checks</span><span class="p">()</span>
</span><span id="HealthCheckService-402"><a href="#HealthCheckService-402"><span class="linenos">402</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">check_streamlit_pages</span><span class="p">()</span>
</span><span id="HealthCheckService-403"><a href="#HealthCheckService-403"><span class="linenos">403</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_update_overall_status</span><span class="p">()</span>
</span><span id="HealthCheckService-404"><a href="#HealthCheckService-404"><span class="linenos">404</span></a>        
</span><span id="HealthCheckService-405"><a href="#HealthCheckService-405"><span class="linenos">405</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_cpu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="HealthCheckService-406"><a href="#HealthCheckService-406"><span class="linenos">406</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HealthCheckService-407"><a href="#HealthCheckService-407"><span class="linenos">407</span></a><span class="sd">        Checks the current CPU usage and updates the health status based on configured thresholds.</span>
</span><span id="HealthCheckService-408"><a href="#HealthCheckService-408"><span class="linenos">408</span></a><span class="sd">        Measures the CPU usage percentage over a 1-second interval using psutil. Compares the result</span>
</span><span id="HealthCheckService-409"><a href="#HealthCheckService-409"><span class="linenos">409</span></a><span class="sd">        against warning and critical thresholds defined in the configuration. Sets the status to</span>
</span><span id="HealthCheckService-410"><a href="#HealthCheckService-410"><span class="linenos">410</span></a><span class="sd">        &#39;healthy&#39;, &#39;warning&#39;, or &#39;critical&#39; accordingly, and updates the health data dictionary.</span>
</span><span id="HealthCheckService-411"><a href="#HealthCheckService-411"><span class="linenos">411</span></a><span class="sd">        Returns:</span>
</span><span id="HealthCheckService-412"><a href="#HealthCheckService-412"><span class="linenos">412</span></a><span class="sd">            None</span>
</span><span id="HealthCheckService-413"><a href="#HealthCheckService-413"><span class="linenos">413</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HealthCheckService-414"><a href="#HealthCheckService-414"><span class="linenos">414</span></a>        
</span><span id="HealthCheckService-415"><a href="#HealthCheckService-415"><span class="linenos">415</span></a>        <span class="n">cpu_percent</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">cpu_percent</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="HealthCheckService-416"><a href="#HealthCheckService-416"><span class="linenos">416</span></a>        <span class="n">warning_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cpu_warning&quot;</span><span class="p">,</span> <span class="mi">70</span><span class="p">)</span>
</span><span id="HealthCheckService-417"><a href="#HealthCheckService-417"><span class="linenos">417</span></a>        <span class="n">critical_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cpu_critical&quot;</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
</span><span id="HealthCheckService-418"><a href="#HealthCheckService-418"><span class="linenos">418</span></a>        
</span><span id="HealthCheckService-419"><a href="#HealthCheckService-419"><span class="linenos">419</span></a>        <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;healthy&quot;</span>
</span><span id="HealthCheckService-420"><a href="#HealthCheckService-420"><span class="linenos">420</span></a>        <span class="k">if</span> <span class="n">cpu_percent</span> <span class="o">&gt;=</span> <span class="n">critical_threshold</span><span class="p">:</span>
</span><span id="HealthCheckService-421"><a href="#HealthCheckService-421"><span class="linenos">421</span></a>            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;critical&quot;</span>
</span><span id="HealthCheckService-422"><a href="#HealthCheckService-422"><span class="linenos">422</span></a>        <span class="k">elif</span> <span class="n">cpu_percent</span> <span class="o">&gt;=</span> <span class="n">warning_threshold</span><span class="p">:</span>
</span><span id="HealthCheckService-423"><a href="#HealthCheckService-423"><span class="linenos">423</span></a>            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;warning&quot;</span>
</span><span id="HealthCheckService-424"><a href="#HealthCheckService-424"><span class="linenos">424</span></a>            
</span><span id="HealthCheckService-425"><a href="#HealthCheckService-425"><span class="linenos">425</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;system&quot;</span><span class="p">][</span><span class="s2">&quot;cpu&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="HealthCheckService-426"><a href="#HealthCheckService-426"><span class="linenos">426</span></a>            <span class="s2">&quot;usage_percent&quot;</span><span class="p">:</span> <span class="n">cpu_percent</span><span class="p">,</span>
</span><span id="HealthCheckService-427"><a href="#HealthCheckService-427"><span class="linenos">427</span></a>            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">status</span>
</span><span id="HealthCheckService-428"><a href="#HealthCheckService-428"><span class="linenos">428</span></a>        <span class="p">}</span>
</span><span id="HealthCheckService-429"><a href="#HealthCheckService-429"><span class="linenos">429</span></a>        
</span><span id="HealthCheckService-430"><a href="#HealthCheckService-430"><span class="linenos">430</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_memory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="HealthCheckService-431"><a href="#HealthCheckService-431"><span class="linenos">431</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HealthCheckService-432"><a href="#HealthCheckService-432"><span class="linenos">432</span></a><span class="sd">        Checks the system&#39;s memory usage and updates the health status accordingly.</span>
</span><span id="HealthCheckService-433"><a href="#HealthCheckService-433"><span class="linenos">433</span></a><span class="sd">        Retrieves the current memory usage statistics using psutil, compares the usage percentage</span>
</span><span id="HealthCheckService-434"><a href="#HealthCheckService-434"><span class="linenos">434</span></a><span class="sd">        against configured warning and critical thresholds, and sets the memory status to &#39;healthy&#39;,</span>
</span><span id="HealthCheckService-435"><a href="#HealthCheckService-435"><span class="linenos">435</span></a><span class="sd">        &#39;warning&#39;, or &#39;critical&#39;. Updates the health_data dictionary with total memory, available memory,</span>
</span><span id="HealthCheckService-436"><a href="#HealthCheckService-436"><span class="linenos">436</span></a><span class="sd">        usage percentage, and status.</span>
</span><span id="HealthCheckService-437"><a href="#HealthCheckService-437"><span class="linenos">437</span></a><span class="sd">        Returns:</span>
</span><span id="HealthCheckService-438"><a href="#HealthCheckService-438"><span class="linenos">438</span></a><span class="sd">            None</span>
</span><span id="HealthCheckService-439"><a href="#HealthCheckService-439"><span class="linenos">439</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HealthCheckService-440"><a href="#HealthCheckService-440"><span class="linenos">440</span></a>        
</span><span id="HealthCheckService-441"><a href="#HealthCheckService-441"><span class="linenos">441</span></a>        <span class="n">memory</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span>
</span><span id="HealthCheckService-442"><a href="#HealthCheckService-442"><span class="linenos">442</span></a>        <span class="n">memory_percent</span> <span class="o">=</span> <span class="n">memory</span><span class="o">.</span><span class="n">percent</span>
</span><span id="HealthCheckService-443"><a href="#HealthCheckService-443"><span class="linenos">443</span></a>        <span class="n">warning_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_warning&quot;</span><span class="p">,</span> <span class="mi">70</span><span class="p">)</span>
</span><span id="HealthCheckService-444"><a href="#HealthCheckService-444"><span class="linenos">444</span></a>        <span class="n">critical_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_critical&quot;</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
</span><span id="HealthCheckService-445"><a href="#HealthCheckService-445"><span class="linenos">445</span></a>        
</span><span id="HealthCheckService-446"><a href="#HealthCheckService-446"><span class="linenos">446</span></a>        <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;healthy&quot;</span>
</span><span id="HealthCheckService-447"><a href="#HealthCheckService-447"><span class="linenos">447</span></a>        <span class="k">if</span> <span class="n">memory_percent</span> <span class="o">&gt;=</span> <span class="n">critical_threshold</span><span class="p">:</span>
</span><span id="HealthCheckService-448"><a href="#HealthCheckService-448"><span class="linenos">448</span></a>            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;critical&quot;</span>
</span><span id="HealthCheckService-449"><a href="#HealthCheckService-449"><span class="linenos">449</span></a>        <span class="k">elif</span> <span class="n">memory_percent</span> <span class="o">&gt;=</span> <span class="n">warning_threshold</span><span class="p">:</span>
</span><span id="HealthCheckService-450"><a href="#HealthCheckService-450"><span class="linenos">450</span></a>            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;warning&quot;</span>
</span><span id="HealthCheckService-451"><a href="#HealthCheckService-451"><span class="linenos">451</span></a>            
</span><span id="HealthCheckService-452"><a href="#HealthCheckService-452"><span class="linenos">452</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;system&quot;</span><span class="p">][</span><span class="s2">&quot;memory&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="HealthCheckService-453"><a href="#HealthCheckService-453"><span class="linenos">453</span></a>            <span class="s2">&quot;total_gb&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">memory</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="HealthCheckService-454"><a href="#HealthCheckService-454"><span class="linenos">454</span></a>            <span class="s2">&quot;available_gb&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">memory</span><span class="o">.</span><span class="n">available</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="HealthCheckService-455"><a href="#HealthCheckService-455"><span class="linenos">455</span></a>            <span class="s2">&quot;usage_percent&quot;</span><span class="p">:</span> <span class="n">memory_percent</span><span class="p">,</span>
</span><span id="HealthCheckService-456"><a href="#HealthCheckService-456"><span class="linenos">456</span></a>            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">status</span>
</span><span id="HealthCheckService-457"><a href="#HealthCheckService-457"><span class="linenos">457</span></a>        <span class="p">}</span>
</span><span id="HealthCheckService-458"><a href="#HealthCheckService-458"><span class="linenos">458</span></a>        
</span><span id="HealthCheckService-459"><a href="#HealthCheckService-459"><span class="linenos">459</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="HealthCheckService-460"><a href="#HealthCheckService-460"><span class="linenos">460</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HealthCheckService-461"><a href="#HealthCheckService-461"><span class="linenos">461</span></a><span class="sd">        Checks the disk usage of the root filesystem and updates the health status.</span>
</span><span id="HealthCheckService-462"><a href="#HealthCheckService-462"><span class="linenos">462</span></a><span class="sd">        Retrieves disk usage statistics using psutil, compares the usage percentage</span>
</span><span id="HealthCheckService-463"><a href="#HealthCheckService-463"><span class="linenos">463</span></a><span class="sd">        against configured warning and critical thresholds, and sets the disk status</span>
</span><span id="HealthCheckService-464"><a href="#HealthCheckService-464"><span class="linenos">464</span></a><span class="sd">        accordingly (&quot;healthy&quot;, &quot;warning&quot;, or &quot;critical&quot;). Updates the health_data</span>
</span><span id="HealthCheckService-465"><a href="#HealthCheckService-465"><span class="linenos">465</span></a><span class="sd">        dictionary with total disk size, free space, usage percentage, and status.</span>
</span><span id="HealthCheckService-466"><a href="#HealthCheckService-466"><span class="linenos">466</span></a><span class="sd">        Returns:</span>
</span><span id="HealthCheckService-467"><a href="#HealthCheckService-467"><span class="linenos">467</span></a><span class="sd">            None</span>
</span><span id="HealthCheckService-468"><a href="#HealthCheckService-468"><span class="linenos">468</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HealthCheckService-469"><a href="#HealthCheckService-469"><span class="linenos">469</span></a>        
</span><span id="HealthCheckService-470"><a href="#HealthCheckService-470"><span class="linenos">470</span></a>        <span class="n">disk</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">disk_usage</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span><span id="HealthCheckService-471"><a href="#HealthCheckService-471"><span class="linenos">471</span></a>        <span class="n">disk_percent</span> <span class="o">=</span> <span class="n">disk</span><span class="o">.</span><span class="n">percent</span>
</span><span id="HealthCheckService-472"><a href="#HealthCheckService-472"><span class="linenos">472</span></a>        <span class="n">warning_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;disk_warning&quot;</span><span class="p">,</span> <span class="mi">70</span><span class="p">)</span>
</span><span id="HealthCheckService-473"><a href="#HealthCheckService-473"><span class="linenos">473</span></a>        <span class="n">critical_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;disk_critical&quot;</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
</span><span id="HealthCheckService-474"><a href="#HealthCheckService-474"><span class="linenos">474</span></a>        
</span><span id="HealthCheckService-475"><a href="#HealthCheckService-475"><span class="linenos">475</span></a>        <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;healthy&quot;</span>
</span><span id="HealthCheckService-476"><a href="#HealthCheckService-476"><span class="linenos">476</span></a>        <span class="k">if</span> <span class="n">disk_percent</span> <span class="o">&gt;=</span> <span class="n">critical_threshold</span><span class="p">:</span>
</span><span id="HealthCheckService-477"><a href="#HealthCheckService-477"><span class="linenos">477</span></a>            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;critical&quot;</span>
</span><span id="HealthCheckService-478"><a href="#HealthCheckService-478"><span class="linenos">478</span></a>        <span class="k">elif</span> <span class="n">disk_percent</span> <span class="o">&gt;=</span> <span class="n">warning_threshold</span><span class="p">:</span>
</span><span id="HealthCheckService-479"><a href="#HealthCheckService-479"><span class="linenos">479</span></a>            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;warning&quot;</span>
</span><span id="HealthCheckService-480"><a href="#HealthCheckService-480"><span class="linenos">480</span></a>            
</span><span id="HealthCheckService-481"><a href="#HealthCheckService-481"><span class="linenos">481</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;system&quot;</span><span class="p">][</span><span class="s2">&quot;disk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="HealthCheckService-482"><a href="#HealthCheckService-482"><span class="linenos">482</span></a>            <span class="s2">&quot;total_gb&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">disk</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="HealthCheckService-483"><a href="#HealthCheckService-483"><span class="linenos">483</span></a>            <span class="s2">&quot;free_gb&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">disk</span><span class="o">.</span><span class="n">free</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="HealthCheckService-484"><a href="#HealthCheckService-484"><span class="linenos">484</span></a>            <span class="s2">&quot;usage_percent&quot;</span><span class="p">:</span> <span class="n">disk_percent</span><span class="p">,</span>
</span><span id="HealthCheckService-485"><a href="#HealthCheckService-485"><span class="linenos">485</span></a>            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">status</span>
</span><span id="HealthCheckService-486"><a href="#HealthCheckService-486"><span class="linenos">486</span></a>        <span class="p">}</span>
</span><span id="HealthCheckService-487"><a href="#HealthCheckService-487"><span class="linenos">487</span></a>        
</span><span id="HealthCheckService-488"><a href="#HealthCheckService-488"><span class="linenos">488</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_dependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="HealthCheckService-489"><a href="#HealthCheckService-489"><span class="linenos">489</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HealthCheckService-490"><a href="#HealthCheckService-490"><span class="linenos">490</span></a><span class="sd">        Checks the health of configured dependencies, including API endpoints and databases.</span>
</span><span id="HealthCheckService-491"><a href="#HealthCheckService-491"><span class="linenos">491</span></a><span class="sd">        Iterates through the list of API endpoints and databases specified in the configuration,</span>
</span><span id="HealthCheckService-492"><a href="#HealthCheckService-492"><span class="linenos">492</span></a><span class="sd">        and performs health checks on each by invoking the corresponding internal methods.</span>
</span><span id="HealthCheckService-493"><a href="#HealthCheckService-493"><span class="linenos">493</span></a><span class="sd">        Raises:</span>
</span><span id="HealthCheckService-494"><a href="#HealthCheckService-494"><span class="linenos">494</span></a><span class="sd">            Exception: If any dependency check fails.</span>
</span><span id="HealthCheckService-495"><a href="#HealthCheckService-495"><span class="linenos">495</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HealthCheckService-496"><a href="#HealthCheckService-496"><span class="linenos">496</span></a>        
</span><span id="HealthCheckService-497"><a href="#HealthCheckService-497"><span class="linenos">497</span></a>        <span class="c1"># Check API endpoints</span>
</span><span id="HealthCheckService-498"><a href="#HealthCheckService-498"><span class="linenos">498</span></a>        <span class="k">for</span> <span class="n">endpoint</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;dependencies&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api_endpoints&quot;</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="HealthCheckService-499"><a href="#HealthCheckService-499"><span class="linenos">499</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_check_api_endpoint</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>
</span><span id="HealthCheckService-500"><a href="#HealthCheckService-500"><span class="linenos">500</span></a>            
</span><span id="HealthCheckService-501"><a href="#HealthCheckService-501"><span class="linenos">501</span></a>        <span class="c1"># Check database connections</span>
</span><span id="HealthCheckService-502"><a href="#HealthCheckService-502"><span class="linenos">502</span></a>        <span class="k">for</span> <span class="n">db</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;dependencies&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;databases&quot;</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="HealthCheckService-503"><a href="#HealthCheckService-503"><span class="linenos">503</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_check_database</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
</span><span id="HealthCheckService-504"><a href="#HealthCheckService-504"><span class="linenos">504</span></a>            
</span><span id="HealthCheckService-505"><a href="#HealthCheckService-505"><span class="linenos">505</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_api_endpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">:</span> <span class="n">Dict</span><span class="p">):</span>
</span><span id="HealthCheckService-506"><a href="#HealthCheckService-506"><span class="linenos">506</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HealthCheckService-507"><a href="#HealthCheckService-507"><span class="linenos">507</span></a><span class="sd">        Check if an API endpoint is accessible.</span>
</span><span id="HealthCheckService-508"><a href="#HealthCheckService-508"><span class="linenos">508</span></a><span class="sd">        </span>
</span><span id="HealthCheckService-509"><a href="#HealthCheckService-509"><span class="linenos">509</span></a><span class="sd">        Args:</span>
</span><span id="HealthCheckService-510"><a href="#HealthCheckService-510"><span class="linenos">510</span></a><span class="sd">            endpoint: Dictionary with endpoint configuration</span>
</span><span id="HealthCheckService-511"><a href="#HealthCheckService-511"><span class="linenos">511</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HealthCheckService-512"><a href="#HealthCheckService-512"><span class="linenos">512</span></a>        <span class="n">name</span> <span class="o">=</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown_api&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService-513"><a href="#HealthCheckService-513"><span class="linenos">513</span></a>        <span class="n">url</span> <span class="o">=</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService-514"><a href="#HealthCheckService-514"><span class="linenos">514</span></a>        <span class="n">timeout</span> <span class="o">=</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timeout&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span><span id="HealthCheckService-515"><a href="#HealthCheckService-515"><span class="linenos">515</span></a>        
</span><span id="HealthCheckService-516"><a href="#HealthCheckService-516"><span class="linenos">516</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">url</span><span class="p">:</span>
</span><span id="HealthCheckService-517"><a href="#HealthCheckService-517"><span class="linenos">517</span></a>            <span class="k">return</span>
</span><span id="HealthCheckService-518"><a href="#HealthCheckService-518"><span class="linenos">518</span></a>            
</span><span id="HealthCheckService-519"><a href="#HealthCheckService-519"><span class="linenos">519</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="HealthCheckService-520"><a href="#HealthCheckService-520"><span class="linenos">520</span></a>            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="HealthCheckService-521"><a href="#HealthCheckService-521"><span class="linenos">521</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
</span><span id="HealthCheckService-522"><a href="#HealthCheckService-522"><span class="linenos">522</span></a>            <span class="n">response_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
</span><span id="HealthCheckService-523"><a href="#HealthCheckService-523"><span class="linenos">523</span></a>            
</span><span id="HealthCheckService-524"><a href="#HealthCheckService-524"><span class="linenos">524</span></a>            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;healthy&quot;</span> <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&lt;</span> <span class="mi">400</span> <span class="k">else</span> <span class="s2">&quot;critical&quot;</span>
</span><span id="HealthCheckService-525"><a href="#HealthCheckService-525"><span class="linenos">525</span></a>            
</span><span id="HealthCheckService-526"><a href="#HealthCheckService-526"><span class="linenos">526</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;dependencies&quot;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="HealthCheckService-527"><a href="#HealthCheckService-527"><span class="linenos">527</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;api&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService-528"><a href="#HealthCheckService-528"><span class="linenos">528</span></a>                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
</span><span id="HealthCheckService-529"><a href="#HealthCheckService-529"><span class="linenos">529</span></a>                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">status</span><span class="p">,</span>
</span><span id="HealthCheckService-530"><a href="#HealthCheckService-530"><span class="linenos">530</span></a>                <span class="s2">&quot;response_time_ms&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">response_time</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="HealthCheckService-531"><a href="#HealthCheckService-531"><span class="linenos">531</span></a>                <span class="s2">&quot;status_code&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>
</span><span id="HealthCheckService-532"><a href="#HealthCheckService-532"><span class="linenos">532</span></a>            <span class="p">}</span>
</span><span id="HealthCheckService-533"><a href="#HealthCheckService-533"><span class="linenos">533</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="HealthCheckService-534"><a href="#HealthCheckService-534"><span class="linenos">534</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;dependencies&quot;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="HealthCheckService-535"><a href="#HealthCheckService-535"><span class="linenos">535</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;api&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService-536"><a href="#HealthCheckService-536"><span class="linenos">536</span></a>                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span>
</span><span id="HealthCheckService-537"><a href="#HealthCheckService-537"><span class="linenos">537</span></a>                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;critical&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService-538"><a href="#HealthCheckService-538"><span class="linenos">538</span></a>                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="HealthCheckService-539"><a href="#HealthCheckService-539"><span class="linenos">539</span></a>            <span class="p">}</span>
</span><span id="HealthCheckService-540"><a href="#HealthCheckService-540"><span class="linenos">540</span></a>            
</span><span id="HealthCheckService-541"><a href="#HealthCheckService-541"><span class="linenos">541</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">):</span>
</span><span id="HealthCheckService-542"><a href="#HealthCheckService-542"><span class="linenos">542</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HealthCheckService-543"><a href="#HealthCheckService-543"><span class="linenos">543</span></a><span class="sd">        Check database connection.</span>
</span><span id="HealthCheckService-544"><a href="#HealthCheckService-544"><span class="linenos">544</span></a><span class="sd">        Note: This is a placeholder. You&#39;ll need to implement specific database checks</span>
</span><span id="HealthCheckService-545"><a href="#HealthCheckService-545"><span class="linenos">545</span></a><span class="sd">        based on your application&#39;s needs.</span>
</span><span id="HealthCheckService-546"><a href="#HealthCheckService-546"><span class="linenos">546</span></a><span class="sd">        </span>
</span><span id="HealthCheckService-547"><a href="#HealthCheckService-547"><span class="linenos">547</span></a><span class="sd">        Args:</span>
</span><span id="HealthCheckService-548"><a href="#HealthCheckService-548"><span class="linenos">548</span></a><span class="sd">            db_config: Dictionary with database configuration</span>
</span><span id="HealthCheckService-549"><a href="#HealthCheckService-549"><span class="linenos">549</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HealthCheckService-550"><a href="#HealthCheckService-550"><span class="linenos">550</span></a>        <span class="n">name</span> <span class="o">=</span> <span class="n">db_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown_db&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService-551"><a href="#HealthCheckService-551"><span class="linenos">551</span></a>        <span class="n">db_type</span> <span class="o">=</span> <span class="n">db_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService-552"><a href="#HealthCheckService-552"><span class="linenos">552</span></a>        
</span><span id="HealthCheckService-553"><a href="#HealthCheckService-553"><span class="linenos">553</span></a>        <span class="c1"># Placeholder for database connection check</span>
</span><span id="HealthCheckService-554"><a href="#HealthCheckService-554"><span class="linenos">554</span></a>        <span class="c1"># In a real implementation, you would check the specific database connection</span>
</span><span id="HealthCheckService-555"><a href="#HealthCheckService-555"><span class="linenos">555</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;dependencies&quot;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="HealthCheckService-556"><a href="#HealthCheckService-556"><span class="linenos">556</span></a>            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;database&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService-557"><a href="#HealthCheckService-557"><span class="linenos">557</span></a>            <span class="s2">&quot;db_type&quot;</span><span class="p">:</span> <span class="n">db_type</span><span class="p">,</span>
</span><span id="HealthCheckService-558"><a href="#HealthCheckService-558"><span class="linenos">558</span></a>            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;unknown&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService-559"><a href="#HealthCheckService-559"><span class="linenos">559</span></a>            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Database check not implemented&quot;</span>
</span><span id="HealthCheckService-560"><a href="#HealthCheckService-560"><span class="linenos">560</span></a>        <span class="p">}</span>
</span><span id="HealthCheckService-561"><a href="#HealthCheckService-561"><span class="linenos">561</span></a>        
</span><span id="HealthCheckService-562"><a href="#HealthCheckService-562"><span class="linenos">562</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">register_custom_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">check_func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]):</span>
</span><span id="HealthCheckService-563"><a href="#HealthCheckService-563"><span class="linenos">563</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HealthCheckService-564"><a href="#HealthCheckService-564"><span class="linenos">564</span></a><span class="sd">        Register a custom health check function.</span>
</span><span id="HealthCheckService-565"><a href="#HealthCheckService-565"><span class="linenos">565</span></a><span class="sd">        </span>
</span><span id="HealthCheckService-566"><a href="#HealthCheckService-566"><span class="linenos">566</span></a><span class="sd">        Args:</span>
</span><span id="HealthCheckService-567"><a href="#HealthCheckService-567"><span class="linenos">567</span></a><span class="sd">            name: Name of the custom check</span>
</span><span id="HealthCheckService-568"><a href="#HealthCheckService-568"><span class="linenos">568</span></a><span class="sd">            check_func: Function that performs the check and returns a dictionary with results</span>
</span><span id="HealthCheckService-569"><a href="#HealthCheckService-569"><span class="linenos">569</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HealthCheckService-570"><a href="#HealthCheckService-570"><span class="linenos">570</span></a>        <span class="k">if</span> <span class="s2">&quot;custom_checks&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">:</span>
</span><span id="HealthCheckService-571"><a href="#HealthCheckService-571"><span class="linenos">571</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;custom_checks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="HealthCheckService-572"><a href="#HealthCheckService-572"><span class="linenos">572</span></a>            
</span><span id="HealthCheckService-573"><a href="#HealthCheckService-573"><span class="linenos">573</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;custom_checks&quot;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="HealthCheckService-574"><a href="#HealthCheckService-574"><span class="linenos">574</span></a>            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;unknown&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService-575"><a href="#HealthCheckService-575"><span class="linenos">575</span></a>            <span class="s2">&quot;check_func&quot;</span><span class="p">:</span> <span class="n">check_func</span>
</span><span id="HealthCheckService-576"><a href="#HealthCheckService-576"><span class="linenos">576</span></a>        <span class="p">}</span>
</span><span id="HealthCheckService-577"><a href="#HealthCheckService-577"><span class="linenos">577</span></a>        
</span><span id="HealthCheckService-578"><a href="#HealthCheckService-578"><span class="linenos">578</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run_custom_checks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="HealthCheckService-579"><a href="#HealthCheckService-579"><span class="linenos">579</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Run all registered custom health checks.&quot;&quot;&quot;</span>
</span><span id="HealthCheckService-580"><a href="#HealthCheckService-580"><span class="linenos">580</span></a>        <span class="k">if</span> <span class="s2">&quot;custom_checks&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">:</span>
</span><span id="HealthCheckService-581"><a href="#HealthCheckService-581"><span class="linenos">581</span></a>            <span class="k">return</span>
</span><span id="HealthCheckService-582"><a href="#HealthCheckService-582"><span class="linenos">582</span></a>            
</span><span id="HealthCheckService-583"><a href="#HealthCheckService-583"><span class="linenos">583</span></a>        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">check_info</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;custom_checks&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
</span><span id="HealthCheckService-584"><a href="#HealthCheckService-584"><span class="linenos">584</span></a>            <span class="k">if</span> <span class="s2">&quot;check_func&quot;</span> <span class="ow">in</span> <span class="n">check_info</span> <span class="ow">and</span> <span class="nb">callable</span><span class="p">(</span><span class="n">check_info</span><span class="p">[</span><span class="s2">&quot;check_func&quot;</span><span class="p">]):</span>
</span><span id="HealthCheckService-585"><a href="#HealthCheckService-585"><span class="linenos">585</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="HealthCheckService-586"><a href="#HealthCheckService-586"><span class="linenos">586</span></a>                    <span class="n">result</span> <span class="o">=</span> <span class="n">check_info</span><span class="p">[</span><span class="s2">&quot;check_func&quot;</span><span class="p">]()</span>
</span><span id="HealthCheckService-587"><a href="#HealthCheckService-587"><span class="linenos">587</span></a>                    <span class="c1"># Remove the function reference from the result</span>
</span><span id="HealthCheckService-588"><a href="#HealthCheckService-588"><span class="linenos">588</span></a>                    <span class="n">func</span> <span class="o">=</span> <span class="n">check_info</span><span class="p">[</span><span class="s2">&quot;check_func&quot;</span><span class="p">]</span>
</span><span id="HealthCheckService-589"><a href="#HealthCheckService-589"><span class="linenos">589</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;custom_checks&quot;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="HealthCheckService-590"><a href="#HealthCheckService-590"><span class="linenos">590</span></a>                    <span class="c1"># Add the function back</span>
</span><span id="HealthCheckService-591"><a href="#HealthCheckService-591"><span class="linenos">591</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;custom_checks&quot;</span><span class="p">][</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;check_func&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span>
</span><span id="HealthCheckService-592"><a href="#HealthCheckService-592"><span class="linenos">592</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="HealthCheckService-593"><a href="#HealthCheckService-593"><span class="linenos">593</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;custom_checks&quot;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="HealthCheckService-594"><a href="#HealthCheckService-594"><span class="linenos">594</span></a>                        <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;critical&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService-595"><a href="#HealthCheckService-595"><span class="linenos">595</span></a>                        <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="HealthCheckService-596"><a href="#HealthCheckService-596"><span class="linenos">596</span></a>                        <span class="s2">&quot;check_func&quot;</span><span class="p">:</span> <span class="n">check_info</span><span class="p">[</span><span class="s2">&quot;check_func&quot;</span><span class="p">]</span>
</span><span id="HealthCheckService-597"><a href="#HealthCheckService-597"><span class="linenos">597</span></a>                    <span class="p">}</span>
</span><span id="HealthCheckService-598"><a href="#HealthCheckService-598"><span class="linenos">598</span></a>                    
</span><span id="HealthCheckService-599"><a href="#HealthCheckService-599"><span class="linenos">599</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_update_overall_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="HealthCheckService-600"><a href="#HealthCheckService-600"><span class="linenos">600</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HealthCheckService-601"><a href="#HealthCheckService-601"><span class="linenos">601</span></a><span class="sd">        Updates the overall health status of the application based on the statuses of various components.</span>
</span><span id="HealthCheckService-602"><a href="#HealthCheckService-602"><span class="linenos">602</span></a><span class="sd">        The method checks the health status of the following components:</span>
</span><span id="HealthCheckService-603"><a href="#HealthCheckService-603"><span class="linenos">603</span></a><span class="sd">            - Streamlit server</span>
</span><span id="HealthCheckService-604"><a href="#HealthCheckService-604"><span class="linenos">604</span></a><span class="sd">            - System checks</span>
</span><span id="HealthCheckService-605"><a href="#HealthCheckService-605"><span class="linenos">605</span></a><span class="sd">            - Dependencies</span>
</span><span id="HealthCheckService-606"><a href="#HealthCheckService-606"><span class="linenos">606</span></a><span class="sd">            - Custom checks (excluding those with a &#39;check_func&#39; key)</span>
</span><span id="HealthCheckService-607"><a href="#HealthCheckService-607"><span class="linenos">607</span></a><span class="sd">            - Streamlit pages</span>
</span><span id="HealthCheckService-608"><a href="#HealthCheckService-608"><span class="linenos">608</span></a><span class="sd">        The overall status is determined using the following priority order:</span>
</span><span id="HealthCheckService-609"><a href="#HealthCheckService-609"><span class="linenos">609</span></a><span class="sd">            1. &quot;critical&quot; if any component is critical</span>
</span><span id="HealthCheckService-610"><a href="#HealthCheckService-610"><span class="linenos">610</span></a><span class="sd">            2. &quot;warning&quot; if any component is warning and none are critical</span>
</span><span id="HealthCheckService-611"><a href="#HealthCheckService-611"><span class="linenos">611</span></a><span class="sd">            3. &quot;unknown&quot; if any component is unknown and none are critical or warning, and no healthy components exist</span>
</span><span id="HealthCheckService-612"><a href="#HealthCheckService-612"><span class="linenos">612</span></a><span class="sd">            4. &quot;healthy&quot; if any component is healthy and none are critical, warning, or unknown</span>
</span><span id="HealthCheckService-613"><a href="#HealthCheckService-613"><span class="linenos">613</span></a><span class="sd">            5. &quot;unknown&quot; if no statuses are found</span>
</span><span id="HealthCheckService-614"><a href="#HealthCheckService-614"><span class="linenos">614</span></a><span class="sd">        The result is stored in `self.health_data[&quot;overall_status&quot;]`.</span>
</span><span id="HealthCheckService-615"><a href="#HealthCheckService-615"><span class="linenos">615</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HealthCheckService-616"><a href="#HealthCheckService-616"><span class="linenos">616</span></a>        
</span><span id="HealthCheckService-617"><a href="#HealthCheckService-617"><span class="linenos">617</span></a>        <span class="n">has_critical</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="HealthCheckService-618"><a href="#HealthCheckService-618"><span class="linenos">618</span></a>        <span class="n">has_warning</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="HealthCheckService-619"><a href="#HealthCheckService-619"><span class="linenos">619</span></a>        <span class="n">has_healthy</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="HealthCheckService-620"><a href="#HealthCheckService-620"><span class="linenos">620</span></a>        <span class="n">has_unknown</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="HealthCheckService-621"><a href="#HealthCheckService-621"><span class="linenos">621</span></a>        
</span><span id="HealthCheckService-622"><a href="#HealthCheckService-622"><span class="linenos">622</span></a>        <span class="c1"># Helper function to check status</span>
</span><span id="HealthCheckService-623"><a href="#HealthCheckService-623"><span class="linenos">623</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">check_component_status</span><span class="p">(</span><span class="n">status</span><span class="p">):</span>
</span><span id="HealthCheckService-624"><a href="#HealthCheckService-624"><span class="linenos">624</span></a>            <span class="k">nonlocal</span> <span class="n">has_critical</span><span class="p">,</span> <span class="n">has_warning</span><span class="p">,</span> <span class="n">has_healthy</span><span class="p">,</span> <span class="n">has_unknown</span>
</span><span id="HealthCheckService-625"><a href="#HealthCheckService-625"><span class="linenos">625</span></a>            <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;critical&quot;</span><span class="p">:</span>
</span><span id="HealthCheckService-626"><a href="#HealthCheckService-626"><span class="linenos">626</span></a>                <span class="n">has_critical</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="HealthCheckService-627"><a href="#HealthCheckService-627"><span class="linenos">627</span></a>            <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;warning&quot;</span><span class="p">:</span>
</span><span id="HealthCheckService-628"><a href="#HealthCheckService-628"><span class="linenos">628</span></a>                <span class="n">has_warning</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="HealthCheckService-629"><a href="#HealthCheckService-629"><span class="linenos">629</span></a>            <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;healthy&quot;</span><span class="p">:</span>
</span><span id="HealthCheckService-630"><a href="#HealthCheckService-630"><span class="linenos">630</span></a>                <span class="n">has_healthy</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="HealthCheckService-631"><a href="#HealthCheckService-631"><span class="linenos">631</span></a>            <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;unknown&quot;</span><span class="p">:</span>
</span><span id="HealthCheckService-632"><a href="#HealthCheckService-632"><span class="linenos">632</span></a>                <span class="n">has_unknown</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="HealthCheckService-633"><a href="#HealthCheckService-633"><span class="linenos">633</span></a>
</span><span id="HealthCheckService-634"><a href="#HealthCheckService-634"><span class="linenos">634</span></a>        <span class="c1"># Check Streamlit server status</span>
</span><span id="HealthCheckService-635"><a href="#HealthCheckService-635"><span class="linenos">635</span></a>        <span class="n">server_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;streamlit_server&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService-636"><a href="#HealthCheckService-636"><span class="linenos">636</span></a>        <span class="n">check_component_status</span><span class="p">(</span><span class="n">server_status</span><span class="p">)</span>
</span><span id="HealthCheckService-637"><a href="#HealthCheckService-637"><span class="linenos">637</span></a>        
</span><span id="HealthCheckService-638"><a href="#HealthCheckService-638"><span class="linenos">638</span></a>        <span class="c1"># Check system status</span>
</span><span id="HealthCheckService-639"><a href="#HealthCheckService-639"><span class="linenos">639</span></a>        <span class="k">for</span> <span class="n">system_check</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="HealthCheckService-640"><a href="#HealthCheckService-640"><span class="linenos">640</span></a>            <span class="n">check_component_status</span><span class="p">(</span><span class="n">system_check</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">))</span>
</span><span id="HealthCheckService-641"><a href="#HealthCheckService-641"><span class="linenos">641</span></a>                    
</span><span id="HealthCheckService-642"><a href="#HealthCheckService-642"><span class="linenos">642</span></a>        <span class="c1"># Check dependencies status</span>
</span><span id="HealthCheckService-643"><a href="#HealthCheckService-643"><span class="linenos">643</span></a>        <span class="k">for</span> <span class="n">dep_check</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dependencies&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="HealthCheckService-644"><a href="#HealthCheckService-644"><span class="linenos">644</span></a>            <span class="n">check_component_status</span><span class="p">(</span><span class="n">dep_check</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">))</span>
</span><span id="HealthCheckService-645"><a href="#HealthCheckService-645"><span class="linenos">645</span></a>                    
</span><span id="HealthCheckService-646"><a href="#HealthCheckService-646"><span class="linenos">646</span></a>        <span class="c1"># Check custom checks status</span>
</span><span id="HealthCheckService-647"><a href="#HealthCheckService-647"><span class="linenos">647</span></a>        <span class="k">for</span> <span class="n">custom_check</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_checks&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="HealthCheckService-648"><a href="#HealthCheckService-648"><span class="linenos">648</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">custom_check</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;check_func&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">custom_check</span><span class="p">:</span>
</span><span id="HealthCheckService-649"><a href="#HealthCheckService-649"><span class="linenos">649</span></a>                <span class="n">check_component_status</span><span class="p">(</span><span class="n">custom_check</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">))</span>
</span><span id="HealthCheckService-650"><a href="#HealthCheckService-650"><span class="linenos">650</span></a>        
</span><span id="HealthCheckService-651"><a href="#HealthCheckService-651"><span class="linenos">651</span></a>        <span class="c1"># Check Streamlit pages status</span>
</span><span id="HealthCheckService-652"><a href="#HealthCheckService-652"><span class="linenos">652</span></a>        <span class="n">pages_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;streamlit_pages&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService-653"><a href="#HealthCheckService-653"><span class="linenos">653</span></a>        <span class="n">check_component_status</span><span class="p">(</span><span class="n">pages_status</span><span class="p">)</span>
</span><span id="HealthCheckService-654"><a href="#HealthCheckService-654"><span class="linenos">654</span></a>                        
</span><span id="HealthCheckService-655"><a href="#HealthCheckService-655"><span class="linenos">655</span></a>        <span class="c1"># Determine overall status with priority:</span>
</span><span id="HealthCheckService-656"><a href="#HealthCheckService-656"><span class="linenos">656</span></a>        <span class="c1"># critical &gt; warning &gt; unknown &gt; healthy</span>
</span><span id="HealthCheckService-657"><a href="#HealthCheckService-657"><span class="linenos">657</span></a>        <span class="k">if</span> <span class="n">has_critical</span><span class="p">:</span>
</span><span id="HealthCheckService-658"><a href="#HealthCheckService-658"><span class="linenos">658</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;overall_status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;critical&quot;</span>
</span><span id="HealthCheckService-659"><a href="#HealthCheckService-659"><span class="linenos">659</span></a>        <span class="k">elif</span> <span class="n">has_warning</span><span class="p">:</span>
</span><span id="HealthCheckService-660"><a href="#HealthCheckService-660"><span class="linenos">660</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;overall_status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;warning&quot;</span>
</span><span id="HealthCheckService-661"><a href="#HealthCheckService-661"><span class="linenos">661</span></a>        <span class="k">elif</span> <span class="n">has_unknown</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">has_healthy</span><span class="p">:</span>
</span><span id="HealthCheckService-662"><a href="#HealthCheckService-662"><span class="linenos">662</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;overall_status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>
</span><span id="HealthCheckService-663"><a href="#HealthCheckService-663"><span class="linenos">663</span></a>        <span class="k">elif</span> <span class="n">has_healthy</span><span class="p">:</span>
</span><span id="HealthCheckService-664"><a href="#HealthCheckService-664"><span class="linenos">664</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;overall_status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;healthy&quot;</span>
</span><span id="HealthCheckService-665"><a href="#HealthCheckService-665"><span class="linenos">665</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="HealthCheckService-666"><a href="#HealthCheckService-666"><span class="linenos">666</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;overall_status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>
</span><span id="HealthCheckService-667"><a href="#HealthCheckService-667"><span class="linenos">667</span></a>                
</span><span id="HealthCheckService-668"><a href="#HealthCheckService-668"><span class="linenos">668</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_health_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="HealthCheckService-669"><a href="#HealthCheckService-669"><span class="linenos">669</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the latest health check data.&quot;&quot;&quot;</span>
</span><span id="HealthCheckService-670"><a href="#HealthCheckService-670"><span class="linenos">670</span></a>        <span class="c1"># Create a copy without the function references</span>
</span><span id="HealthCheckService-671"><a href="#HealthCheckService-671"><span class="linenos">671</span></a>        <span class="n">result</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="HealthCheckService-672"><a href="#HealthCheckService-672"><span class="linenos">672</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="HealthCheckService-673"><a href="#HealthCheckService-673"><span class="linenos">673</span></a>            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;custom_checks&quot;</span><span class="p">:</span>
</span><span id="HealthCheckService-674"><a href="#HealthCheckService-674"><span class="linenos">674</span></a>                <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="HealthCheckService-675"><a href="#HealthCheckService-675"><span class="linenos">675</span></a>                <span class="k">for</span> <span class="n">check_name</span><span class="p">,</span> <span class="n">check_data</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="HealthCheckService-676"><a href="#HealthCheckService-676"><span class="linenos">676</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">check_data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="HealthCheckService-677"><a href="#HealthCheckService-677"><span class="linenos">677</span></a>                        <span class="n">check_copy</span> <span class="o">=</span> <span class="n">check_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="HealthCheckService-678"><a href="#HealthCheckService-678"><span class="linenos">678</span></a>                        <span class="k">if</span> <span class="s2">&quot;check_func&quot;</span> <span class="ow">in</span> <span class="n">check_copy</span><span class="p">:</span>
</span><span id="HealthCheckService-679"><a href="#HealthCheckService-679"><span class="linenos">679</span></a>                            <span class="k">del</span> <span class="n">check_copy</span><span class="p">[</span><span class="s2">&quot;check_func&quot;</span><span class="p">]</span>
</span><span id="HealthCheckService-680"><a href="#HealthCheckService-680"><span class="linenos">680</span></a>                        <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">check_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">check_copy</span>
</span><span id="HealthCheckService-681"><a href="#HealthCheckService-681"><span class="linenos">681</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="HealthCheckService-682"><a href="#HealthCheckService-682"><span class="linenos">682</span></a>                <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="HealthCheckService-683"><a href="#HealthCheckService-683"><span class="linenos">683</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="HealthCheckService-684"><a href="#HealthCheckService-684"><span class="linenos">684</span></a>        
</span><span id="HealthCheckService-685"><a href="#HealthCheckService-685"><span class="linenos">685</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="HealthCheckService-686"><a href="#HealthCheckService-686"><span class="linenos">686</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HealthCheckService-687"><a href="#HealthCheckService-687"><span class="linenos">687</span></a><span class="sd">        Saves the current health check configuration to a JSON file.</span>
</span><span id="HealthCheckService-688"><a href="#HealthCheckService-688"><span class="linenos">688</span></a><span class="sd">        Attempts to write the configuration stored in `self.config` to the file specified by `self.config_path`.</span>
</span><span id="HealthCheckService-689"><a href="#HealthCheckService-689"><span class="linenos">689</span></a><span class="sd">        Displays a success message in the Streamlit app upon successful save.</span>
</span><span id="HealthCheckService-690"><a href="#HealthCheckService-690"><span class="linenos">690</span></a><span class="sd">        Handles and displays appropriate error messages for file not found, permission issues, JSON decoding errors, and other exceptions.</span>
</span><span id="HealthCheckService-691"><a href="#HealthCheckService-691"><span class="linenos">691</span></a><span class="sd">        Raises:</span>
</span><span id="HealthCheckService-692"><a href="#HealthCheckService-692"><span class="linenos">692</span></a><span class="sd">            FileNotFoundError: If the configuration file path does not exist.</span>
</span><span id="HealthCheckService-693"><a href="#HealthCheckService-693"><span class="linenos">693</span></a><span class="sd">            PermissionError: If there are insufficient permissions to write to the file.</span>
</span><span id="HealthCheckService-694"><a href="#HealthCheckService-694"><span class="linenos">694</span></a><span class="sd">            json.JSONDecodeError: If there is an error decoding the JSON data.</span>
</span><span id="HealthCheckService-695"><a href="#HealthCheckService-695"><span class="linenos">695</span></a><span class="sd">            Exception: For any other exceptions encountered during the save process.</span>
</span><span id="HealthCheckService-696"><a href="#HealthCheckService-696"><span class="linenos">696</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HealthCheckService-697"><a href="#HealthCheckService-697"><span class="linenos">697</span></a>        
</span><span id="HealthCheckService-698"><a href="#HealthCheckService-698"><span class="linenos">698</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="HealthCheckService-699"><a href="#HealthCheckService-699"><span class="linenos">699</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="HealthCheckService-700"><a href="#HealthCheckService-700"><span class="linenos">700</span></a>                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="HealthCheckService-701"><a href="#HealthCheckService-701"><span class="linenos">701</span></a>                <span class="n">st</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Health check config saved successfully to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService-702"><a href="#HealthCheckService-702"><span class="linenos">702</span></a>        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span><span id="HealthCheckService-703"><a href="#HealthCheckService-703"><span class="linenos">703</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Configuration file not found: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService-704"><a href="#HealthCheckService-704"><span class="linenos">704</span></a>        <span class="k">except</span> <span class="ne">PermissionError</span><span class="p">:</span>
</span><span id="HealthCheckService-705"><a href="#HealthCheckService-705"><span class="linenos">705</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Permission denied: Unable to write to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService-706"><a href="#HealthCheckService-706"><span class="linenos">706</span></a>        <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
</span><span id="HealthCheckService-707"><a href="#HealthCheckService-707"><span class="linenos">707</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error decoding JSON in config file: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService-708"><a href="#HealthCheckService-708"><span class="linenos">708</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="HealthCheckService-709"><a href="#HealthCheckService-709"><span class="linenos">709</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error saving health check config: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService-710"><a href="#HealthCheckService-710"><span class="linenos">710</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_streamlit_pages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="HealthCheckService-711"><a href="#HealthCheckService-711"><span class="linenos">711</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HealthCheckService-712"><a href="#HealthCheckService-712"><span class="linenos">712</span></a><span class="sd">        Checks for errors in Streamlit pages and updates the health data accordingly.</span>
</span><span id="HealthCheckService-713"><a href="#HealthCheckService-713"><span class="linenos">713</span></a><span class="sd">        This method retrieves page errors using StreamlitPageMonitor.get_page_errors().</span>
</span><span id="HealthCheckService-714"><a href="#HealthCheckService-714"><span class="linenos">714</span></a><span class="sd">        If errors are found, it sets the &#39;streamlit_pages&#39; status to &#39;critical&#39; and updates</span>
</span><span id="HealthCheckService-715"><a href="#HealthCheckService-715"><span class="linenos">715</span></a><span class="sd">        the overall health status to &#39;critical&#39;. If no errors are found, it marks the</span>
</span><span id="HealthCheckService-716"><a href="#HealthCheckService-716"><span class="linenos">716</span></a><span class="sd">        &#39;streamlit_pages&#39; status as &#39;healthy&#39;.</span>
</span><span id="HealthCheckService-717"><a href="#HealthCheckService-717"><span class="linenos">717</span></a><span class="sd">        Updates:</span>
</span><span id="HealthCheckService-718"><a href="#HealthCheckService-718"><span class="linenos">718</span></a><span class="sd">            self.health_data[&quot;streamlit_pages&quot;]: Dict containing status, error count, errors, and details.</span>
</span><span id="HealthCheckService-719"><a href="#HealthCheckService-719"><span class="linenos">719</span></a><span class="sd">            self.health_data[&quot;overall_status&quot;]: Set to &#39;critical&#39; if errors are detected.</span>
</span><span id="HealthCheckService-720"><a href="#HealthCheckService-720"><span class="linenos">720</span></a><span class="sd">        Returns:</span>
</span><span id="HealthCheckService-721"><a href="#HealthCheckService-721"><span class="linenos">721</span></a><span class="sd">            None</span>
</span><span id="HealthCheckService-722"><a href="#HealthCheckService-722"><span class="linenos">722</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HealthCheckService-723"><a href="#HealthCheckService-723"><span class="linenos">723</span></a>        
</span><span id="HealthCheckService-724"><a href="#HealthCheckService-724"><span class="linenos">724</span></a>        <span class="n">page_errors</span> <span class="o">=</span> <span class="n">StreamlitPageMonitor</span><span class="o">.</span><span class="n">get_page_errors</span><span class="p">()</span>
</span><span id="HealthCheckService-725"><a href="#HealthCheckService-725"><span class="linenos">725</span></a>        
</span><span id="HealthCheckService-726"><a href="#HealthCheckService-726"><span class="linenos">726</span></a>        <span class="k">if</span> <span class="s2">&quot;streamlit_pages&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">:</span>
</span><span id="HealthCheckService-727"><a href="#HealthCheckService-727"><span class="linenos">727</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;streamlit_pages&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="HealthCheckService-728"><a href="#HealthCheckService-728"><span class="linenos">728</span></a>        
</span><span id="HealthCheckService-729"><a href="#HealthCheckService-729"><span class="linenos">729</span></a>        <span class="k">if</span> <span class="n">page_errors</span><span class="p">:</span>
</span><span id="HealthCheckService-730"><a href="#HealthCheckService-730"><span class="linenos">730</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;streamlit_pages&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="HealthCheckService-731"><a href="#HealthCheckService-731"><span class="linenos">731</span></a>                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;critical&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService-732"><a href="#HealthCheckService-732"><span class="linenos">732</span></a>                <span class="s2">&quot;error_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">page_errors</span><span class="p">),</span>
</span><span id="HealthCheckService-733"><a href="#HealthCheckService-733"><span class="linenos">733</span></a>                <span class="s2">&quot;errors&quot;</span><span class="p">:</span> <span class="n">page_errors</span><span class="p">,</span>
</span><span id="HealthCheckService-734"><a href="#HealthCheckService-734"><span class="linenos">734</span></a>                <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="s2">&quot;Errors detected in Streamlit pages&quot;</span>
</span><span id="HealthCheckService-735"><a href="#HealthCheckService-735"><span class="linenos">735</span></a>            <span class="p">}</span>
</span><span id="HealthCheckService-736"><a href="#HealthCheckService-736"><span class="linenos">736</span></a>            <span class="c1"># This affects overall status</span>
</span><span id="HealthCheckService-737"><a href="#HealthCheckService-737"><span class="linenos">737</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;overall_status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;critical&quot;</span>
</span><span id="HealthCheckService-738"><a href="#HealthCheckService-738"><span class="linenos">738</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="HealthCheckService-739"><a href="#HealthCheckService-739"><span class="linenos">739</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;streamlit_pages&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="HealthCheckService-740"><a href="#HealthCheckService-740"><span class="linenos">740</span></a>                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;healthy&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService-741"><a href="#HealthCheckService-741"><span class="linenos">741</span></a>                <span class="s2">&quot;error_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="HealthCheckService-742"><a href="#HealthCheckService-742"><span class="linenos">742</span></a>                <span class="s2">&quot;errors&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="HealthCheckService-743"><a href="#HealthCheckService-743"><span class="linenos">743</span></a>                <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="s2">&quot;All pages functioning normally&quot;</span>
</span><span id="HealthCheckService-744"><a href="#HealthCheckService-744"><span class="linenos">744</span></a>            <span class="p">}</span>
</span><span id="HealthCheckService-745"><a href="#HealthCheckService-745"><span class="linenos">745</span></a>    
</span><span id="HealthCheckService-746"><a href="#HealthCheckService-746"><span class="linenos">746</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_streamlit_server</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="HealthCheckService-747"><a href="#HealthCheckService-747"><span class="linenos">747</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HealthCheckService-748"><a href="#HealthCheckService-748"><span class="linenos">748</span></a><span class="sd">        Checks the health status of the Streamlit server by sending a GET request to the /healthz endpoint.</span>
</span><span id="HealthCheckService-749"><a href="#HealthCheckService-749"><span class="linenos">749</span></a><span class="sd">        Returns:</span>
</span><span id="HealthCheckService-750"><a href="#HealthCheckService-750"><span class="linenos">750</span></a><span class="sd">            Dict[str, Any]: A dictionary containing the health status, response code, latency in milliseconds,</span>
</span><span id="HealthCheckService-751"><a href="#HealthCheckService-751"><span class="linenos">751</span></a><span class="sd">                            message, and the URL checked. If the server is healthy (HTTP 200), status is &quot;healthy&quot;.</span>
</span><span id="HealthCheckService-752"><a href="#HealthCheckService-752"><span class="linenos">752</span></a><span class="sd">                            Otherwise, status is &quot;critical&quot; with error details.</span>
</span><span id="HealthCheckService-753"><a href="#HealthCheckService-753"><span class="linenos">753</span></a><span class="sd">        Handles:</span>
</span><span id="HealthCheckService-754"><a href="#HealthCheckService-754"><span class="linenos">754</span></a><span class="sd">            - Connection errors: Returns critical status with connection error details.</span>
</span><span id="HealthCheckService-755"><a href="#HealthCheckService-755"><span class="linenos">755</span></a><span class="sd">            - Timeout errors: Returns critical status with timeout error details.</span>
</span><span id="HealthCheckService-756"><a href="#HealthCheckService-756"><span class="linenos">756</span></a><span class="sd">            - Other exceptions: Returns critical status with unknown error details.</span>
</span><span id="HealthCheckService-757"><a href="#HealthCheckService-757"><span class="linenos">757</span></a><span class="sd">        Logs:</span>
</span><span id="HealthCheckService-758"><a href="#HealthCheckService-758"><span class="linenos">758</span></a><span class="sd">            - The URL being checked.</span>
</span><span id="HealthCheckService-759"><a href="#HealthCheckService-759"><span class="linenos">759</span></a><span class="sd">            - The response status code and text.</span>
</span><span id="HealthCheckService-760"><a href="#HealthCheckService-760"><span class="linenos">760</span></a><span class="sd">            - Health status and response time if healthy.</span>
</span><span id="HealthCheckService-761"><a href="#HealthCheckService-761"><span class="linenos">761</span></a><span class="sd">            - Warnings and errors for unhealthy or failed checks.</span>
</span><span id="HealthCheckService-762"><a href="#HealthCheckService-762"><span class="linenos">762</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HealthCheckService-763"><a href="#HealthCheckService-763"><span class="linenos">763</span></a>        
</span><span id="HealthCheckService-764"><a href="#HealthCheckService-764"><span class="linenos">764</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="HealthCheckService-765"><a href="#HealthCheckService-765"><span class="linenos">765</span></a>            <span class="n">host</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">streamlit_url</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span><span id="HealthCheckService-766"><a href="#HealthCheckService-766"><span class="linenos">766</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">host</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;http://&#39;</span><span class="p">,</span> <span class="s1">&#39;https://&#39;</span><span class="p">)):</span>
</span><span id="HealthCheckService-767"><a href="#HealthCheckService-767"><span class="linenos">767</span></a>                <span class="n">host</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;http://</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="HealthCheckService-768"><a href="#HealthCheckService-768"><span class="linenos">768</span></a>            
</span><span id="HealthCheckService-769"><a href="#HealthCheckService-769"><span class="linenos">769</span></a>            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">streamlit_port</span><span class="si">}</span><span class="s2">/healthz&quot;</span>
</span><span id="HealthCheckService-770"><a href="#HealthCheckService-770"><span class="linenos">770</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Checking Streamlit server health at: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService-771"><a href="#HealthCheckService-771"><span class="linenos">771</span></a>            
</span><span id="HealthCheckService-772"><a href="#HealthCheckService-772"><span class="linenos">772</span></a>            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="HealthCheckService-773"><a href="#HealthCheckService-773"><span class="linenos">773</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="HealthCheckService-774"><a href="#HealthCheckService-774"><span class="linenos">774</span></a>            <span class="n">total_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>
</span><span id="HealthCheckService-775"><a href="#HealthCheckService-775"><span class="linenos">775</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService-776"><a href="#HealthCheckService-776"><span class="linenos">776</span></a>            <span class="c1"># Check if the response is healthy</span>
</span><span id="HealthCheckService-777"><a href="#HealthCheckService-777"><span class="linenos">777</span></a>            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="HealthCheckService-778"><a href="#HealthCheckService-778"><span class="linenos">778</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Streamlit server healthy - Response time: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">total_time</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">ms&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService-779"><a href="#HealthCheckService-779"><span class="linenos">779</span></a>                <span class="k">return</span> <span class="p">{</span>
</span><span id="HealthCheckService-780"><a href="#HealthCheckService-780"><span class="linenos">780</span></a>                    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;healthy&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService-781"><a href="#HealthCheckService-781"><span class="linenos">781</span></a>                    <span class="s2">&quot;response_code&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
</span><span id="HealthCheckService-782"><a href="#HealthCheckService-782"><span class="linenos">782</span></a>                    <span class="s2">&quot;latency_ms&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">total_time</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="HealthCheckService-783"><a href="#HealthCheckService-783"><span class="linenos">783</span></a>                    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Streamlit server is running&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService-784"><a href="#HealthCheckService-784"><span class="linenos">784</span></a>                    <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span>
</span><span id="HealthCheckService-785"><a href="#HealthCheckService-785"><span class="linenos">785</span></a>                <span class="p">}</span>
</span><span id="HealthCheckService-786"><a href="#HealthCheckService-786"><span class="linenos">786</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="HealthCheckService-787"><a href="#HealthCheckService-787"><span class="linenos">787</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unhealthy response from server: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService-788"><a href="#HealthCheckService-788"><span class="linenos">788</span></a>                <span class="k">return</span> <span class="p">{</span>
</span><span id="HealthCheckService-789"><a href="#HealthCheckService-789"><span class="linenos">789</span></a>                    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;critical&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService-790"><a href="#HealthCheckService-790"><span class="linenos">790</span></a>                    <span class="s2">&quot;response_code&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
</span><span id="HealthCheckService-791"><a href="#HealthCheckService-791"><span class="linenos">791</span></a>                    <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Unhealthy response from server: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService-792"><a href="#HealthCheckService-792"><span class="linenos">792</span></a>                    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Streamlit server is not healthy&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService-793"><a href="#HealthCheckService-793"><span class="linenos">793</span></a>                    <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span>
</span><span id="HealthCheckService-794"><a href="#HealthCheckService-794"><span class="linenos">794</span></a>                <span class="p">}</span>
</span><span id="HealthCheckService-795"><a href="#HealthCheckService-795"><span class="linenos">795</span></a>
</span><span id="HealthCheckService-796"><a href="#HealthCheckService-796"><span class="linenos">796</span></a>        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="HealthCheckService-797"><a href="#HealthCheckService-797"><span class="linenos">797</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection error while checking Streamlit server: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService-798"><a href="#HealthCheckService-798"><span class="linenos">798</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="HealthCheckService-799"><a href="#HealthCheckService-799"><span class="linenos">799</span></a>                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;critical&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService-800"><a href="#HealthCheckService-800"><span class="linenos">800</span></a>                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Connection error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService-801"><a href="#HealthCheckService-801"><span class="linenos">801</span></a>                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Cannot connect to Streamlit server&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService-802"><a href="#HealthCheckService-802"><span class="linenos">802</span></a>                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span>
</span><span id="HealthCheckService-803"><a href="#HealthCheckService-803"><span class="linenos">803</span></a>            <span class="p">}</span>
</span><span id="HealthCheckService-804"><a href="#HealthCheckService-804"><span class="linenos">804</span></a>        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">Timeout</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="HealthCheckService-805"><a href="#HealthCheckService-805"><span class="linenos">805</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timeout while checking Streamlit server: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService-806"><a href="#HealthCheckService-806"><span class="linenos">806</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="HealthCheckService-807"><a href="#HealthCheckService-807"><span class="linenos">807</span></a>                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;critical&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService-808"><a href="#HealthCheckService-808"><span class="linenos">808</span></a>                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Timeout error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService-809"><a href="#HealthCheckService-809"><span class="linenos">809</span></a>                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Streamlit server is not responding&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService-810"><a href="#HealthCheckService-810"><span class="linenos">810</span></a>                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span>
</span><span id="HealthCheckService-811"><a href="#HealthCheckService-811"><span class="linenos">811</span></a>            <span class="p">}</span>
</span><span id="HealthCheckService-812"><a href="#HealthCheckService-812"><span class="linenos">812</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="HealthCheckService-813"><a href="#HealthCheckService-813"><span class="linenos">813</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected error while checking Streamlit server: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService-814"><a href="#HealthCheckService-814"><span class="linenos">814</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="HealthCheckService-815"><a href="#HealthCheckService-815"><span class="linenos">815</span></a>                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;critical&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService-816"><a href="#HealthCheckService-816"><span class="linenos">816</span></a>                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Unknown error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService-817"><a href="#HealthCheckService-817"><span class="linenos">817</span></a>                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Failed to check Streamlit server&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService-818"><a href="#HealthCheckService-818"><span class="linenos">818</span></a>                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span>
</span><span id="HealthCheckService-819"><a href="#HealthCheckService-819"><span class="linenos">819</span></a>            <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>HealthCheckService provides a comprehensive health monitoring solution for Streamlit applications.
It periodically checks system resources, external dependencies, custom health checks, and Streamlit server/page status,
updating and reporting the overall health status.
Attributes:
    logger (logging.Logger): Logger for health check events.
    config_path (str): Path to the health check configuration file.
    health_data (Dict[str, Any]): Stores the latest health check results.
    config (Dict): Loaded health check configuration.
    check_interval (int): Interval (in seconds) between health checks.
    _running (bool): Indicates if the health check service is running.
    _thread (threading.Thread): Background thread for periodic checks.
    streamlit_url (str): URL of the Streamlit server.
    streamlit_port (int): Port of the Streamlit server.
Methods:
    __init__(config_path: str = "health_check_config.json"):
        Initializes the HealthCheckService with configuration and default health data.
    _load_config() -> Dict:
        Loads health check configuration from file or returns default configuration.
    _get_default_config() -> Dict:
        Returns the default health check configuration.
    start():
        Starts the health check service in a background thread.
    stop():
        Stops the health check service.
    _run_checks_periodically():
        Runs health checks periodically based on the configured interval.
    run_all_checks():
        Executes all configured health checks and updates health data.
    check_cpu():
        Checks CPU usage and updates health data.
    check_memory():
        Checks memory usage and updates health data.
    check_disk():
        Checks disk usage and updates health data.
    check_dependencies():
        Checks external dependencies such as APIs and databases.
    _check_api_endpoint(endpoint: Dict):
        Checks if an API endpoint is accessible and updates health data.
    _check_database(db_config: Dict):
        Checks database connection (placeholder for actual implementation).
    register_custom_check(name: str, check_func: Callable[[], Dict[str, Any]]):
        Registers a custom health check function.
    run_custom_checks():
        Executes all registered custom health checks.
    _update_overall_status():
        Updates the overall health status based on individual checks.
    get_health_data() -> Dict:
        Returns the latest health check data, excluding function references.
    save_config():
        Saves the current configuration to file.
    check_streamlit_pages():
        Checks for errors in Streamlit pages and updates health data.
    check_streamlit_server() -> Dict[str, Any]:
        Checks if the Streamlit server is running and responding.</p>
</div>


                            <div id="HealthCheckService.__init__" class="classattr">
                                        <input id="HealthCheckService.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">HealthCheckService</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">config_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;health_check_config.json&#39;</span></span>)</span>

                <label class="view-source-button" for="HealthCheckService.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HealthCheckService.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HealthCheckService.__init__-287"><a href="#HealthCheckService.__init__-287"><span class="linenos">287</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;health_check_config.json&quot;</span><span class="p">):</span>
</span><span id="HealthCheckService.__init__-288"><a href="#HealthCheckService.__init__-288"><span class="linenos">288</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HealthCheckService.__init__-289"><a href="#HealthCheckService.__init__-289"><span class="linenos">289</span></a><span class="sd">        Initializes the HealthCheckService instance.</span>
</span><span id="HealthCheckService.__init__-290"><a href="#HealthCheckService.__init__-290"><span class="linenos">290</span></a><span class="sd">        Args:</span>
</span><span id="HealthCheckService.__init__-291"><a href="#HealthCheckService.__init__-291"><span class="linenos">291</span></a><span class="sd">            config_path (str): Path to the health check configuration file. Defaults to &quot;health_check_config.json&quot;.</span>
</span><span id="HealthCheckService.__init__-292"><a href="#HealthCheckService.__init__-292"><span class="linenos">292</span></a><span class="sd">        Attributes:</span>
</span><span id="HealthCheckService.__init__-293"><a href="#HealthCheckService.__init__-293"><span class="linenos">293</span></a><span class="sd">            logger (logging.Logger): Logger for the HealthCheckService.</span>
</span><span id="HealthCheckService.__init__-294"><a href="#HealthCheckService.__init__-294"><span class="linenos">294</span></a><span class="sd">            config_path (str): Path to the configuration file.</span>
</span><span id="HealthCheckService.__init__-295"><a href="#HealthCheckService.__init__-295"><span class="linenos">295</span></a><span class="sd">            health_data (Dict[str, Any]): Dictionary storing health check data.</span>
</span><span id="HealthCheckService.__init__-296"><a href="#HealthCheckService.__init__-296"><span class="linenos">296</span></a><span class="sd">            config (dict): Loaded configuration from the config file.</span>
</span><span id="HealthCheckService.__init__-297"><a href="#HealthCheckService.__init__-297"><span class="linenos">297</span></a><span class="sd">            check_interval (int): Interval in seconds between health checks. Defaults to 60.</span>
</span><span id="HealthCheckService.__init__-298"><a href="#HealthCheckService.__init__-298"><span class="linenos">298</span></a><span class="sd">            _running (bool): Indicates if the health check service is running.</span>
</span><span id="HealthCheckService.__init__-299"><a href="#HealthCheckService.__init__-299"><span class="linenos">299</span></a><span class="sd">            _thread (threading.Thread or None): Thread running the health check loop.</span>
</span><span id="HealthCheckService.__init__-300"><a href="#HealthCheckService.__init__-300"><span class="linenos">300</span></a><span class="sd">            streamlit_url (str): URL of the Streamlit service. Defaults to &quot;http://localhost&quot;.</span>
</span><span id="HealthCheckService.__init__-301"><a href="#HealthCheckService.__init__-301"><span class="linenos">301</span></a><span class="sd">            streamlit_port (int): Port of the Streamlit service. Defaults to 8501.</span>
</span><span id="HealthCheckService.__init__-302"><a href="#HealthCheckService.__init__-302"><span class="linenos">302</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HealthCheckService.__init__-303"><a href="#HealthCheckService.__init__-303"><span class="linenos">303</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.HealthCheckService&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService.__init__-304"><a href="#HealthCheckService.__init__-304"><span class="linenos">304</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Initializing HealthCheckService&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService.__init__-305"><a href="#HealthCheckService.__init__-305"><span class="linenos">305</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config_path</span> <span class="o">=</span> <span class="n">config_path</span>
</span><span id="HealthCheckService.__init__-306"><a href="#HealthCheckService.__init__-306"><span class="linenos">306</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="HealthCheckService.__init__-307"><a href="#HealthCheckService.__init__-307"><span class="linenos">307</span></a>            <span class="s2">&quot;last_updated&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="HealthCheckService.__init__-308"><a href="#HealthCheckService.__init__-308"><span class="linenos">308</span></a>            <span class="s2">&quot;system&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="HealthCheckService.__init__-309"><a href="#HealthCheckService.__init__-309"><span class="linenos">309</span></a>            <span class="s2">&quot;dependencies&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="HealthCheckService.__init__-310"><a href="#HealthCheckService.__init__-310"><span class="linenos">310</span></a>            <span class="s2">&quot;custom_checks&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="HealthCheckService.__init__-311"><a href="#HealthCheckService.__init__-311"><span class="linenos">311</span></a>            <span class="s2">&quot;overall_status&quot;</span><span class="p">:</span> <span class="s2">&quot;unknown&quot;</span>
</span><span id="HealthCheckService.__init__-312"><a href="#HealthCheckService.__init__-312"><span class="linenos">312</span></a>        <span class="p">}</span>
</span><span id="HealthCheckService.__init__-313"><a href="#HealthCheckService.__init__-313"><span class="linenos">313</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_config</span><span class="p">()</span>
</span><span id="HealthCheckService.__init__-314"><a href="#HealthCheckService.__init__-314"><span class="linenos">314</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">check_interval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;check_interval&quot;</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>  <span class="c1"># Default: 60 seconds</span>
</span><span id="HealthCheckService.__init__-315"><a href="#HealthCheckService.__init__-315"><span class="linenos">315</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_running</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="HealthCheckService.__init__-316"><a href="#HealthCheckService.__init__-316"><span class="linenos">316</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="HealthCheckService.__init__-317"><a href="#HealthCheckService.__init__-317"><span class="linenos">317</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">streamlit_url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;streamlit_url&quot;</span><span class="p">,</span> <span class="s2">&quot;http://localhost&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService.__init__-318"><a href="#HealthCheckService.__init__-318"><span class="linenos">318</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">streamlit_port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;streamlit_port&quot;</span><span class="p">,</span> <span class="mi">8501</span><span class="p">)</span>  <span class="c1"># Default: 8501</span>
</span></pre></div>


            <div class="docstring"><p>Initializes the HealthCheckService instance.
Args:
    config_path (str): Path to the health check configuration file. Defaults to "health_check_config.json".
Attributes:
    logger (logging.Logger): Logger for the HealthCheckService.
    config_path (str): Path to the configuration file.
    health_data (Dict[str, Any]): Dictionary storing health check data.
    config (dict): Loaded configuration from the config file.
    check_interval (int): Interval in seconds between health checks. Defaults to 60.
    _running (bool): Indicates if the health check service is running.
    _thread (threading.Thread or None): Thread running the health check loop.
    streamlit_url (str): URL of the Streamlit service. Defaults to "http://localhost".
    streamlit_port (int): Port of the Streamlit service. Defaults to 8501.</p>
</div>


                            </div>
                            <div id="HealthCheckService.logger" class="classattr">
                                <div class="attr variable">
            <span class="name">logger</span>

        
    </div>
    <a class="headerlink" href="#HealthCheckService.logger"></a>
    
    

                            </div>
                            <div id="HealthCheckService.config_path" class="classattr">
                                <div class="attr variable">
            <span class="name">config_path</span>

        
    </div>
    <a class="headerlink" href="#HealthCheckService.config_path"></a>
    
    

                            </div>
                            <div id="HealthCheckService.health_data" class="classattr">
                                <div class="attr variable">
            <span class="name">health_data</span><span class="annotation">: Dict[str, Any]</span>

        
    </div>
    <a class="headerlink" href="#HealthCheckService.health_data"></a>
    
    

                            </div>
                            <div id="HealthCheckService.config" class="classattr">
                                <div class="attr variable">
            <span class="name">config</span>

        
    </div>
    <a class="headerlink" href="#HealthCheckService.config"></a>
    
    

                            </div>
                            <div id="HealthCheckService.check_interval" class="classattr">
                                <div class="attr variable">
            <span class="name">check_interval</span>

        
    </div>
    <a class="headerlink" href="#HealthCheckService.check_interval"></a>
    
    

                            </div>
                            <div id="HealthCheckService.streamlit_url" class="classattr">
                                <div class="attr variable">
            <span class="name">streamlit_url</span>

        
    </div>
    <a class="headerlink" href="#HealthCheckService.streamlit_url"></a>
    
    

                            </div>
                            <div id="HealthCheckService.streamlit_port" class="classattr">
                                <div class="attr variable">
            <span class="name">streamlit_port</span>

        
    </div>
    <a class="headerlink" href="#HealthCheckService.streamlit_port"></a>
    
    

                            </div>
                            <div id="HealthCheckService.start" class="classattr">
                                        <input id="HealthCheckService.start-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">start</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="HealthCheckService.start-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HealthCheckService.start"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HealthCheckService.start-362"><a href="#HealthCheckService.start-362"><span class="linenos">362</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="HealthCheckService.start-363"><a href="#HealthCheckService.start-363"><span class="linenos">363</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Start the health check service in a background thread.&quot;&quot;&quot;</span>
</span><span id="HealthCheckService.start-364"><a href="#HealthCheckService.start-364"><span class="linenos">364</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running</span><span class="p">:</span>
</span><span id="HealthCheckService.start-365"><a href="#HealthCheckService.start-365"><span class="linenos">365</span></a>            <span class="k">return</span>
</span><span id="HealthCheckService.start-366"><a href="#HealthCheckService.start-366"><span class="linenos">366</span></a>            
</span><span id="HealthCheckService.start-367"><a href="#HealthCheckService.start-367"><span class="linenos">367</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_running</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="HealthCheckService.start-368"><a href="#HealthCheckService.start-368"><span class="linenos">368</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_run_checks_periodically</span><span class="p">,</span> <span class="n">daemon</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="HealthCheckService.start-369"><a href="#HealthCheckService.start-369"><span class="linenos">369</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Start the health check service in a background thread.</p>
</div>


                            </div>
                            <div id="HealthCheckService.stop" class="classattr">
                                        <input id="HealthCheckService.stop-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">stop</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="HealthCheckService.stop-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HealthCheckService.stop"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HealthCheckService.stop-371"><a href="#HealthCheckService.stop-371"><span class="linenos">371</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="HealthCheckService.stop-372"><a href="#HealthCheckService.stop-372"><span class="linenos">372</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stop the health check service.&quot;&quot;&quot;</span>
</span><span id="HealthCheckService.stop-373"><a href="#HealthCheckService.stop-373"><span class="linenos">373</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_running</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="HealthCheckService.stop-374"><a href="#HealthCheckService.stop-374"><span class="linenos">374</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="p">:</span>
</span><span id="HealthCheckService.stop-375"><a href="#HealthCheckService.stop-375"><span class="linenos">375</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_thread</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Stop the health check service.</p>
</div>


                            </div>
                            <div id="HealthCheckService.run_all_checks" class="classattr">
                                        <input id="HealthCheckService.run_all_checks-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">run_all_checks</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="HealthCheckService.run_all_checks-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HealthCheckService.run_all_checks"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HealthCheckService.run_all_checks-383"><a href="#HealthCheckService.run_all_checks-383"><span class="linenos">383</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run_all_checks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="HealthCheckService.run_all_checks-384"><a href="#HealthCheckService.run_all_checks-384"><span class="linenos">384</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Run all configured health checks and update health data.&quot;&quot;&quot;</span>
</span><span id="HealthCheckService.run_all_checks-385"><a href="#HealthCheckService.run_all_checks-385"><span class="linenos">385</span></a>        <span class="c1"># Update timestamp</span>
</span><span id="HealthCheckService.run_all_checks-386"><a href="#HealthCheckService.run_all_checks-386"><span class="linenos">386</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;last_updated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="HealthCheckService.run_all_checks-387"><a href="#HealthCheckService.run_all_checks-387"><span class="linenos">387</span></a>        
</span><span id="HealthCheckService.run_all_checks-388"><a href="#HealthCheckService.run_all_checks-388"><span class="linenos">388</span></a>        <span class="c1"># Check Streamlit server</span>
</span><span id="HealthCheckService.run_all_checks-389"><a href="#HealthCheckService.run_all_checks-389"><span class="linenos">389</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;streamlit_server&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_streamlit_server</span><span class="p">()</span>
</span><span id="HealthCheckService.run_all_checks-390"><a href="#HealthCheckService.run_all_checks-390"><span class="linenos">390</span></a>        
</span><span id="HealthCheckService.run_all_checks-391"><a href="#HealthCheckService.run_all_checks-391"><span class="linenos">391</span></a>        <span class="c1"># System checks</span>
</span><span id="HealthCheckService.run_all_checks-392"><a href="#HealthCheckService.run_all_checks-392"><span class="linenos">392</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;system_checks&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="HealthCheckService.run_all_checks-393"><a href="#HealthCheckService.run_all_checks-393"><span class="linenos">393</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">check_cpu</span><span class="p">()</span>
</span><span id="HealthCheckService.run_all_checks-394"><a href="#HealthCheckService.run_all_checks-394"><span class="linenos">394</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;system_checks&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="HealthCheckService.run_all_checks-395"><a href="#HealthCheckService.run_all_checks-395"><span class="linenos">395</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">check_memory</span><span class="p">()</span>
</span><span id="HealthCheckService.run_all_checks-396"><a href="#HealthCheckService.run_all_checks-396"><span class="linenos">396</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;system_checks&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;disk&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="HealthCheckService.run_all_checks-397"><a href="#HealthCheckService.run_all_checks-397"><span class="linenos">397</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">check_disk</span><span class="p">()</span>
</span><span id="HealthCheckService.run_all_checks-398"><a href="#HealthCheckService.run_all_checks-398"><span class="linenos">398</span></a>            
</span><span id="HealthCheckService.run_all_checks-399"><a href="#HealthCheckService.run_all_checks-399"><span class="linenos">399</span></a>        <span class="c1"># Rest of the existing checks...</span>
</span><span id="HealthCheckService.run_all_checks-400"><a href="#HealthCheckService.run_all_checks-400"><span class="linenos">400</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">check_dependencies</span><span class="p">()</span>
</span><span id="HealthCheckService.run_all_checks-401"><a href="#HealthCheckService.run_all_checks-401"><span class="linenos">401</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">run_custom_checks</span><span class="p">()</span>
</span><span id="HealthCheckService.run_all_checks-402"><a href="#HealthCheckService.run_all_checks-402"><span class="linenos">402</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">check_streamlit_pages</span><span class="p">()</span>
</span><span id="HealthCheckService.run_all_checks-403"><a href="#HealthCheckService.run_all_checks-403"><span class="linenos">403</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_update_overall_status</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Run all configured health checks and update health data.</p>
</div>


                            </div>
                            <div id="HealthCheckService.check_cpu" class="classattr">
                                        <input id="HealthCheckService.check_cpu-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_cpu</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="HealthCheckService.check_cpu-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HealthCheckService.check_cpu"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HealthCheckService.check_cpu-405"><a href="#HealthCheckService.check_cpu-405"><span class="linenos">405</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_cpu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="HealthCheckService.check_cpu-406"><a href="#HealthCheckService.check_cpu-406"><span class="linenos">406</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HealthCheckService.check_cpu-407"><a href="#HealthCheckService.check_cpu-407"><span class="linenos">407</span></a><span class="sd">        Checks the current CPU usage and updates the health status based on configured thresholds.</span>
</span><span id="HealthCheckService.check_cpu-408"><a href="#HealthCheckService.check_cpu-408"><span class="linenos">408</span></a><span class="sd">        Measures the CPU usage percentage over a 1-second interval using psutil. Compares the result</span>
</span><span id="HealthCheckService.check_cpu-409"><a href="#HealthCheckService.check_cpu-409"><span class="linenos">409</span></a><span class="sd">        against warning and critical thresholds defined in the configuration. Sets the status to</span>
</span><span id="HealthCheckService.check_cpu-410"><a href="#HealthCheckService.check_cpu-410"><span class="linenos">410</span></a><span class="sd">        &#39;healthy&#39;, &#39;warning&#39;, or &#39;critical&#39; accordingly, and updates the health data dictionary.</span>
</span><span id="HealthCheckService.check_cpu-411"><a href="#HealthCheckService.check_cpu-411"><span class="linenos">411</span></a><span class="sd">        Returns:</span>
</span><span id="HealthCheckService.check_cpu-412"><a href="#HealthCheckService.check_cpu-412"><span class="linenos">412</span></a><span class="sd">            None</span>
</span><span id="HealthCheckService.check_cpu-413"><a href="#HealthCheckService.check_cpu-413"><span class="linenos">413</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HealthCheckService.check_cpu-414"><a href="#HealthCheckService.check_cpu-414"><span class="linenos">414</span></a>        
</span><span id="HealthCheckService.check_cpu-415"><a href="#HealthCheckService.check_cpu-415"><span class="linenos">415</span></a>        <span class="n">cpu_percent</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">cpu_percent</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="HealthCheckService.check_cpu-416"><a href="#HealthCheckService.check_cpu-416"><span class="linenos">416</span></a>        <span class="n">warning_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cpu_warning&quot;</span><span class="p">,</span> <span class="mi">70</span><span class="p">)</span>
</span><span id="HealthCheckService.check_cpu-417"><a href="#HealthCheckService.check_cpu-417"><span class="linenos">417</span></a>        <span class="n">critical_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cpu_critical&quot;</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
</span><span id="HealthCheckService.check_cpu-418"><a href="#HealthCheckService.check_cpu-418"><span class="linenos">418</span></a>        
</span><span id="HealthCheckService.check_cpu-419"><a href="#HealthCheckService.check_cpu-419"><span class="linenos">419</span></a>        <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;healthy&quot;</span>
</span><span id="HealthCheckService.check_cpu-420"><a href="#HealthCheckService.check_cpu-420"><span class="linenos">420</span></a>        <span class="k">if</span> <span class="n">cpu_percent</span> <span class="o">&gt;=</span> <span class="n">critical_threshold</span><span class="p">:</span>
</span><span id="HealthCheckService.check_cpu-421"><a href="#HealthCheckService.check_cpu-421"><span class="linenos">421</span></a>            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;critical&quot;</span>
</span><span id="HealthCheckService.check_cpu-422"><a href="#HealthCheckService.check_cpu-422"><span class="linenos">422</span></a>        <span class="k">elif</span> <span class="n">cpu_percent</span> <span class="o">&gt;=</span> <span class="n">warning_threshold</span><span class="p">:</span>
</span><span id="HealthCheckService.check_cpu-423"><a href="#HealthCheckService.check_cpu-423"><span class="linenos">423</span></a>            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;warning&quot;</span>
</span><span id="HealthCheckService.check_cpu-424"><a href="#HealthCheckService.check_cpu-424"><span class="linenos">424</span></a>            
</span><span id="HealthCheckService.check_cpu-425"><a href="#HealthCheckService.check_cpu-425"><span class="linenos">425</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;system&quot;</span><span class="p">][</span><span class="s2">&quot;cpu&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="HealthCheckService.check_cpu-426"><a href="#HealthCheckService.check_cpu-426"><span class="linenos">426</span></a>            <span class="s2">&quot;usage_percent&quot;</span><span class="p">:</span> <span class="n">cpu_percent</span><span class="p">,</span>
</span><span id="HealthCheckService.check_cpu-427"><a href="#HealthCheckService.check_cpu-427"><span class="linenos">427</span></a>            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">status</span>
</span><span id="HealthCheckService.check_cpu-428"><a href="#HealthCheckService.check_cpu-428"><span class="linenos">428</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Checks the current CPU usage and updates the health status based on configured thresholds.
Measures the CPU usage percentage over a 1-second interval using psutil. Compares the result
against warning and critical thresholds defined in the configuration. Sets the status to
'healthy', 'warning', or 'critical' accordingly, and updates the health data dictionary.
Returns:
    None</p>
</div>


                            </div>
                            <div id="HealthCheckService.check_memory" class="classattr">
                                        <input id="HealthCheckService.check_memory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_memory</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="HealthCheckService.check_memory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HealthCheckService.check_memory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HealthCheckService.check_memory-430"><a href="#HealthCheckService.check_memory-430"><span class="linenos">430</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_memory</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="HealthCheckService.check_memory-431"><a href="#HealthCheckService.check_memory-431"><span class="linenos">431</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HealthCheckService.check_memory-432"><a href="#HealthCheckService.check_memory-432"><span class="linenos">432</span></a><span class="sd">        Checks the system&#39;s memory usage and updates the health status accordingly.</span>
</span><span id="HealthCheckService.check_memory-433"><a href="#HealthCheckService.check_memory-433"><span class="linenos">433</span></a><span class="sd">        Retrieves the current memory usage statistics using psutil, compares the usage percentage</span>
</span><span id="HealthCheckService.check_memory-434"><a href="#HealthCheckService.check_memory-434"><span class="linenos">434</span></a><span class="sd">        against configured warning and critical thresholds, and sets the memory status to &#39;healthy&#39;,</span>
</span><span id="HealthCheckService.check_memory-435"><a href="#HealthCheckService.check_memory-435"><span class="linenos">435</span></a><span class="sd">        &#39;warning&#39;, or &#39;critical&#39;. Updates the health_data dictionary with total memory, available memory,</span>
</span><span id="HealthCheckService.check_memory-436"><a href="#HealthCheckService.check_memory-436"><span class="linenos">436</span></a><span class="sd">        usage percentage, and status.</span>
</span><span id="HealthCheckService.check_memory-437"><a href="#HealthCheckService.check_memory-437"><span class="linenos">437</span></a><span class="sd">        Returns:</span>
</span><span id="HealthCheckService.check_memory-438"><a href="#HealthCheckService.check_memory-438"><span class="linenos">438</span></a><span class="sd">            None</span>
</span><span id="HealthCheckService.check_memory-439"><a href="#HealthCheckService.check_memory-439"><span class="linenos">439</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HealthCheckService.check_memory-440"><a href="#HealthCheckService.check_memory-440"><span class="linenos">440</span></a>        
</span><span id="HealthCheckService.check_memory-441"><a href="#HealthCheckService.check_memory-441"><span class="linenos">441</span></a>        <span class="n">memory</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">virtual_memory</span><span class="p">()</span>
</span><span id="HealthCheckService.check_memory-442"><a href="#HealthCheckService.check_memory-442"><span class="linenos">442</span></a>        <span class="n">memory_percent</span> <span class="o">=</span> <span class="n">memory</span><span class="o">.</span><span class="n">percent</span>
</span><span id="HealthCheckService.check_memory-443"><a href="#HealthCheckService.check_memory-443"><span class="linenos">443</span></a>        <span class="n">warning_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_warning&quot;</span><span class="p">,</span> <span class="mi">70</span><span class="p">)</span>
</span><span id="HealthCheckService.check_memory-444"><a href="#HealthCheckService.check_memory-444"><span class="linenos">444</span></a>        <span class="n">critical_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_critical&quot;</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
</span><span id="HealthCheckService.check_memory-445"><a href="#HealthCheckService.check_memory-445"><span class="linenos">445</span></a>        
</span><span id="HealthCheckService.check_memory-446"><a href="#HealthCheckService.check_memory-446"><span class="linenos">446</span></a>        <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;healthy&quot;</span>
</span><span id="HealthCheckService.check_memory-447"><a href="#HealthCheckService.check_memory-447"><span class="linenos">447</span></a>        <span class="k">if</span> <span class="n">memory_percent</span> <span class="o">&gt;=</span> <span class="n">critical_threshold</span><span class="p">:</span>
</span><span id="HealthCheckService.check_memory-448"><a href="#HealthCheckService.check_memory-448"><span class="linenos">448</span></a>            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;critical&quot;</span>
</span><span id="HealthCheckService.check_memory-449"><a href="#HealthCheckService.check_memory-449"><span class="linenos">449</span></a>        <span class="k">elif</span> <span class="n">memory_percent</span> <span class="o">&gt;=</span> <span class="n">warning_threshold</span><span class="p">:</span>
</span><span id="HealthCheckService.check_memory-450"><a href="#HealthCheckService.check_memory-450"><span class="linenos">450</span></a>            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;warning&quot;</span>
</span><span id="HealthCheckService.check_memory-451"><a href="#HealthCheckService.check_memory-451"><span class="linenos">451</span></a>            
</span><span id="HealthCheckService.check_memory-452"><a href="#HealthCheckService.check_memory-452"><span class="linenos">452</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;system&quot;</span><span class="p">][</span><span class="s2">&quot;memory&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="HealthCheckService.check_memory-453"><a href="#HealthCheckService.check_memory-453"><span class="linenos">453</span></a>            <span class="s2">&quot;total_gb&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">memory</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="HealthCheckService.check_memory-454"><a href="#HealthCheckService.check_memory-454"><span class="linenos">454</span></a>            <span class="s2">&quot;available_gb&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">memory</span><span class="o">.</span><span class="n">available</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="HealthCheckService.check_memory-455"><a href="#HealthCheckService.check_memory-455"><span class="linenos">455</span></a>            <span class="s2">&quot;usage_percent&quot;</span><span class="p">:</span> <span class="n">memory_percent</span><span class="p">,</span>
</span><span id="HealthCheckService.check_memory-456"><a href="#HealthCheckService.check_memory-456"><span class="linenos">456</span></a>            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">status</span>
</span><span id="HealthCheckService.check_memory-457"><a href="#HealthCheckService.check_memory-457"><span class="linenos">457</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Checks the system's memory usage and updates the health status accordingly.
Retrieves the current memory usage statistics using psutil, compares the usage percentage
against configured warning and critical thresholds, and sets the memory status to 'healthy',
'warning', or 'critical'. Updates the health_data dictionary with total memory, available memory,
usage percentage, and status.
Returns:
    None</p>
</div>


                            </div>
                            <div id="HealthCheckService.check_disk" class="classattr">
                                        <input id="HealthCheckService.check_disk-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_disk</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="HealthCheckService.check_disk-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HealthCheckService.check_disk"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HealthCheckService.check_disk-459"><a href="#HealthCheckService.check_disk-459"><span class="linenos">459</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_disk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="HealthCheckService.check_disk-460"><a href="#HealthCheckService.check_disk-460"><span class="linenos">460</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HealthCheckService.check_disk-461"><a href="#HealthCheckService.check_disk-461"><span class="linenos">461</span></a><span class="sd">        Checks the disk usage of the root filesystem and updates the health status.</span>
</span><span id="HealthCheckService.check_disk-462"><a href="#HealthCheckService.check_disk-462"><span class="linenos">462</span></a><span class="sd">        Retrieves disk usage statistics using psutil, compares the usage percentage</span>
</span><span id="HealthCheckService.check_disk-463"><a href="#HealthCheckService.check_disk-463"><span class="linenos">463</span></a><span class="sd">        against configured warning and critical thresholds, and sets the disk status</span>
</span><span id="HealthCheckService.check_disk-464"><a href="#HealthCheckService.check_disk-464"><span class="linenos">464</span></a><span class="sd">        accordingly (&quot;healthy&quot;, &quot;warning&quot;, or &quot;critical&quot;). Updates the health_data</span>
</span><span id="HealthCheckService.check_disk-465"><a href="#HealthCheckService.check_disk-465"><span class="linenos">465</span></a><span class="sd">        dictionary with total disk size, free space, usage percentage, and status.</span>
</span><span id="HealthCheckService.check_disk-466"><a href="#HealthCheckService.check_disk-466"><span class="linenos">466</span></a><span class="sd">        Returns:</span>
</span><span id="HealthCheckService.check_disk-467"><a href="#HealthCheckService.check_disk-467"><span class="linenos">467</span></a><span class="sd">            None</span>
</span><span id="HealthCheckService.check_disk-468"><a href="#HealthCheckService.check_disk-468"><span class="linenos">468</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HealthCheckService.check_disk-469"><a href="#HealthCheckService.check_disk-469"><span class="linenos">469</span></a>        
</span><span id="HealthCheckService.check_disk-470"><a href="#HealthCheckService.check_disk-470"><span class="linenos">470</span></a>        <span class="n">disk</span> <span class="o">=</span> <span class="n">psutil</span><span class="o">.</span><span class="n">disk_usage</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span><span id="HealthCheckService.check_disk-471"><a href="#HealthCheckService.check_disk-471"><span class="linenos">471</span></a>        <span class="n">disk_percent</span> <span class="o">=</span> <span class="n">disk</span><span class="o">.</span><span class="n">percent</span>
</span><span id="HealthCheckService.check_disk-472"><a href="#HealthCheckService.check_disk-472"><span class="linenos">472</span></a>        <span class="n">warning_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;disk_warning&quot;</span><span class="p">,</span> <span class="mi">70</span><span class="p">)</span>
</span><span id="HealthCheckService.check_disk-473"><a href="#HealthCheckService.check_disk-473"><span class="linenos">473</span></a>        <span class="n">critical_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;disk_critical&quot;</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
</span><span id="HealthCheckService.check_disk-474"><a href="#HealthCheckService.check_disk-474"><span class="linenos">474</span></a>        
</span><span id="HealthCheckService.check_disk-475"><a href="#HealthCheckService.check_disk-475"><span class="linenos">475</span></a>        <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;healthy&quot;</span>
</span><span id="HealthCheckService.check_disk-476"><a href="#HealthCheckService.check_disk-476"><span class="linenos">476</span></a>        <span class="k">if</span> <span class="n">disk_percent</span> <span class="o">&gt;=</span> <span class="n">critical_threshold</span><span class="p">:</span>
</span><span id="HealthCheckService.check_disk-477"><a href="#HealthCheckService.check_disk-477"><span class="linenos">477</span></a>            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;critical&quot;</span>
</span><span id="HealthCheckService.check_disk-478"><a href="#HealthCheckService.check_disk-478"><span class="linenos">478</span></a>        <span class="k">elif</span> <span class="n">disk_percent</span> <span class="o">&gt;=</span> <span class="n">warning_threshold</span><span class="p">:</span>
</span><span id="HealthCheckService.check_disk-479"><a href="#HealthCheckService.check_disk-479"><span class="linenos">479</span></a>            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;warning&quot;</span>
</span><span id="HealthCheckService.check_disk-480"><a href="#HealthCheckService.check_disk-480"><span class="linenos">480</span></a>            
</span><span id="HealthCheckService.check_disk-481"><a href="#HealthCheckService.check_disk-481"><span class="linenos">481</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;system&quot;</span><span class="p">][</span><span class="s2">&quot;disk&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="HealthCheckService.check_disk-482"><a href="#HealthCheckService.check_disk-482"><span class="linenos">482</span></a>            <span class="s2">&quot;total_gb&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">disk</span><span class="o">.</span><span class="n">total</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="HealthCheckService.check_disk-483"><a href="#HealthCheckService.check_disk-483"><span class="linenos">483</span></a>            <span class="s2">&quot;free_gb&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">disk</span><span class="o">.</span><span class="n">free</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="HealthCheckService.check_disk-484"><a href="#HealthCheckService.check_disk-484"><span class="linenos">484</span></a>            <span class="s2">&quot;usage_percent&quot;</span><span class="p">:</span> <span class="n">disk_percent</span><span class="p">,</span>
</span><span id="HealthCheckService.check_disk-485"><a href="#HealthCheckService.check_disk-485"><span class="linenos">485</span></a>            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">status</span>
</span><span id="HealthCheckService.check_disk-486"><a href="#HealthCheckService.check_disk-486"><span class="linenos">486</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Checks the disk usage of the root filesystem and updates the health status.
Retrieves disk usage statistics using psutil, compares the usage percentage
against configured warning and critical thresholds, and sets the disk status
accordingly ("healthy", "warning", or "critical"). Updates the health_data
dictionary with total disk size, free space, usage percentage, and status.
Returns:
    None</p>
</div>


                            </div>
                            <div id="HealthCheckService.check_dependencies" class="classattr">
                                        <input id="HealthCheckService.check_dependencies-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_dependencies</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="HealthCheckService.check_dependencies-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HealthCheckService.check_dependencies"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HealthCheckService.check_dependencies-488"><a href="#HealthCheckService.check_dependencies-488"><span class="linenos">488</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_dependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="HealthCheckService.check_dependencies-489"><a href="#HealthCheckService.check_dependencies-489"><span class="linenos">489</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HealthCheckService.check_dependencies-490"><a href="#HealthCheckService.check_dependencies-490"><span class="linenos">490</span></a><span class="sd">        Checks the health of configured dependencies, including API endpoints and databases.</span>
</span><span id="HealthCheckService.check_dependencies-491"><a href="#HealthCheckService.check_dependencies-491"><span class="linenos">491</span></a><span class="sd">        Iterates through the list of API endpoints and databases specified in the configuration,</span>
</span><span id="HealthCheckService.check_dependencies-492"><a href="#HealthCheckService.check_dependencies-492"><span class="linenos">492</span></a><span class="sd">        and performs health checks on each by invoking the corresponding internal methods.</span>
</span><span id="HealthCheckService.check_dependencies-493"><a href="#HealthCheckService.check_dependencies-493"><span class="linenos">493</span></a><span class="sd">        Raises:</span>
</span><span id="HealthCheckService.check_dependencies-494"><a href="#HealthCheckService.check_dependencies-494"><span class="linenos">494</span></a><span class="sd">            Exception: If any dependency check fails.</span>
</span><span id="HealthCheckService.check_dependencies-495"><a href="#HealthCheckService.check_dependencies-495"><span class="linenos">495</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HealthCheckService.check_dependencies-496"><a href="#HealthCheckService.check_dependencies-496"><span class="linenos">496</span></a>        
</span><span id="HealthCheckService.check_dependencies-497"><a href="#HealthCheckService.check_dependencies-497"><span class="linenos">497</span></a>        <span class="c1"># Check API endpoints</span>
</span><span id="HealthCheckService.check_dependencies-498"><a href="#HealthCheckService.check_dependencies-498"><span class="linenos">498</span></a>        <span class="k">for</span> <span class="n">endpoint</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;dependencies&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;api_endpoints&quot;</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="HealthCheckService.check_dependencies-499"><a href="#HealthCheckService.check_dependencies-499"><span class="linenos">499</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_check_api_endpoint</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>
</span><span id="HealthCheckService.check_dependencies-500"><a href="#HealthCheckService.check_dependencies-500"><span class="linenos">500</span></a>            
</span><span id="HealthCheckService.check_dependencies-501"><a href="#HealthCheckService.check_dependencies-501"><span class="linenos">501</span></a>        <span class="c1"># Check database connections</span>
</span><span id="HealthCheckService.check_dependencies-502"><a href="#HealthCheckService.check_dependencies-502"><span class="linenos">502</span></a>        <span class="k">for</span> <span class="n">db</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;dependencies&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;databases&quot;</span><span class="p">,</span> <span class="p">[]):</span>
</span><span id="HealthCheckService.check_dependencies-503"><a href="#HealthCheckService.check_dependencies-503"><span class="linenos">503</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_check_database</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Checks the health of configured dependencies, including API endpoints and databases.
Iterates through the list of API endpoints and databases specified in the configuration,
and performs health checks on each by invoking the corresponding internal methods.
Raises:
    Exception: If any dependency check fails.</p>
</div>


                            </div>
                            <div id="HealthCheckService.register_custom_check" class="classattr">
                                        <input id="HealthCheckService.register_custom_check-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">register_custom_check</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">check_func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="HealthCheckService.register_custom_check-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HealthCheckService.register_custom_check"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HealthCheckService.register_custom_check-562"><a href="#HealthCheckService.register_custom_check-562"><span class="linenos">562</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">register_custom_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">check_func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]):</span>
</span><span id="HealthCheckService.register_custom_check-563"><a href="#HealthCheckService.register_custom_check-563"><span class="linenos">563</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HealthCheckService.register_custom_check-564"><a href="#HealthCheckService.register_custom_check-564"><span class="linenos">564</span></a><span class="sd">        Register a custom health check function.</span>
</span><span id="HealthCheckService.register_custom_check-565"><a href="#HealthCheckService.register_custom_check-565"><span class="linenos">565</span></a><span class="sd">        </span>
</span><span id="HealthCheckService.register_custom_check-566"><a href="#HealthCheckService.register_custom_check-566"><span class="linenos">566</span></a><span class="sd">        Args:</span>
</span><span id="HealthCheckService.register_custom_check-567"><a href="#HealthCheckService.register_custom_check-567"><span class="linenos">567</span></a><span class="sd">            name: Name of the custom check</span>
</span><span id="HealthCheckService.register_custom_check-568"><a href="#HealthCheckService.register_custom_check-568"><span class="linenos">568</span></a><span class="sd">            check_func: Function that performs the check and returns a dictionary with results</span>
</span><span id="HealthCheckService.register_custom_check-569"><a href="#HealthCheckService.register_custom_check-569"><span class="linenos">569</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HealthCheckService.register_custom_check-570"><a href="#HealthCheckService.register_custom_check-570"><span class="linenos">570</span></a>        <span class="k">if</span> <span class="s2">&quot;custom_checks&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">:</span>
</span><span id="HealthCheckService.register_custom_check-571"><a href="#HealthCheckService.register_custom_check-571"><span class="linenos">571</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;custom_checks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="HealthCheckService.register_custom_check-572"><a href="#HealthCheckService.register_custom_check-572"><span class="linenos">572</span></a>            
</span><span id="HealthCheckService.register_custom_check-573"><a href="#HealthCheckService.register_custom_check-573"><span class="linenos">573</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;custom_checks&quot;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="HealthCheckService.register_custom_check-574"><a href="#HealthCheckService.register_custom_check-574"><span class="linenos">574</span></a>            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;unknown&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService.register_custom_check-575"><a href="#HealthCheckService.register_custom_check-575"><span class="linenos">575</span></a>            <span class="s2">&quot;check_func&quot;</span><span class="p">:</span> <span class="n">check_func</span>
</span><span id="HealthCheckService.register_custom_check-576"><a href="#HealthCheckService.register_custom_check-576"><span class="linenos">576</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Register a custom health check function.</p>

<p>Args:
    name: Name of the custom check
    check_func: Function that performs the check and returns a dictionary with results</p>
</div>


                            </div>
                            <div id="HealthCheckService.run_custom_checks" class="classattr">
                                        <input id="HealthCheckService.run_custom_checks-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">run_custom_checks</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="HealthCheckService.run_custom_checks-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HealthCheckService.run_custom_checks"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HealthCheckService.run_custom_checks-578"><a href="#HealthCheckService.run_custom_checks-578"><span class="linenos">578</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run_custom_checks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="HealthCheckService.run_custom_checks-579"><a href="#HealthCheckService.run_custom_checks-579"><span class="linenos">579</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Run all registered custom health checks.&quot;&quot;&quot;</span>
</span><span id="HealthCheckService.run_custom_checks-580"><a href="#HealthCheckService.run_custom_checks-580"><span class="linenos">580</span></a>        <span class="k">if</span> <span class="s2">&quot;custom_checks&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">:</span>
</span><span id="HealthCheckService.run_custom_checks-581"><a href="#HealthCheckService.run_custom_checks-581"><span class="linenos">581</span></a>            <span class="k">return</span>
</span><span id="HealthCheckService.run_custom_checks-582"><a href="#HealthCheckService.run_custom_checks-582"><span class="linenos">582</span></a>            
</span><span id="HealthCheckService.run_custom_checks-583"><a href="#HealthCheckService.run_custom_checks-583"><span class="linenos">583</span></a>        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">check_info</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;custom_checks&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
</span><span id="HealthCheckService.run_custom_checks-584"><a href="#HealthCheckService.run_custom_checks-584"><span class="linenos">584</span></a>            <span class="k">if</span> <span class="s2">&quot;check_func&quot;</span> <span class="ow">in</span> <span class="n">check_info</span> <span class="ow">and</span> <span class="nb">callable</span><span class="p">(</span><span class="n">check_info</span><span class="p">[</span><span class="s2">&quot;check_func&quot;</span><span class="p">]):</span>
</span><span id="HealthCheckService.run_custom_checks-585"><a href="#HealthCheckService.run_custom_checks-585"><span class="linenos">585</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="HealthCheckService.run_custom_checks-586"><a href="#HealthCheckService.run_custom_checks-586"><span class="linenos">586</span></a>                    <span class="n">result</span> <span class="o">=</span> <span class="n">check_info</span><span class="p">[</span><span class="s2">&quot;check_func&quot;</span><span class="p">]()</span>
</span><span id="HealthCheckService.run_custom_checks-587"><a href="#HealthCheckService.run_custom_checks-587"><span class="linenos">587</span></a>                    <span class="c1"># Remove the function reference from the result</span>
</span><span id="HealthCheckService.run_custom_checks-588"><a href="#HealthCheckService.run_custom_checks-588"><span class="linenos">588</span></a>                    <span class="n">func</span> <span class="o">=</span> <span class="n">check_info</span><span class="p">[</span><span class="s2">&quot;check_func&quot;</span><span class="p">]</span>
</span><span id="HealthCheckService.run_custom_checks-589"><a href="#HealthCheckService.run_custom_checks-589"><span class="linenos">589</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;custom_checks&quot;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="HealthCheckService.run_custom_checks-590"><a href="#HealthCheckService.run_custom_checks-590"><span class="linenos">590</span></a>                    <span class="c1"># Add the function back</span>
</span><span id="HealthCheckService.run_custom_checks-591"><a href="#HealthCheckService.run_custom_checks-591"><span class="linenos">591</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;custom_checks&quot;</span><span class="p">][</span><span class="n">name</span><span class="p">][</span><span class="s2">&quot;check_func&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span>
</span><span id="HealthCheckService.run_custom_checks-592"><a href="#HealthCheckService.run_custom_checks-592"><span class="linenos">592</span></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="HealthCheckService.run_custom_checks-593"><a href="#HealthCheckService.run_custom_checks-593"><span class="linenos">593</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;custom_checks&quot;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="HealthCheckService.run_custom_checks-594"><a href="#HealthCheckService.run_custom_checks-594"><span class="linenos">594</span></a>                        <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;critical&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService.run_custom_checks-595"><a href="#HealthCheckService.run_custom_checks-595"><span class="linenos">595</span></a>                        <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="HealthCheckService.run_custom_checks-596"><a href="#HealthCheckService.run_custom_checks-596"><span class="linenos">596</span></a>                        <span class="s2">&quot;check_func&quot;</span><span class="p">:</span> <span class="n">check_info</span><span class="p">[</span><span class="s2">&quot;check_func&quot;</span><span class="p">]</span>
</span><span id="HealthCheckService.run_custom_checks-597"><a href="#HealthCheckService.run_custom_checks-597"><span class="linenos">597</span></a>                    <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Run all registered custom health checks.</p>
</div>


                            </div>
                            <div id="HealthCheckService.get_health_data" class="classattr">
                                        <input id="HealthCheckService.get_health_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_health_data</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Dict</span>:</span></span>

                <label class="view-source-button" for="HealthCheckService.get_health_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HealthCheckService.get_health_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HealthCheckService.get_health_data-668"><a href="#HealthCheckService.get_health_data-668"><span class="linenos">668</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_health_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="HealthCheckService.get_health_data-669"><a href="#HealthCheckService.get_health_data-669"><span class="linenos">669</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the latest health check data.&quot;&quot;&quot;</span>
</span><span id="HealthCheckService.get_health_data-670"><a href="#HealthCheckService.get_health_data-670"><span class="linenos">670</span></a>        <span class="c1"># Create a copy without the function references</span>
</span><span id="HealthCheckService.get_health_data-671"><a href="#HealthCheckService.get_health_data-671"><span class="linenos">671</span></a>        <span class="n">result</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="HealthCheckService.get_health_data-672"><a href="#HealthCheckService.get_health_data-672"><span class="linenos">672</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="HealthCheckService.get_health_data-673"><a href="#HealthCheckService.get_health_data-673"><span class="linenos">673</span></a>            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;custom_checks&quot;</span><span class="p">:</span>
</span><span id="HealthCheckService.get_health_data-674"><a href="#HealthCheckService.get_health_data-674"><span class="linenos">674</span></a>                <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="HealthCheckService.get_health_data-675"><a href="#HealthCheckService.get_health_data-675"><span class="linenos">675</span></a>                <span class="k">for</span> <span class="n">check_name</span><span class="p">,</span> <span class="n">check_data</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="HealthCheckService.get_health_data-676"><a href="#HealthCheckService.get_health_data-676"><span class="linenos">676</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">check_data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="HealthCheckService.get_health_data-677"><a href="#HealthCheckService.get_health_data-677"><span class="linenos">677</span></a>                        <span class="n">check_copy</span> <span class="o">=</span> <span class="n">check_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="HealthCheckService.get_health_data-678"><a href="#HealthCheckService.get_health_data-678"><span class="linenos">678</span></a>                        <span class="k">if</span> <span class="s2">&quot;check_func&quot;</span> <span class="ow">in</span> <span class="n">check_copy</span><span class="p">:</span>
</span><span id="HealthCheckService.get_health_data-679"><a href="#HealthCheckService.get_health_data-679"><span class="linenos">679</span></a>                            <span class="k">del</span> <span class="n">check_copy</span><span class="p">[</span><span class="s2">&quot;check_func&quot;</span><span class="p">]</span>
</span><span id="HealthCheckService.get_health_data-680"><a href="#HealthCheckService.get_health_data-680"><span class="linenos">680</span></a>                        <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">check_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">check_copy</span>
</span><span id="HealthCheckService.get_health_data-681"><a href="#HealthCheckService.get_health_data-681"><span class="linenos">681</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="HealthCheckService.get_health_data-682"><a href="#HealthCheckService.get_health_data-682"><span class="linenos">682</span></a>                <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="HealthCheckService.get_health_data-683"><a href="#HealthCheckService.get_health_data-683"><span class="linenos">683</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Get the latest health check data.</p>
</div>


                            </div>
                            <div id="HealthCheckService.save_config" class="classattr">
                                        <input id="HealthCheckService.save_config-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save_config</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="HealthCheckService.save_config-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HealthCheckService.save_config"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HealthCheckService.save_config-685"><a href="#HealthCheckService.save_config-685"><span class="linenos">685</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="HealthCheckService.save_config-686"><a href="#HealthCheckService.save_config-686"><span class="linenos">686</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HealthCheckService.save_config-687"><a href="#HealthCheckService.save_config-687"><span class="linenos">687</span></a><span class="sd">        Saves the current health check configuration to a JSON file.</span>
</span><span id="HealthCheckService.save_config-688"><a href="#HealthCheckService.save_config-688"><span class="linenos">688</span></a><span class="sd">        Attempts to write the configuration stored in `self.config` to the file specified by `self.config_path`.</span>
</span><span id="HealthCheckService.save_config-689"><a href="#HealthCheckService.save_config-689"><span class="linenos">689</span></a><span class="sd">        Displays a success message in the Streamlit app upon successful save.</span>
</span><span id="HealthCheckService.save_config-690"><a href="#HealthCheckService.save_config-690"><span class="linenos">690</span></a><span class="sd">        Handles and displays appropriate error messages for file not found, permission issues, JSON decoding errors, and other exceptions.</span>
</span><span id="HealthCheckService.save_config-691"><a href="#HealthCheckService.save_config-691"><span class="linenos">691</span></a><span class="sd">        Raises:</span>
</span><span id="HealthCheckService.save_config-692"><a href="#HealthCheckService.save_config-692"><span class="linenos">692</span></a><span class="sd">            FileNotFoundError: If the configuration file path does not exist.</span>
</span><span id="HealthCheckService.save_config-693"><a href="#HealthCheckService.save_config-693"><span class="linenos">693</span></a><span class="sd">            PermissionError: If there are insufficient permissions to write to the file.</span>
</span><span id="HealthCheckService.save_config-694"><a href="#HealthCheckService.save_config-694"><span class="linenos">694</span></a><span class="sd">            json.JSONDecodeError: If there is an error decoding the JSON data.</span>
</span><span id="HealthCheckService.save_config-695"><a href="#HealthCheckService.save_config-695"><span class="linenos">695</span></a><span class="sd">            Exception: For any other exceptions encountered during the save process.</span>
</span><span id="HealthCheckService.save_config-696"><a href="#HealthCheckService.save_config-696"><span class="linenos">696</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HealthCheckService.save_config-697"><a href="#HealthCheckService.save_config-697"><span class="linenos">697</span></a>        
</span><span id="HealthCheckService.save_config-698"><a href="#HealthCheckService.save_config-698"><span class="linenos">698</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="HealthCheckService.save_config-699"><a href="#HealthCheckService.save_config-699"><span class="linenos">699</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="HealthCheckService.save_config-700"><a href="#HealthCheckService.save_config-700"><span class="linenos">700</span></a>                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="HealthCheckService.save_config-701"><a href="#HealthCheckService.save_config-701"><span class="linenos">701</span></a>                <span class="n">st</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Health check config saved successfully to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService.save_config-702"><a href="#HealthCheckService.save_config-702"><span class="linenos">702</span></a>        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span><span id="HealthCheckService.save_config-703"><a href="#HealthCheckService.save_config-703"><span class="linenos">703</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Configuration file not found: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService.save_config-704"><a href="#HealthCheckService.save_config-704"><span class="linenos">704</span></a>        <span class="k">except</span> <span class="ne">PermissionError</span><span class="p">:</span>
</span><span id="HealthCheckService.save_config-705"><a href="#HealthCheckService.save_config-705"><span class="linenos">705</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Permission denied: Unable to write to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService.save_config-706"><a href="#HealthCheckService.save_config-706"><span class="linenos">706</span></a>        <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
</span><span id="HealthCheckService.save_config-707"><a href="#HealthCheckService.save_config-707"><span class="linenos">707</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error decoding JSON in config file: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService.save_config-708"><a href="#HealthCheckService.save_config-708"><span class="linenos">708</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="HealthCheckService.save_config-709"><a href="#HealthCheckService.save_config-709"><span class="linenos">709</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error saving health check config: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Saves the current health check configuration to a JSON file.
Attempts to write the configuration stored in <code>self.config</code> to the file specified by <code>self.config_path</code>.
Displays a success message in the Streamlit app upon successful save.
Handles and displays appropriate error messages for file not found, permission issues, JSON decoding errors, and other exceptions.
Raises:
    FileNotFoundError: If the configuration file path does not exist.
    PermissionError: If there are insufficient permissions to write to the file.
    json.JSONDecodeError: If there is an error decoding the JSON data.
    Exception: For any other exceptions encountered during the save process.</p>
</div>


                            </div>
                            <div id="HealthCheckService.check_streamlit_pages" class="classattr">
                                        <input id="HealthCheckService.check_streamlit_pages-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_streamlit_pages</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="HealthCheckService.check_streamlit_pages-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HealthCheckService.check_streamlit_pages"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HealthCheckService.check_streamlit_pages-710"><a href="#HealthCheckService.check_streamlit_pages-710"><span class="linenos">710</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_streamlit_pages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="HealthCheckService.check_streamlit_pages-711"><a href="#HealthCheckService.check_streamlit_pages-711"><span class="linenos">711</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HealthCheckService.check_streamlit_pages-712"><a href="#HealthCheckService.check_streamlit_pages-712"><span class="linenos">712</span></a><span class="sd">        Checks for errors in Streamlit pages and updates the health data accordingly.</span>
</span><span id="HealthCheckService.check_streamlit_pages-713"><a href="#HealthCheckService.check_streamlit_pages-713"><span class="linenos">713</span></a><span class="sd">        This method retrieves page errors using StreamlitPageMonitor.get_page_errors().</span>
</span><span id="HealthCheckService.check_streamlit_pages-714"><a href="#HealthCheckService.check_streamlit_pages-714"><span class="linenos">714</span></a><span class="sd">        If errors are found, it sets the &#39;streamlit_pages&#39; status to &#39;critical&#39; and updates</span>
</span><span id="HealthCheckService.check_streamlit_pages-715"><a href="#HealthCheckService.check_streamlit_pages-715"><span class="linenos">715</span></a><span class="sd">        the overall health status to &#39;critical&#39;. If no errors are found, it marks the</span>
</span><span id="HealthCheckService.check_streamlit_pages-716"><a href="#HealthCheckService.check_streamlit_pages-716"><span class="linenos">716</span></a><span class="sd">        &#39;streamlit_pages&#39; status as &#39;healthy&#39;.</span>
</span><span id="HealthCheckService.check_streamlit_pages-717"><a href="#HealthCheckService.check_streamlit_pages-717"><span class="linenos">717</span></a><span class="sd">        Updates:</span>
</span><span id="HealthCheckService.check_streamlit_pages-718"><a href="#HealthCheckService.check_streamlit_pages-718"><span class="linenos">718</span></a><span class="sd">            self.health_data[&quot;streamlit_pages&quot;]: Dict containing status, error count, errors, and details.</span>
</span><span id="HealthCheckService.check_streamlit_pages-719"><a href="#HealthCheckService.check_streamlit_pages-719"><span class="linenos">719</span></a><span class="sd">            self.health_data[&quot;overall_status&quot;]: Set to &#39;critical&#39; if errors are detected.</span>
</span><span id="HealthCheckService.check_streamlit_pages-720"><a href="#HealthCheckService.check_streamlit_pages-720"><span class="linenos">720</span></a><span class="sd">        Returns:</span>
</span><span id="HealthCheckService.check_streamlit_pages-721"><a href="#HealthCheckService.check_streamlit_pages-721"><span class="linenos">721</span></a><span class="sd">            None</span>
</span><span id="HealthCheckService.check_streamlit_pages-722"><a href="#HealthCheckService.check_streamlit_pages-722"><span class="linenos">722</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HealthCheckService.check_streamlit_pages-723"><a href="#HealthCheckService.check_streamlit_pages-723"><span class="linenos">723</span></a>        
</span><span id="HealthCheckService.check_streamlit_pages-724"><a href="#HealthCheckService.check_streamlit_pages-724"><span class="linenos">724</span></a>        <span class="n">page_errors</span> <span class="o">=</span> <span class="n">StreamlitPageMonitor</span><span class="o">.</span><span class="n">get_page_errors</span><span class="p">()</span>
</span><span id="HealthCheckService.check_streamlit_pages-725"><a href="#HealthCheckService.check_streamlit_pages-725"><span class="linenos">725</span></a>        
</span><span id="HealthCheckService.check_streamlit_pages-726"><a href="#HealthCheckService.check_streamlit_pages-726"><span class="linenos">726</span></a>        <span class="k">if</span> <span class="s2">&quot;streamlit_pages&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">:</span>
</span><span id="HealthCheckService.check_streamlit_pages-727"><a href="#HealthCheckService.check_streamlit_pages-727"><span class="linenos">727</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;streamlit_pages&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="HealthCheckService.check_streamlit_pages-728"><a href="#HealthCheckService.check_streamlit_pages-728"><span class="linenos">728</span></a>        
</span><span id="HealthCheckService.check_streamlit_pages-729"><a href="#HealthCheckService.check_streamlit_pages-729"><span class="linenos">729</span></a>        <span class="k">if</span> <span class="n">page_errors</span><span class="p">:</span>
</span><span id="HealthCheckService.check_streamlit_pages-730"><a href="#HealthCheckService.check_streamlit_pages-730"><span class="linenos">730</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;streamlit_pages&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="HealthCheckService.check_streamlit_pages-731"><a href="#HealthCheckService.check_streamlit_pages-731"><span class="linenos">731</span></a>                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;critical&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService.check_streamlit_pages-732"><a href="#HealthCheckService.check_streamlit_pages-732"><span class="linenos">732</span></a>                <span class="s2">&quot;error_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">page_errors</span><span class="p">),</span>
</span><span id="HealthCheckService.check_streamlit_pages-733"><a href="#HealthCheckService.check_streamlit_pages-733"><span class="linenos">733</span></a>                <span class="s2">&quot;errors&quot;</span><span class="p">:</span> <span class="n">page_errors</span><span class="p">,</span>
</span><span id="HealthCheckService.check_streamlit_pages-734"><a href="#HealthCheckService.check_streamlit_pages-734"><span class="linenos">734</span></a>                <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="s2">&quot;Errors detected in Streamlit pages&quot;</span>
</span><span id="HealthCheckService.check_streamlit_pages-735"><a href="#HealthCheckService.check_streamlit_pages-735"><span class="linenos">735</span></a>            <span class="p">}</span>
</span><span id="HealthCheckService.check_streamlit_pages-736"><a href="#HealthCheckService.check_streamlit_pages-736"><span class="linenos">736</span></a>            <span class="c1"># This affects overall status</span>
</span><span id="HealthCheckService.check_streamlit_pages-737"><a href="#HealthCheckService.check_streamlit_pages-737"><span class="linenos">737</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;overall_status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;critical&quot;</span>
</span><span id="HealthCheckService.check_streamlit_pages-738"><a href="#HealthCheckService.check_streamlit_pages-738"><span class="linenos">738</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="HealthCheckService.check_streamlit_pages-739"><a href="#HealthCheckService.check_streamlit_pages-739"><span class="linenos">739</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;streamlit_pages&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="HealthCheckService.check_streamlit_pages-740"><a href="#HealthCheckService.check_streamlit_pages-740"><span class="linenos">740</span></a>                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;healthy&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService.check_streamlit_pages-741"><a href="#HealthCheckService.check_streamlit_pages-741"><span class="linenos">741</span></a>                <span class="s2">&quot;error_count&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="HealthCheckService.check_streamlit_pages-742"><a href="#HealthCheckService.check_streamlit_pages-742"><span class="linenos">742</span></a>                <span class="s2">&quot;errors&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="HealthCheckService.check_streamlit_pages-743"><a href="#HealthCheckService.check_streamlit_pages-743"><span class="linenos">743</span></a>                <span class="s2">&quot;details&quot;</span><span class="p">:</span> <span class="s2">&quot;All pages functioning normally&quot;</span>
</span><span id="HealthCheckService.check_streamlit_pages-744"><a href="#HealthCheckService.check_streamlit_pages-744"><span class="linenos">744</span></a>            <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Checks for errors in Streamlit pages and updates the health data accordingly.
This method retrieves page errors using <a href="#StreamlitPageMonitor.get_page_errors">StreamlitPageMonitor.get_page_errors()</a>.
If errors are found, it sets the 'streamlit_pages' status to 'critical' and updates
the overall health status to 'critical'. If no errors are found, it marks the
'streamlit_pages' status as 'healthy'.
Updates:
    self.health_data["streamlit_pages"]: Dict containing status, error count, errors, and details.
    self.health_data["overall_status"]: Set to 'critical' if errors are detected.
Returns:
    None</p>
</div>


                            </div>
                            <div id="HealthCheckService.check_streamlit_server" class="classattr">
                                        <input id="HealthCheckService.check_streamlit_server-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_streamlit_server</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="HealthCheckService.check_streamlit_server-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HealthCheckService.check_streamlit_server"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HealthCheckService.check_streamlit_server-746"><a href="#HealthCheckService.check_streamlit_server-746"><span class="linenos">746</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_streamlit_server</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="HealthCheckService.check_streamlit_server-747"><a href="#HealthCheckService.check_streamlit_server-747"><span class="linenos">747</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="HealthCheckService.check_streamlit_server-748"><a href="#HealthCheckService.check_streamlit_server-748"><span class="linenos">748</span></a><span class="sd">        Checks the health status of the Streamlit server by sending a GET request to the /healthz endpoint.</span>
</span><span id="HealthCheckService.check_streamlit_server-749"><a href="#HealthCheckService.check_streamlit_server-749"><span class="linenos">749</span></a><span class="sd">        Returns:</span>
</span><span id="HealthCheckService.check_streamlit_server-750"><a href="#HealthCheckService.check_streamlit_server-750"><span class="linenos">750</span></a><span class="sd">            Dict[str, Any]: A dictionary containing the health status, response code, latency in milliseconds,</span>
</span><span id="HealthCheckService.check_streamlit_server-751"><a href="#HealthCheckService.check_streamlit_server-751"><span class="linenos">751</span></a><span class="sd">                            message, and the URL checked. If the server is healthy (HTTP 200), status is &quot;healthy&quot;.</span>
</span><span id="HealthCheckService.check_streamlit_server-752"><a href="#HealthCheckService.check_streamlit_server-752"><span class="linenos">752</span></a><span class="sd">                            Otherwise, status is &quot;critical&quot; with error details.</span>
</span><span id="HealthCheckService.check_streamlit_server-753"><a href="#HealthCheckService.check_streamlit_server-753"><span class="linenos">753</span></a><span class="sd">        Handles:</span>
</span><span id="HealthCheckService.check_streamlit_server-754"><a href="#HealthCheckService.check_streamlit_server-754"><span class="linenos">754</span></a><span class="sd">            - Connection errors: Returns critical status with connection error details.</span>
</span><span id="HealthCheckService.check_streamlit_server-755"><a href="#HealthCheckService.check_streamlit_server-755"><span class="linenos">755</span></a><span class="sd">            - Timeout errors: Returns critical status with timeout error details.</span>
</span><span id="HealthCheckService.check_streamlit_server-756"><a href="#HealthCheckService.check_streamlit_server-756"><span class="linenos">756</span></a><span class="sd">            - Other exceptions: Returns critical status with unknown error details.</span>
</span><span id="HealthCheckService.check_streamlit_server-757"><a href="#HealthCheckService.check_streamlit_server-757"><span class="linenos">757</span></a><span class="sd">        Logs:</span>
</span><span id="HealthCheckService.check_streamlit_server-758"><a href="#HealthCheckService.check_streamlit_server-758"><span class="linenos">758</span></a><span class="sd">            - The URL being checked.</span>
</span><span id="HealthCheckService.check_streamlit_server-759"><a href="#HealthCheckService.check_streamlit_server-759"><span class="linenos">759</span></a><span class="sd">            - The response status code and text.</span>
</span><span id="HealthCheckService.check_streamlit_server-760"><a href="#HealthCheckService.check_streamlit_server-760"><span class="linenos">760</span></a><span class="sd">            - Health status and response time if healthy.</span>
</span><span id="HealthCheckService.check_streamlit_server-761"><a href="#HealthCheckService.check_streamlit_server-761"><span class="linenos">761</span></a><span class="sd">            - Warnings and errors for unhealthy or failed checks.</span>
</span><span id="HealthCheckService.check_streamlit_server-762"><a href="#HealthCheckService.check_streamlit_server-762"><span class="linenos">762</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HealthCheckService.check_streamlit_server-763"><a href="#HealthCheckService.check_streamlit_server-763"><span class="linenos">763</span></a>        
</span><span id="HealthCheckService.check_streamlit_server-764"><a href="#HealthCheckService.check_streamlit_server-764"><span class="linenos">764</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="HealthCheckService.check_streamlit_server-765"><a href="#HealthCheckService.check_streamlit_server-765"><span class="linenos">765</span></a>            <span class="n">host</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">streamlit_url</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span><span id="HealthCheckService.check_streamlit_server-766"><a href="#HealthCheckService.check_streamlit_server-766"><span class="linenos">766</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">host</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;http://&#39;</span><span class="p">,</span> <span class="s1">&#39;https://&#39;</span><span class="p">)):</span>
</span><span id="HealthCheckService.check_streamlit_server-767"><a href="#HealthCheckService.check_streamlit_server-767"><span class="linenos">767</span></a>                <span class="n">host</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;http://</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="HealthCheckService.check_streamlit_server-768"><a href="#HealthCheckService.check_streamlit_server-768"><span class="linenos">768</span></a>            
</span><span id="HealthCheckService.check_streamlit_server-769"><a href="#HealthCheckService.check_streamlit_server-769"><span class="linenos">769</span></a>            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">streamlit_port</span><span class="si">}</span><span class="s2">/healthz&quot;</span>
</span><span id="HealthCheckService.check_streamlit_server-770"><a href="#HealthCheckService.check_streamlit_server-770"><span class="linenos">770</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Checking Streamlit server health at: </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService.check_streamlit_server-771"><a href="#HealthCheckService.check_streamlit_server-771"><span class="linenos">771</span></a>            
</span><span id="HealthCheckService.check_streamlit_server-772"><a href="#HealthCheckService.check_streamlit_server-772"><span class="linenos">772</span></a>            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="HealthCheckService.check_streamlit_server-773"><a href="#HealthCheckService.check_streamlit_server-773"><span class="linenos">773</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span id="HealthCheckService.check_streamlit_server-774"><a href="#HealthCheckService.check_streamlit_server-774"><span class="linenos">774</span></a>            <span class="n">total_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>
</span><span id="HealthCheckService.check_streamlit_server-775"><a href="#HealthCheckService.check_streamlit_server-775"><span class="linenos">775</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService.check_streamlit_server-776"><a href="#HealthCheckService.check_streamlit_server-776"><span class="linenos">776</span></a>            <span class="c1"># Check if the response is healthy</span>
</span><span id="HealthCheckService.check_streamlit_server-777"><a href="#HealthCheckService.check_streamlit_server-777"><span class="linenos">777</span></a>            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="HealthCheckService.check_streamlit_server-778"><a href="#HealthCheckService.check_streamlit_server-778"><span class="linenos">778</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Streamlit server healthy - Response time: </span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">total_time</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s2">ms&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService.check_streamlit_server-779"><a href="#HealthCheckService.check_streamlit_server-779"><span class="linenos">779</span></a>                <span class="k">return</span> <span class="p">{</span>
</span><span id="HealthCheckService.check_streamlit_server-780"><a href="#HealthCheckService.check_streamlit_server-780"><span class="linenos">780</span></a>                    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;healthy&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService.check_streamlit_server-781"><a href="#HealthCheckService.check_streamlit_server-781"><span class="linenos">781</span></a>                    <span class="s2">&quot;response_code&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
</span><span id="HealthCheckService.check_streamlit_server-782"><a href="#HealthCheckService.check_streamlit_server-782"><span class="linenos">782</span></a>                    <span class="s2">&quot;latency_ms&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">total_time</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="HealthCheckService.check_streamlit_server-783"><a href="#HealthCheckService.check_streamlit_server-783"><span class="linenos">783</span></a>                    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Streamlit server is running&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService.check_streamlit_server-784"><a href="#HealthCheckService.check_streamlit_server-784"><span class="linenos">784</span></a>                    <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span>
</span><span id="HealthCheckService.check_streamlit_server-785"><a href="#HealthCheckService.check_streamlit_server-785"><span class="linenos">785</span></a>                <span class="p">}</span>
</span><span id="HealthCheckService.check_streamlit_server-786"><a href="#HealthCheckService.check_streamlit_server-786"><span class="linenos">786</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="HealthCheckService.check_streamlit_server-787"><a href="#HealthCheckService.check_streamlit_server-787"><span class="linenos">787</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unhealthy response from server: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService.check_streamlit_server-788"><a href="#HealthCheckService.check_streamlit_server-788"><span class="linenos">788</span></a>                <span class="k">return</span> <span class="p">{</span>
</span><span id="HealthCheckService.check_streamlit_server-789"><a href="#HealthCheckService.check_streamlit_server-789"><span class="linenos">789</span></a>                    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;critical&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService.check_streamlit_server-790"><a href="#HealthCheckService.check_streamlit_server-790"><span class="linenos">790</span></a>                    <span class="s2">&quot;response_code&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span>
</span><span id="HealthCheckService.check_streamlit_server-791"><a href="#HealthCheckService.check_streamlit_server-791"><span class="linenos">791</span></a>                    <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Unhealthy response from server: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService.check_streamlit_server-792"><a href="#HealthCheckService.check_streamlit_server-792"><span class="linenos">792</span></a>                    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Streamlit server is not healthy&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService.check_streamlit_server-793"><a href="#HealthCheckService.check_streamlit_server-793"><span class="linenos">793</span></a>                    <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span>
</span><span id="HealthCheckService.check_streamlit_server-794"><a href="#HealthCheckService.check_streamlit_server-794"><span class="linenos">794</span></a>                <span class="p">}</span>
</span><span id="HealthCheckService.check_streamlit_server-795"><a href="#HealthCheckService.check_streamlit_server-795"><span class="linenos">795</span></a>
</span><span id="HealthCheckService.check_streamlit_server-796"><a href="#HealthCheckService.check_streamlit_server-796"><span class="linenos">796</span></a>        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="HealthCheckService.check_streamlit_server-797"><a href="#HealthCheckService.check_streamlit_server-797"><span class="linenos">797</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection error while checking Streamlit server: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService.check_streamlit_server-798"><a href="#HealthCheckService.check_streamlit_server-798"><span class="linenos">798</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="HealthCheckService.check_streamlit_server-799"><a href="#HealthCheckService.check_streamlit_server-799"><span class="linenos">799</span></a>                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;critical&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService.check_streamlit_server-800"><a href="#HealthCheckService.check_streamlit_server-800"><span class="linenos">800</span></a>                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Connection error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService.check_streamlit_server-801"><a href="#HealthCheckService.check_streamlit_server-801"><span class="linenos">801</span></a>                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Cannot connect to Streamlit server&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService.check_streamlit_server-802"><a href="#HealthCheckService.check_streamlit_server-802"><span class="linenos">802</span></a>                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span>
</span><span id="HealthCheckService.check_streamlit_server-803"><a href="#HealthCheckService.check_streamlit_server-803"><span class="linenos">803</span></a>            <span class="p">}</span>
</span><span id="HealthCheckService.check_streamlit_server-804"><a href="#HealthCheckService.check_streamlit_server-804"><span class="linenos">804</span></a>        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">Timeout</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="HealthCheckService.check_streamlit_server-805"><a href="#HealthCheckService.check_streamlit_server-805"><span class="linenos">805</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timeout while checking Streamlit server: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService.check_streamlit_server-806"><a href="#HealthCheckService.check_streamlit_server-806"><span class="linenos">806</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="HealthCheckService.check_streamlit_server-807"><a href="#HealthCheckService.check_streamlit_server-807"><span class="linenos">807</span></a>                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;critical&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService.check_streamlit_server-808"><a href="#HealthCheckService.check_streamlit_server-808"><span class="linenos">808</span></a>                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Timeout error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService.check_streamlit_server-809"><a href="#HealthCheckService.check_streamlit_server-809"><span class="linenos">809</span></a>                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Streamlit server is not responding&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService.check_streamlit_server-810"><a href="#HealthCheckService.check_streamlit_server-810"><span class="linenos">810</span></a>                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span>
</span><span id="HealthCheckService.check_streamlit_server-811"><a href="#HealthCheckService.check_streamlit_server-811"><span class="linenos">811</span></a>            <span class="p">}</span>
</span><span id="HealthCheckService.check_streamlit_server-812"><a href="#HealthCheckService.check_streamlit_server-812"><span class="linenos">812</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="HealthCheckService.check_streamlit_server-813"><a href="#HealthCheckService.check_streamlit_server-813"><span class="linenos">813</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected error while checking Streamlit server: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="HealthCheckService.check_streamlit_server-814"><a href="#HealthCheckService.check_streamlit_server-814"><span class="linenos">814</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="HealthCheckService.check_streamlit_server-815"><a href="#HealthCheckService.check_streamlit_server-815"><span class="linenos">815</span></a>                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;critical&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService.check_streamlit_server-816"><a href="#HealthCheckService.check_streamlit_server-816"><span class="linenos">816</span></a>                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Unknown error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService.check_streamlit_server-817"><a href="#HealthCheckService.check_streamlit_server-817"><span class="linenos">817</span></a>                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Failed to check Streamlit server&quot;</span><span class="p">,</span>
</span><span id="HealthCheckService.check_streamlit_server-818"><a href="#HealthCheckService.check_streamlit_server-818"><span class="linenos">818</span></a>                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">url</span>
</span><span id="HealthCheckService.check_streamlit_server-819"><a href="#HealthCheckService.check_streamlit_server-819"><span class="linenos">819</span></a>            <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Checks the health status of the Streamlit server by sending a GET request to the /healthz endpoint.
Returns:
    Dict[str, Any]: A dictionary containing the health status, response code, latency in milliseconds,
                    message, and the URL checked. If the server is healthy (HTTP 200), status is "healthy".
                    Otherwise, status is "critical" with error details.
Handles:
    - Connection errors: Returns critical status with connection error details.
    - Timeout errors: Returns critical status with timeout error details.
    - Other exceptions: Returns critical status with unknown error details.
Logs:
    - The URL being checked.
    - The response status code and text.
    - Health status and response time if healthy.
    - Warnings and errors for unhealthy or failed checks.</p>
</div>


                            </div>
                </section>
                <section id="health_check">
                            <input id="health_check-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">health_check</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">config_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;health_check_config.json&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="health_check-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#health_check"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="health_check-821"><a href="#health_check-821"><span class="linenos"> 821</span></a><span class="k">def</span><span class="w"> </span><span class="nf">health_check</span><span class="p">(</span><span class="n">config_path</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;health_check_config.json&quot;</span><span class="p">):</span>
</span><span id="health_check-822"><a href="#health_check-822"><span class="linenos"> 822</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="health_check-823"><a href="#health_check-823"><span class="linenos"> 823</span></a><span class="sd">    Displays an interactive Streamlit dashboard for monitoring application health.</span>
</span><span id="health_check-824"><a href="#health_check-824"><span class="linenos"> 824</span></a><span class="sd">    This function initializes and manages a health check service, presenting real-time system metrics,</span>
</span><span id="health_check-825"><a href="#health_check-825"><span class="linenos"> 825</span></a><span class="sd">    dependency statuses, custom checks, and Streamlit page health in a user-friendly dashboard.</span>
</span><span id="health_check-826"><a href="#health_check-826"><span class="linenos"> 826</span></a><span class="sd">    Users can manually refresh health checks, view detailed error information, and adjust configuration</span>
</span><span id="health_check-827"><a href="#health_check-827"><span class="linenos"> 827</span></a><span class="sd">    thresholds and intervals directly from the UI.</span>
</span><span id="health_check-828"><a href="#health_check-828"><span class="linenos"> 828</span></a><span class="sd">    Args:</span>
</span><span id="health_check-829"><a href="#health_check-829"><span class="linenos"> 829</span></a><span class="sd">        config_path (str, optional): Path to the health check configuration JSON file.</span>
</span><span id="health_check-830"><a href="#health_check-830"><span class="linenos"> 830</span></a><span class="sd">            Defaults to &quot;health_check_config.json&quot;.</span>
</span><span id="health_check-831"><a href="#health_check-831"><span class="linenos"> 831</span></a><span class="sd">    Features:</span>
</span><span id="health_check-832"><a href="#health_check-832"><span class="linenos"> 832</span></a><span class="sd">        - Displays overall health status with color-coded indicators.</span>
</span><span id="health_check-833"><a href="#health_check-833"><span class="linenos"> 833</span></a><span class="sd">        - Shows last updated timestamp for health data.</span>
</span><span id="health_check-834"><a href="#health_check-834"><span class="linenos"> 834</span></a><span class="sd">        - Monitors Streamlit server status, latency, and errors.</span>
</span><span id="health_check-835"><a href="#health_check-835"><span class="linenos"> 835</span></a><span class="sd">        - Provides tabs for:</span>
</span><span id="health_check-836"><a href="#health_check-836"><span class="linenos"> 836</span></a><span class="sd">            * System Resources (CPU, Memory, Disk usage and status)</span>
</span><span id="health_check-837"><a href="#health_check-837"><span class="linenos"> 837</span></a><span class="sd">            * Dependencies (external services and their health)</span>
</span><span id="health_check-838"><a href="#health_check-838"><span class="linenos"> 838</span></a><span class="sd">            * Custom Checks (user-defined health checks)</span>
</span><span id="health_check-839"><a href="#health_check-839"><span class="linenos"> 839</span></a><span class="sd">            * Streamlit Pages (page-specific errors and status)</span>
</span><span id="health_check-840"><a href="#health_check-840"><span class="linenos"> 840</span></a><span class="sd">        - Allows configuration of system thresholds, check intervals, and Streamlit server settings.</span>
</span><span id="health_check-841"><a href="#health_check-841"><span class="linenos"> 841</span></a><span class="sd">        - Supports manual refresh and saving configuration changes.</span>
</span><span id="health_check-842"><a href="#health_check-842"><span class="linenos"> 842</span></a><span class="sd">    Raises:</span>
</span><span id="health_check-843"><a href="#health_check-843"><span class="linenos"> 843</span></a><span class="sd">        Displays error messages in the UI for any exceptions encountered during health data retrieval or processing.</span>
</span><span id="health_check-844"><a href="#health_check-844"><span class="linenos"> 844</span></a><span class="sd">    Returns:</span>
</span><span id="health_check-845"><a href="#health_check-845"><span class="linenos"> 845</span></a><span class="sd">        None. The dashboard is rendered in the Streamlit app.</span>
</span><span id="health_check-846"><a href="#health_check-846"><span class="linenos"> 846</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="health_check-847"><a href="#health_check-847"><span class="linenos"> 847</span></a>    
</span><span id="health_check-848"><a href="#health_check-848"><span class="linenos"> 848</span></a>    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.health_check&quot;</span><span class="p">)</span>
</span><span id="health_check-849"><a href="#health_check-849"><span class="linenos"> 849</span></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting health check dashboard&quot;</span><span class="p">)</span>
</span><span id="health_check-850"><a href="#health_check-850"><span class="linenos"> 850</span></a>    <span class="n">st</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Application Health Dashboard&quot;</span><span class="p">)</span>
</span><span id="health_check-851"><a href="#health_check-851"><span class="linenos"> 851</span></a>    
</span><span id="health_check-852"><a href="#health_check-852"><span class="linenos"> 852</span></a>    <span class="c1"># Initialize or get the health check service</span>
</span><span id="health_check-853"><a href="#health_check-853"><span class="linenos"> 853</span></a>    <span class="k">if</span> <span class="s2">&quot;health_service&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="p">:</span>
</span><span id="health_check-854"><a href="#health_check-854"><span class="linenos"> 854</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Initializing new health check service&quot;</span><span class="p">)</span>
</span><span id="health_check-855"><a href="#health_check-855"><span class="linenos"> 855</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">health_service</span> <span class="o">=</span> <span class="n">HealthCheckService</span><span class="p">(</span><span class="n">config_path</span> <span class="o">=</span> <span class="n">config_path</span><span class="p">)</span>
</span><span id="health_check-856"><a href="#health_check-856"><span class="linenos"> 856</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">health_service</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="health_check-857"><a href="#health_check-857"><span class="linenos"> 857</span></a>    
</span><span id="health_check-858"><a href="#health_check-858"><span class="linenos"> 858</span></a>    <span class="n">health_service</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">session_state</span><span class="o">.</span><span class="n">health_service</span>
</span><span id="health_check-859"><a href="#health_check-859"><span class="linenos"> 859</span></a>    
</span><span id="health_check-860"><a href="#health_check-860"><span class="linenos"> 860</span></a>    <span class="c1"># Add controls for manual refresh and configuration</span>
</span><span id="health_check-861"><a href="#health_check-861"><span class="linenos"> 861</span></a>    <span class="n">col1</span><span class="p">,</span> <span class="n">col2</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">columns</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="health_check-862"><a href="#health_check-862"><span class="linenos"> 862</span></a>    <span class="k">with</span> <span class="n">col1</span><span class="p">:</span>
</span><span id="health_check-863"><a href="#health_check-863"><span class="linenos"> 863</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">subheader</span><span class="p">(</span><span class="s2">&quot;System Health Status&quot;</span><span class="p">)</span>
</span><span id="health_check-864"><a href="#health_check-864"><span class="linenos"> 864</span></a>    <span class="k">with</span> <span class="n">col2</span><span class="p">:</span>
</span><span id="health_check-865"><a href="#health_check-865"><span class="linenos"> 865</span></a>        <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s2">&quot;Refresh Now&quot;</span><span class="p">):</span>
</span><span id="health_check-866"><a href="#health_check-866"><span class="linenos"> 866</span></a>            <span class="n">health_service</span><span class="o">.</span><span class="n">run_all_checks</span><span class="p">()</span>
</span><span id="health_check-867"><a href="#health_check-867"><span class="linenos"> 867</span></a>    
</span><span id="health_check-868"><a href="#health_check-868"><span class="linenos"> 868</span></a>    <span class="c1"># Get the latest health data</span>
</span><span id="health_check-869"><a href="#health_check-869"><span class="linenos"> 869</span></a>    <span class="n">health_data</span> <span class="o">=</span> <span class="n">health_service</span><span class="o">.</span><span class="n">get_health_data</span><span class="p">()</span>
</span><span id="health_check-870"><a href="#health_check-870"><span class="linenos"> 870</span></a>    
</span><span id="health_check-871"><a href="#health_check-871"><span class="linenos"> 871</span></a>    <span class="c1"># Display overall status with appropriate color</span>
</span><span id="health_check-872"><a href="#health_check-872"><span class="linenos"> 872</span></a>    <span class="n">overall_status</span> <span class="o">=</span> <span class="n">health_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;overall_status&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
</span><span id="health_check-873"><a href="#health_check-873"><span class="linenos"> 873</span></a>    <span class="n">status_color</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="health_check-874"><a href="#health_check-874"><span class="linenos"> 874</span></a>        <span class="s2">&quot;healthy&quot;</span><span class="p">:</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span>
</span><span id="health_check-875"><a href="#health_check-875"><span class="linenos"> 875</span></a>        <span class="s2">&quot;warning&quot;</span><span class="p">:</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span>
</span><span id="health_check-876"><a href="#health_check-876"><span class="linenos"> 876</span></a>        <span class="s2">&quot;critical&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span>
</span><span id="health_check-877"><a href="#health_check-877"><span class="linenos"> 877</span></a>        <span class="s2">&quot;unknown&quot;</span><span class="p">:</span> <span class="s2">&quot;gray&quot;</span>
</span><span id="health_check-878"><a href="#health_check-878"><span class="linenos"> 878</span></a>    <span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">overall_status</span><span class="p">,</span> <span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="health_check-879"><a href="#health_check-879"><span class="linenos"> 879</span></a>    
</span><span id="health_check-880"><a href="#health_check-880"><span class="linenos"> 880</span></a>    <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span>
</span><span id="health_check-881"><a href="#health_check-881"><span class="linenos"> 881</span></a>        <span class="sa">f</span><span class="s2">&quot;&lt;h3 style=&#39;color: </span><span class="si">{</span><span class="n">status_color</span><span class="si">}</span><span class="s2">;&#39;&gt;Overall Status: </span><span class="si">{</span><span class="n">overall_status</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&lt;/h3&gt;&quot;</span><span class="p">,</span>
</span><span id="health_check-882"><a href="#health_check-882"><span class="linenos"> 882</span></a>        <span class="n">unsafe_allow_html</span><span class="o">=</span><span class="kc">True</span>
</span><span id="health_check-883"><a href="#health_check-883"><span class="linenos"> 883</span></a>    <span class="p">)</span>
</span><span id="health_check-884"><a href="#health_check-884"><span class="linenos"> 884</span></a>    
</span><span id="health_check-885"><a href="#health_check-885"><span class="linenos"> 885</span></a>    <span class="c1"># Display last updated time</span>
</span><span id="health_check-886"><a href="#health_check-886"><span class="linenos"> 886</span></a>    <span class="k">if</span> <span class="n">health_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;last_updated&quot;</span><span class="p">):</span>
</span><span id="health_check-887"><a href="#health_check-887"><span class="linenos"> 887</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="health_check-888"><a href="#health_check-888"><span class="linenos"> 888</span></a>            <span class="n">last_updated</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">health_data</span><span class="p">[</span><span class="s2">&quot;last_updated&quot;</span><span class="p">])</span>
</span><span id="health_check-889"><a href="#health_check-889"><span class="linenos"> 889</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Last updated: </span><span class="si">{</span><span class="n">last_updated</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="health_check-890"><a href="#health_check-890"><span class="linenos"> 890</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="health_check-891"><a href="#health_check-891"><span class="linenos"> 891</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Last updated: </span><span class="si">{</span><span class="n">health_data</span><span class="p">[</span><span class="s1">&#39;last_updated&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="health_check-892"><a href="#health_check-892"><span class="linenos"> 892</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="health_check-893"><a href="#health_check-893"><span class="linenos"> 893</span></a>    
</span><span id="health_check-894"><a href="#health_check-894"><span class="linenos"> 894</span></a>    <span class="n">server_health</span> <span class="o">=</span> <span class="n">health_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;streamlit_server&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="health_check-895"><a href="#health_check-895"><span class="linenos"> 895</span></a>    <span class="n">server_status</span> <span class="o">=</span> <span class="n">server_health</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
</span><span id="health_check-896"><a href="#health_check-896"><span class="linenos"> 896</span></a>    <span class="n">server_color</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="health_check-897"><a href="#health_check-897"><span class="linenos"> 897</span></a>        <span class="s2">&quot;healthy&quot;</span><span class="p">:</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span>
</span><span id="health_check-898"><a href="#health_check-898"><span class="linenos"> 898</span></a>        <span class="s2">&quot;critical&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span>
</span><span id="health_check-899"><a href="#health_check-899"><span class="linenos"> 899</span></a>        <span class="s2">&quot;unknown&quot;</span><span class="p">:</span> <span class="s2">&quot;gray&quot;</span>
</span><span id="health_check-900"><a href="#health_check-900"><span class="linenos"> 900</span></a>    <span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">server_status</span><span class="p">,</span> <span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="health_check-901"><a href="#health_check-901"><span class="linenos"> 901</span></a>
</span><span id="health_check-902"><a href="#health_check-902"><span class="linenos"> 902</span></a>    <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span>
</span><span id="health_check-903"><a href="#health_check-903"><span class="linenos"> 903</span></a>        <span class="sa">f</span><span class="s2">&quot;### Streamlit Server Status: &lt;span style=&#39;color: </span><span class="si">{</span><span class="n">server_color</span><span class="si">}</span><span class="s2">&#39;&gt;</span><span class="si">{</span><span class="n">server_status</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&lt;/span&gt;&quot;</span><span class="p">,</span>
</span><span id="health_check-904"><a href="#health_check-904"><span class="linenos"> 904</span></a>        <span class="n">unsafe_allow_html</span><span class="o">=</span><span class="kc">True</span>
</span><span id="health_check-905"><a href="#health_check-905"><span class="linenos"> 905</span></a>    <span class="p">)</span>
</span><span id="health_check-906"><a href="#health_check-906"><span class="linenos"> 906</span></a>
</span><span id="health_check-907"><a href="#health_check-907"><span class="linenos"> 907</span></a>    <span class="k">if</span> <span class="n">server_status</span> <span class="o">!=</span> <span class="s2">&quot;healthy&quot;</span><span class="p">:</span>
</span><span id="health_check-908"><a href="#health_check-908"><span class="linenos"> 908</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">server_health</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;Server status unknown&quot;</span><span class="p">))</span>
</span><span id="health_check-909"><a href="#health_check-909"><span class="linenos"> 909</span></a>        <span class="k">if</span> <span class="s2">&quot;error&quot;</span> <span class="ow">in</span> <span class="n">server_health</span><span class="p">:</span>
</span><span id="health_check-910"><a href="#health_check-910"><span class="linenos"> 910</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">code</span><span class="p">(</span><span class="n">server_health</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">])</span>
</span><span id="health_check-911"><a href="#health_check-911"><span class="linenos"> 911</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="health_check-912"><a href="#health_check-912"><span class="linenos"> 912</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">server_health</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;Server is running&quot;</span><span class="p">))</span>
</span><span id="health_check-913"><a href="#health_check-913"><span class="linenos"> 913</span></a>        <span class="k">if</span> <span class="s2">&quot;latency_ms&quot;</span> <span class="ow">in</span> <span class="n">server_health</span><span class="p">:</span>
</span><span id="health_check-914"><a href="#health_check-914"><span class="linenos"> 914</span></a>            <span class="n">latency</span> <span class="o">=</span> <span class="n">server_health</span><span class="p">[</span><span class="s2">&quot;latency_ms&quot;</span><span class="p">]</span>
</span><span id="health_check-915"><a href="#health_check-915"><span class="linenos"> 915</span></a>            <span class="c1"># Define color based on latency thresholds</span>
</span><span id="health_check-916"><a href="#health_check-916"><span class="linenos"> 916</span></a>            <span class="k">if</span> <span class="n">latency</span> <span class="o">&lt;=</span> <span class="mi">50</span><span class="p">:</span>
</span><span id="health_check-917"><a href="#health_check-917"><span class="linenos"> 917</span></a>                <span class="n">latency_color</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span>
</span><span id="health_check-918"><a href="#health_check-918"><span class="linenos"> 918</span></a>                <span class="n">performance</span> <span class="o">=</span> <span class="s2">&quot;Excellent&quot;</span>
</span><span id="health_check-919"><a href="#health_check-919"><span class="linenos"> 919</span></a>            <span class="k">elif</span> <span class="n">latency</span> <span class="o">&lt;=</span> <span class="mi">100</span><span class="p">:</span>
</span><span id="health_check-920"><a href="#health_check-920"><span class="linenos"> 920</span></a>                <span class="n">latency_color</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span>
</span><span id="health_check-921"><a href="#health_check-921"><span class="linenos"> 921</span></a>                <span class="n">performance</span> <span class="o">=</span> <span class="s2">&quot;Good&quot;</span>
</span><span id="health_check-922"><a href="#health_check-922"><span class="linenos"> 922</span></a>            <span class="k">elif</span> <span class="n">latency</span> <span class="o">&lt;=</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="health_check-923"><a href="#health_check-923"><span class="linenos"> 923</span></a>                <span class="n">latency_color</span> <span class="o">=</span> <span class="s2">&quot;orange&quot;</span>
</span><span id="health_check-924"><a href="#health_check-924"><span class="linenos"> 924</span></a>                <span class="n">performance</span> <span class="o">=</span> <span class="s2">&quot;Fair&quot;</span>
</span><span id="health_check-925"><a href="#health_check-925"><span class="linenos"> 925</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="health_check-926"><a href="#health_check-926"><span class="linenos"> 926</span></a>                <span class="n">latency_color</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span>
</span><span id="health_check-927"><a href="#health_check-927"><span class="linenos"> 927</span></a>                <span class="n">performance</span> <span class="o">=</span> <span class="s2">&quot;Poor&quot;</span>
</span><span id="health_check-928"><a href="#health_check-928"><span class="linenos"> 928</span></a>                
</span><span id="health_check-929"><a href="#health_check-929"><span class="linenos"> 929</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span>
</span><span id="health_check-930"><a href="#health_check-930"><span class="linenos"> 930</span></a>                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="health_check-931"><a href="#health_check-931"><span class="linenos"> 931</span></a><span class="s2">                &lt;div style=&#39;display: flex; align-items: center; gap: 10px;&#39;&gt;</span>
</span><span id="health_check-932"><a href="#health_check-932"><span class="linenos"> 932</span></a><span class="s2">                    &lt;div&gt;Server Response Time:&lt;/div&gt;</span>
</span><span id="health_check-933"><a href="#health_check-933"><span class="linenos"> 933</span></a><span class="s2">                    &lt;div style=&#39;color: </span><span class="si">{</span><span class="n">latency_color</span><span class="si">}</span><span class="s2">; font-weight: bold;&#39;&gt;</span>
</span><span id="health_check-934"><a href="#health_check-934"><span class="linenos"> 934</span></a><span class="s2">                        </span><span class="si">{</span><span class="n">latency</span><span class="si">}</span><span class="s2"> ms</span>
</span><span id="health_check-935"><a href="#health_check-935"><span class="linenos"> 935</span></a><span class="s2">                    &lt;/div&gt;</span>
</span><span id="health_check-936"><a href="#health_check-936"><span class="linenos"> 936</span></a><span class="s2">                    &lt;div style=&#39;color: </span><span class="si">{</span><span class="n">latency_color</span><span class="si">}</span><span class="s2">;&#39;&gt;</span>
</span><span id="health_check-937"><a href="#health_check-937"><span class="linenos"> 937</span></a><span class="s2">                        (</span><span class="si">{</span><span class="n">performance</span><span class="si">}</span><span class="s2">)</span>
</span><span id="health_check-938"><a href="#health_check-938"><span class="linenos"> 938</span></a><span class="s2">                    &lt;/div&gt;</span>
</span><span id="health_check-939"><a href="#health_check-939"><span class="linenos"> 939</span></a><span class="s2">                &lt;/div&gt;</span>
</span><span id="health_check-940"><a href="#health_check-940"><span class="linenos"> 940</span></a><span class="s2">                &quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="health_check-941"><a href="#health_check-941"><span class="linenos"> 941</span></a>                <span class="n">unsafe_allow_html</span><span class="o">=</span><span class="kc">True</span>
</span><span id="health_check-942"><a href="#health_check-942"><span class="linenos"> 942</span></a>            <span class="p">)</span>
</span><span id="health_check-943"><a href="#health_check-943"><span class="linenos"> 943</span></a>    
</span><span id="health_check-944"><a href="#health_check-944"><span class="linenos"> 944</span></a>    <span class="c1"># Create tabs for different categories of health checks</span>
</span><span id="health_check-945"><a href="#health_check-945"><span class="linenos"> 945</span></a>    <span class="n">tab1</span><span class="p">,</span> <span class="n">tab2</span><span class="p">,</span> <span class="n">tab3</span><span class="p">,</span> <span class="n">tab4</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">tabs</span><span class="p">([</span><span class="s2">&quot;System Resources&quot;</span><span class="p">,</span> <span class="s2">&quot;Dependencies&quot;</span><span class="p">,</span> <span class="s2">&quot;Custom Checks&quot;</span><span class="p">,</span> <span class="s2">&quot;Streamlit Pages&quot;</span><span class="p">])</span>
</span><span id="health_check-946"><a href="#health_check-946"><span class="linenos"> 946</span></a>    
</span><span id="health_check-947"><a href="#health_check-947"><span class="linenos"> 947</span></a>    <span class="k">with</span> <span class="n">tab1</span><span class="p">:</span>
</span><span id="health_check-948"><a href="#health_check-948"><span class="linenos"> 948</span></a>        <span class="c1"># Display system health checks</span>
</span><span id="health_check-949"><a href="#health_check-949"><span class="linenos"> 949</span></a>        <span class="n">system_data</span> <span class="o">=</span> <span class="n">health_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="health_check-950"><a href="#health_check-950"><span class="linenos"> 950</span></a>        
</span><span id="health_check-951"><a href="#health_check-951"><span class="linenos"> 951</span></a>        <span class="c1"># CPU</span>
</span><span id="health_check-952"><a href="#health_check-952"><span class="linenos"> 952</span></a>        <span class="k">if</span> <span class="s2">&quot;cpu&quot;</span> <span class="ow">in</span> <span class="n">system_data</span><span class="p">:</span>
</span><span id="health_check-953"><a href="#health_check-953"><span class="linenos"> 953</span></a>            <span class="n">cpu_data</span> <span class="o">=</span> <span class="n">system_data</span><span class="p">[</span><span class="s2">&quot;cpu&quot;</span><span class="p">]</span>
</span><span id="health_check-954"><a href="#health_check-954"><span class="linenos"> 954</span></a>            <span class="n">cpu_status</span> <span class="o">=</span> <span class="n">cpu_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
</span><span id="health_check-955"><a href="#health_check-955"><span class="linenos"> 955</span></a>            <span class="n">cpu_color</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;healthy&quot;</span><span class="p">:</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span><span class="p">:</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="s2">&quot;critical&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">cpu_status</span><span class="p">,</span> <span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="health_check-956"><a href="#health_check-956"><span class="linenos"> 956</span></a>            
</span><span id="health_check-957"><a href="#health_check-957"><span class="linenos"> 957</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;### CPU Status: &lt;span style=&#39;color:</span><span class="si">{</span><span class="n">cpu_color</span><span class="si">}</span><span class="s2">&#39;&gt;</span><span class="si">{</span><span class="n">cpu_status</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&lt;/span&gt;&quot;</span><span class="p">,</span> <span class="n">unsafe_allow_html</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="health_check-958"><a href="#health_check-958"><span class="linenos"> 958</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">progress</span><span class="p">(</span><span class="n">cpu_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;usage_percent&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="health_check-959"><a href="#health_check-959"><span class="linenos"> 959</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CPU Usage: </span><span class="si">{</span><span class="n">cpu_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;usage_percent&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
</span><span id="health_check-960"><a href="#health_check-960"><span class="linenos"> 960</span></a>        
</span><span id="health_check-961"><a href="#health_check-961"><span class="linenos"> 961</span></a>        <span class="c1"># Memory</span>
</span><span id="health_check-962"><a href="#health_check-962"><span class="linenos"> 962</span></a>        <span class="k">if</span> <span class="s2">&quot;memory&quot;</span> <span class="ow">in</span> <span class="n">system_data</span><span class="p">:</span>
</span><span id="health_check-963"><a href="#health_check-963"><span class="linenos"> 963</span></a>            <span class="n">memory_data</span> <span class="o">=</span> <span class="n">system_data</span><span class="p">[</span><span class="s2">&quot;memory&quot;</span><span class="p">]</span>
</span><span id="health_check-964"><a href="#health_check-964"><span class="linenos"> 964</span></a>            <span class="n">memory_status</span> <span class="o">=</span> <span class="n">memory_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
</span><span id="health_check-965"><a href="#health_check-965"><span class="linenos"> 965</span></a>            <span class="n">memory_color</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;healthy&quot;</span><span class="p">:</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span><span class="p">:</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="s2">&quot;critical&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">memory_status</span><span class="p">,</span> <span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="health_check-966"><a href="#health_check-966"><span class="linenos"> 966</span></a>            
</span><span id="health_check-967"><a href="#health_check-967"><span class="linenos"> 967</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;### Memory Status: &lt;span style=&#39;color:</span><span class="si">{</span><span class="n">memory_color</span><span class="si">}</span><span class="s2">&#39;&gt;</span><span class="si">{</span><span class="n">memory_status</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&lt;/span&gt;&quot;</span><span class="p">,</span> <span class="n">unsafe_allow_html</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="health_check-968"><a href="#health_check-968"><span class="linenos"> 968</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">progress</span><span class="p">(</span><span class="n">memory_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;usage_percent&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="health_check-969"><a href="#health_check-969"><span class="linenos"> 969</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Memory Usage: </span><span class="si">{</span><span class="n">memory_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;usage_percent&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
</span><span id="health_check-970"><a href="#health_check-970"><span class="linenos"> 970</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total Memory: </span><span class="si">{</span><span class="n">memory_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;total_gb&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2"> GB&quot;</span><span class="p">)</span>
</span><span id="health_check-971"><a href="#health_check-971"><span class="linenos"> 971</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Available Memory: </span><span class="si">{</span><span class="n">memory_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;available_gb&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2"> GB&quot;</span><span class="p">)</span>
</span><span id="health_check-972"><a href="#health_check-972"><span class="linenos"> 972</span></a>        
</span><span id="health_check-973"><a href="#health_check-973"><span class="linenos"> 973</span></a>        <span class="c1"># Disk</span>
</span><span id="health_check-974"><a href="#health_check-974"><span class="linenos"> 974</span></a>        <span class="k">if</span> <span class="s2">&quot;disk&quot;</span> <span class="ow">in</span> <span class="n">system_data</span><span class="p">:</span>
</span><span id="health_check-975"><a href="#health_check-975"><span class="linenos"> 975</span></a>            <span class="n">disk_data</span> <span class="o">=</span> <span class="n">system_data</span><span class="p">[</span><span class="s2">&quot;disk&quot;</span><span class="p">]</span>
</span><span id="health_check-976"><a href="#health_check-976"><span class="linenos"> 976</span></a>            <span class="n">disk_status</span> <span class="o">=</span> <span class="n">disk_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
</span><span id="health_check-977"><a href="#health_check-977"><span class="linenos"> 977</span></a>            <span class="n">disk_color</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;healthy&quot;</span><span class="p">:</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span><span class="p">:</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="s2">&quot;critical&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">disk_status</span><span class="p">,</span> <span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="health_check-978"><a href="#health_check-978"><span class="linenos"> 978</span></a>            
</span><span id="health_check-979"><a href="#health_check-979"><span class="linenos"> 979</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;### Disk Status: &lt;span style=&#39;color:</span><span class="si">{</span><span class="n">disk_color</span><span class="si">}</span><span class="s2">&#39;&gt;</span><span class="si">{</span><span class="n">disk_status</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&lt;/span&gt;&quot;</span><span class="p">,</span> <span class="n">unsafe_allow_html</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="health_check-980"><a href="#health_check-980"><span class="linenos"> 980</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">progress</span><span class="p">(</span><span class="n">disk_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;usage_percent&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="health_check-981"><a href="#health_check-981"><span class="linenos"> 981</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Disk Usage: </span><span class="si">{</span><span class="n">disk_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;usage_percent&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
</span><span id="health_check-982"><a href="#health_check-982"><span class="linenos"> 982</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total Disk Space: </span><span class="si">{</span><span class="n">disk_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;total_gb&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2"> GB&quot;</span><span class="p">)</span>
</span><span id="health_check-983"><a href="#health_check-983"><span class="linenos"> 983</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Free Disk Space: </span><span class="si">{</span><span class="n">disk_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;free_gb&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="si">}</span><span class="s2"> GB&quot;</span><span class="p">)</span>
</span><span id="health_check-984"><a href="#health_check-984"><span class="linenos"> 984</span></a>    
</span><span id="health_check-985"><a href="#health_check-985"><span class="linenos"> 985</span></a>    <span class="k">with</span> <span class="n">tab2</span><span class="p">:</span>
</span><span id="health_check-986"><a href="#health_check-986"><span class="linenos"> 986</span></a>        <span class="c1"># Display dependency health checks</span>
</span><span id="health_check-987"><a href="#health_check-987"><span class="linenos"> 987</span></a>        <span class="n">dependencies</span> <span class="o">=</span> <span class="n">health_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dependencies&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="health_check-988"><a href="#health_check-988"><span class="linenos"> 988</span></a>        <span class="k">if</span> <span class="n">dependencies</span><span class="p">:</span>
</span><span id="health_check-989"><a href="#health_check-989"><span class="linenos"> 989</span></a>            <span class="c1"># Create a dataframe for all dependencies</span>
</span><span id="health_check-990"><a href="#health_check-990"><span class="linenos"> 990</span></a>            <span class="n">dep_data</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="health_check-991"><a href="#health_check-991"><span class="linenos"> 991</span></a>            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">dep_info</span> <span class="ow">in</span> <span class="n">dependencies</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="health_check-992"><a href="#health_check-992"><span class="linenos"> 992</span></a>                <span class="n">dep_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="health_check-993"><a href="#health_check-993"><span class="linenos"> 993</span></a>                    <span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
</span><span id="health_check-994"><a href="#health_check-994"><span class="linenos"> 994</span></a>                    <span class="s2">&quot;Type&quot;</span><span class="p">:</span> <span class="n">dep_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">),</span>
</span><span id="health_check-995"><a href="#health_check-995"><span class="linenos"> 995</span></a>                    <span class="s2">&quot;Status&quot;</span><span class="p">:</span> <span class="n">dep_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">),</span>
</span><span id="health_check-996"><a href="#health_check-996"><span class="linenos"> 996</span></a>                    <span class="s2">&quot;Details&quot;</span><span class="p">:</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dep_info</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> 
</span><span id="health_check-997"><a href="#health_check-997"><span class="linenos"> 997</span></a>                               <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)])</span>
</span><span id="health_check-998"><a href="#health_check-998"><span class="linenos"> 998</span></a>                <span class="p">})</span>
</span><span id="health_check-999"><a href="#health_check-999"><span class="linenos"> 999</span></a>            
</span><span id="health_check-1000"><a href="#health_check-1000"><span class="linenos">1000</span></a>            <span class="k">if</span> <span class="n">dep_data</span><span class="p">:</span>
</span><span id="health_check-1001"><a href="#health_check-1001"><span class="linenos">1001</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dep_data</span><span class="p">)</span>
</span><span id="health_check-1002"><a href="#health_check-1002"><span class="linenos">1002</span></a>                
</span><span id="health_check-1003"><a href="#health_check-1003"><span class="linenos">1003</span></a>                <span class="c1"># Apply color formatting to status column</span>
</span><span id="health_check-1004"><a href="#health_check-1004"><span class="linenos">1004</span></a>                <span class="k">def</span><span class="w"> </span><span class="nf">color_status</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
</span><span id="health_check-1005"><a href="#health_check-1005"><span class="linenos">1005</span></a>                    <span class="n">colors</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="health_check-1006"><a href="#health_check-1006"><span class="linenos">1006</span></a>                        <span class="s2">&quot;healthy&quot;</span><span class="p">:</span> <span class="s2">&quot;background-color: #c6efce; color: #006100&quot;</span><span class="p">,</span>
</span><span id="health_check-1007"><a href="#health_check-1007"><span class="linenos">1007</span></a>                        <span class="s2">&quot;warning&quot;</span><span class="p">:</span> <span class="s2">&quot;background-color: #ffeb9c; color: #9c5700&quot;</span><span class="p">,</span>
</span><span id="health_check-1008"><a href="#health_check-1008"><span class="linenos">1008</span></a>                        <span class="s2">&quot;critical&quot;</span><span class="p">:</span> <span class="s2">&quot;background-color: #ffc7ce; color: #9c0006&quot;</span><span class="p">,</span>
</span><span id="health_check-1009"><a href="#health_check-1009"><span class="linenos">1009</span></a>                        <span class="s2">&quot;unknown&quot;</span><span class="p">:</span> <span class="s2">&quot;background-color: #eeeeee; color: #7f7f7f&quot;</span>
</span><span id="health_check-1010"><a href="#health_check-1010"><span class="linenos">1010</span></a>                    <span class="p">}</span>
</span><span id="health_check-1011"><a href="#health_check-1011"><span class="linenos">1011</span></a>                    <span class="k">return</span> <span class="n">colors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="health_check-1012"><a href="#health_check-1012"><span class="linenos">1012</span></a>                
</span><span id="health_check-1013"><a href="#health_check-1013"><span class="linenos">1013</span></a>                <span class="n">st</span><span class="o">.</span><span class="n">dataframe</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">color_status</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Status&quot;</span><span class="p">]))</span>
</span><span id="health_check-1014"><a href="#health_check-1014"><span class="linenos">1014</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="health_check-1015"><a href="#health_check-1015"><span class="linenos">1015</span></a>                <span class="n">st</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No dependencies configured&quot;</span><span class="p">)</span>
</span><span id="health_check-1016"><a href="#health_check-1016"><span class="linenos">1016</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="health_check-1017"><a href="#health_check-1017"><span class="linenos">1017</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No dependencies configured&quot;</span><span class="p">)</span>
</span><span id="health_check-1018"><a href="#health_check-1018"><span class="linenos">1018</span></a>    
</span><span id="health_check-1019"><a href="#health_check-1019"><span class="linenos">1019</span></a>    <span class="k">with</span> <span class="n">tab3</span><span class="p">:</span>
</span><span id="health_check-1020"><a href="#health_check-1020"><span class="linenos">1020</span></a>        <span class="c1"># Display custom checks</span>
</span><span id="health_check-1021"><a href="#health_check-1021"><span class="linenos">1021</span></a>        <span class="n">custom_checks</span> <span class="o">=</span> <span class="n">health_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;custom_checks&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="health_check-1022"><a href="#health_check-1022"><span class="linenos">1022</span></a>        <span class="k">if</span> <span class="n">custom_checks</span><span class="p">:</span>
</span><span id="health_check-1023"><a href="#health_check-1023"><span class="linenos">1023</span></a>            <span class="c1"># Create a dataframe for all custom checks</span>
</span><span id="health_check-1024"><a href="#health_check-1024"><span class="linenos">1024</span></a>            <span class="n">check_data</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="health_check-1025"><a href="#health_check-1025"><span class="linenos">1025</span></a>            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">check_info</span> <span class="ow">in</span> <span class="n">custom_checks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="health_check-1026"><a href="#health_check-1026"><span class="linenos">1026</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">check_info</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;check_func&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">check_info</span><span class="p">:</span>
</span><span id="health_check-1027"><a href="#health_check-1027"><span class="linenos">1027</span></a>                    <span class="n">check_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="health_check-1028"><a href="#health_check-1028"><span class="linenos">1028</span></a>                        <span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
</span><span id="health_check-1029"><a href="#health_check-1029"><span class="linenos">1029</span></a>                        <span class="s2">&quot;Status&quot;</span><span class="p">:</span> <span class="n">check_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">),</span>
</span><span id="health_check-1030"><a href="#health_check-1030"><span class="linenos">1030</span></a>                        <span class="s2">&quot;Details&quot;</span><span class="p">:</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">check_info</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> 
</span><span id="health_check-1031"><a href="#health_check-1031"><span class="linenos">1031</span></a>                                  <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;check_func&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)]),</span>
</span><span id="health_check-1032"><a href="#health_check-1032"><span class="linenos">1032</span></a>                        <span class="s2">&quot;Error&quot;</span><span class="p">:</span> <span class="n">check_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="health_check-1033"><a href="#health_check-1033"><span class="linenos">1033</span></a>                    <span class="p">})</span>
</span><span id="health_check-1034"><a href="#health_check-1034"><span class="linenos">1034</span></a>            
</span><span id="health_check-1035"><a href="#health_check-1035"><span class="linenos">1035</span></a>            <span class="k">if</span> <span class="n">check_data</span><span class="p">:</span>
</span><span id="health_check-1036"><a href="#health_check-1036"><span class="linenos">1036</span></a>                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">check_data</span><span class="p">)</span>
</span><span id="health_check-1037"><a href="#health_check-1037"><span class="linenos">1037</span></a>                
</span><span id="health_check-1038"><a href="#health_check-1038"><span class="linenos">1038</span></a>                <span class="c1"># Apply color formatting to status column</span>
</span><span id="health_check-1039"><a href="#health_check-1039"><span class="linenos">1039</span></a>                <span class="k">def</span><span class="w"> </span><span class="nf">color_status</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
</span><span id="health_check-1040"><a href="#health_check-1040"><span class="linenos">1040</span></a>                    <span class="n">colors</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="health_check-1041"><a href="#health_check-1041"><span class="linenos">1041</span></a>                        <span class="s2">&quot;healthy&quot;</span><span class="p">:</span> <span class="s2">&quot;background-color: #c6efce; color: #006100&quot;</span><span class="p">,</span>
</span><span id="health_check-1042"><a href="#health_check-1042"><span class="linenos">1042</span></a>                        <span class="s2">&quot;warning&quot;</span><span class="p">:</span> <span class="s2">&quot;background-color: #ffeb9c; color: #9c5700&quot;</span><span class="p">,</span>
</span><span id="health_check-1043"><a href="#health_check-1043"><span class="linenos">1043</span></a>                        <span class="s2">&quot;critical&quot;</span><span class="p">:</span> <span class="s2">&quot;background-color: #ffc7ce; color: #9c0006&quot;</span><span class="p">,</span>
</span><span id="health_check-1044"><a href="#health_check-1044"><span class="linenos">1044</span></a>                        <span class="s2">&quot;unknown&quot;</span><span class="p">:</span> <span class="s2">&quot;background-color: #eeeeee; color: #7f7f7f&quot;</span>
</span><span id="health_check-1045"><a href="#health_check-1045"><span class="linenos">1045</span></a>                    <span class="p">}</span>
</span><span id="health_check-1046"><a href="#health_check-1046"><span class="linenos">1046</span></a>                    <span class="k">return</span> <span class="n">colors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="health_check-1047"><a href="#health_check-1047"><span class="linenos">1047</span></a>                
</span><span id="health_check-1048"><a href="#health_check-1048"><span class="linenos">1048</span></a>                <span class="n">st</span><span class="o">.</span><span class="n">dataframe</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">color_status</span><span class="p">,</span> <span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Status&quot;</span><span class="p">]))</span>
</span><span id="health_check-1049"><a href="#health_check-1049"><span class="linenos">1049</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="health_check-1050"><a href="#health_check-1050"><span class="linenos">1050</span></a>                <span class="n">st</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No custom checks configured&quot;</span><span class="p">)</span>
</span><span id="health_check-1051"><a href="#health_check-1051"><span class="linenos">1051</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="health_check-1052"><a href="#health_check-1052"><span class="linenos">1052</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No custom checks configured&quot;</span><span class="p">)</span>
</span><span id="health_check-1053"><a href="#health_check-1053"><span class="linenos">1053</span></a>    <span class="k">with</span> <span class="n">tab4</span><span class="p">:</span>
</span><span id="health_check-1054"><a href="#health_check-1054"><span class="linenos">1054</span></a>        <span class="n">page_health</span> <span class="o">=</span> <span class="n">health_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;streamlit_pages&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="health_check-1055"><a href="#health_check-1055"><span class="linenos">1055</span></a>        <span class="n">status</span> <span class="o">=</span> <span class="n">page_health</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
</span><span id="health_check-1056"><a href="#health_check-1056"><span class="linenos">1056</span></a>        <span class="n">error_count</span> <span class="o">=</span> <span class="n">page_health</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;error_count&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  
</span><span id="health_check-1057"><a href="#health_check-1057"><span class="linenos">1057</span></a>        <span class="n">status_color</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="health_check-1058"><a href="#health_check-1058"><span class="linenos">1058</span></a>            <span class="s2">&quot;healthy&quot;</span><span class="p">:</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span>
</span><span id="health_check-1059"><a href="#health_check-1059"><span class="linenos">1059</span></a>            <span class="s2">&quot;critical&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span>
</span><span id="health_check-1060"><a href="#health_check-1060"><span class="linenos">1060</span></a>            <span class="s2">&quot;unknown&quot;</span><span class="p">:</span> <span class="s2">&quot;gray&quot;</span>
</span><span id="health_check-1061"><a href="#health_check-1061"><span class="linenos">1061</span></a>        <span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="health_check-1062"><a href="#health_check-1062"><span class="linenos">1062</span></a>        
</span><span id="health_check-1063"><a href="#health_check-1063"><span class="linenos">1063</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;### Page Status: &lt;span style=&#39;color:</span><span class="si">{</span><span class="n">status_color</span><span class="si">}</span><span class="s2">&#39;&gt;</span><span class="si">{</span><span class="n">status</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">&lt;/span&gt;&quot;</span><span class="p">,</span> <span class="n">unsafe_allow_html</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="health_check-1064"><a href="#health_check-1064"><span class="linenos">1064</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">metric</span><span class="p">(</span><span class="s2">&quot;Error Count&quot;</span><span class="p">,</span> <span class="n">error_count</span><span class="p">)</span>
</span><span id="health_check-1065"><a href="#health_check-1065"><span class="linenos">1065</span></a>        <span class="k">if</span> <span class="n">error_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="health_check-1066"><a href="#health_check-1066"><span class="linenos">1066</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Pages with errors:&quot;</span><span class="p">)</span>
</span><span id="health_check-1067"><a href="#health_check-1067"><span class="linenos">1067</span></a>            <span class="n">errors_dict</span> <span class="o">=</span> <span class="n">page_health</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;errors&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="health_check-1068"><a href="#health_check-1068"><span class="linenos">1068</span></a>            
</span><span id="health_check-1069"><a href="#health_check-1069"><span class="linenos">1069</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">errors_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="health_check-1070"><a href="#health_check-1070"><span class="linenos">1070</span></a>                <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Invalid error data format&quot;</span><span class="p">)</span>
</span><span id="health_check-1071"><a href="#health_check-1071"><span class="linenos">1071</span></a>                <span class="k">return</span>
</span><span id="health_check-1072"><a href="#health_check-1072"><span class="linenos">1072</span></a>            
</span><span id="health_check-1073"><a href="#health_check-1073"><span class="linenos">1073</span></a>            <span class="k">for</span> <span class="n">page_name</span><span class="p">,</span> <span class="n">page_errors</span> <span class="ow">in</span> <span class="n">errors_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="health_check-1074"><a href="#health_check-1074"><span class="linenos">1074</span></a>                <span class="c1"># Create a meaningful page name for display</span>
</span><span id="health_check-1075"><a href="#health_check-1075"><span class="linenos">1075</span></a>                <span class="n">display_name</span> <span class="o">=</span> <span class="n">page_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">in</span> <span class="n">page_name</span> <span class="k">else</span> <span class="n">page_name</span>
</span><span id="health_check-1076"><a href="#health_check-1076"><span class="linenos">1076</span></a>                
</span><span id="health_check-1077"><a href="#health_check-1077"><span class="linenos">1077</span></a>                <span class="k">for</span> <span class="n">error_info</span> <span class="ow">in</span> <span class="n">page_errors</span><span class="p">:</span>
</span><span id="health_check-1078"><a href="#health_check-1078"><span class="linenos">1078</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">error_info</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="health_check-1079"><a href="#health_check-1079"><span class="linenos">1079</span></a>                        <span class="k">with</span> <span class="n">st</span><span class="o">.</span><span class="n">expander</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in </span><span class="si">{</span><span class="n">display_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
</span><span id="health_check-1080"><a href="#health_check-1080"><span class="linenos">1080</span></a>                            <span class="c1"># Display error message without the &quot;Streamlit Error:&quot; prefix</span>
</span><span id="health_check-1081"><a href="#health_check-1081"><span class="linenos">1081</span></a>                            <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown error&#39;</span><span class="p">))</span>
</span><span id="health_check-1082"><a href="#health_check-1082"><span class="linenos">1082</span></a>                            
</span><span id="health_check-1083"><a href="#health_check-1083"><span class="linenos">1083</span></a>                            <span class="c1"># Show additional error details</span>
</span><span id="health_check-1084"><a href="#health_check-1084"><span class="linenos">1084</span></a>                            <span class="k">if</span> <span class="n">error_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;streamlit_error&#39;</span><span class="p">:</span>
</span><span id="health_check-1085"><a href="#health_check-1085"><span class="linenos">1085</span></a>                                <span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;Type: Streamlit Error&quot;</span><span class="p">)</span>
</span><span id="health_check-1086"><a href="#health_check-1086"><span class="linenos">1086</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="health_check-1087"><a href="#health_check-1087"><span class="linenos">1087</span></a>                                <span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;Type: Exception&quot;</span><span class="p">)</span>
</span><span id="health_check-1088"><a href="#health_check-1088"><span class="linenos">1088</span></a>                                
</span><span id="health_check-1089"><a href="#health_check-1089"><span class="linenos">1089</span></a>                            <span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s2">&quot;Traceback:&quot;</span><span class="p">)</span>
</span><span id="health_check-1090"><a href="#health_check-1090"><span class="linenos">1090</span></a>                            <span class="n">st</span><span class="o">.</span><span class="n">code</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">error_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;traceback&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;No traceback available&#39;</span><span class="p">])))</span>
</span><span id="health_check-1091"><a href="#health_check-1091"><span class="linenos">1091</span></a>                            <span class="n">st</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timestamp: </span><span class="si">{</span><span class="n">error_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;No timestamp&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="health_check-1092"><a href="#health_check-1092"><span class="linenos">1092</span></a>    
</span><span id="health_check-1093"><a href="#health_check-1093"><span class="linenos">1093</span></a>    <span class="c1"># Configuration section</span>
</span><span id="health_check-1094"><a href="#health_check-1094"><span class="linenos">1094</span></a>    <span class="k">with</span> <span class="n">st</span><span class="o">.</span><span class="n">expander</span><span class="p">(</span><span class="s2">&quot;Health Check Configuration&quot;</span><span class="p">):</span>
</span><span id="health_check-1095"><a href="#health_check-1095"><span class="linenos">1095</span></a>        <span class="n">st</span><span class="o">.</span><span class="n">subheader</span><span class="p">(</span><span class="s2">&quot;System Check Thresholds&quot;</span><span class="p">)</span>
</span><span id="health_check-1096"><a href="#health_check-1096"><span class="linenos">1096</span></a>        
</span><span id="health_check-1097"><a href="#health_check-1097"><span class="linenos">1097</span></a>        <span class="n">col1</span><span class="p">,</span> <span class="n">col2</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">columns</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="health_check-1098"><a href="#health_check-1098"><span class="linenos">1098</span></a>        <span class="k">with</span> <span class="n">col1</span><span class="p">:</span>
</span><span id="health_check-1099"><a href="#health_check-1099"><span class="linenos">1099</span></a>            <span class="n">cpu_warning</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">slider</span><span class="p">(</span><span class="s2">&quot;CPU Warning Threshold (%)&quot;</span><span class="p">,</span> 
</span><span id="health_check-1100"><a href="#health_check-1100"><span class="linenos">1100</span></a>                                <span class="n">min_value</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> 
</span><span id="health_check-1101"><a href="#health_check-1101"><span class="linenos">1101</span></a>                                <span class="n">value</span><span class="o">=</span><span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cpu_warning&quot;</span><span class="p">,</span> <span class="mi">70</span><span class="p">),</span>
</span><span id="health_check-1102"><a href="#health_check-1102"><span class="linenos">1102</span></a>                                <span class="n">step</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="health_check-1103"><a href="#health_check-1103"><span class="linenos">1103</span></a>            <span class="n">memory_warning</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">slider</span><span class="p">(</span><span class="s2">&quot;Memory Warning Threshold (%)&quot;</span><span class="p">,</span> 
</span><span id="health_check-1104"><a href="#health_check-1104"><span class="linenos">1104</span></a>                                   <span class="n">min_value</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> 
</span><span id="health_check-1105"><a href="#health_check-1105"><span class="linenos">1105</span></a>                                   <span class="n">value</span><span class="o">=</span><span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_warning&quot;</span><span class="p">,</span> <span class="mi">70</span><span class="p">),</span>
</span><span id="health_check-1106"><a href="#health_check-1106"><span class="linenos">1106</span></a>                                   <span class="n">step</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="health_check-1107"><a href="#health_check-1107"><span class="linenos">1107</span></a>            <span class="n">disk_warning</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">slider</span><span class="p">(</span><span class="s2">&quot;Disk Warning Threshold (%)&quot;</span><span class="p">,</span> 
</span><span id="health_check-1108"><a href="#health_check-1108"><span class="linenos">1108</span></a>                                 <span class="n">min_value</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> 
</span><span id="health_check-1109"><a href="#health_check-1109"><span class="linenos">1109</span></a>                                 <span class="n">value</span><span class="o">=</span><span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;disk_warning&quot;</span><span class="p">,</span> <span class="mi">70</span><span class="p">),</span>
</span><span id="health_check-1110"><a href="#health_check-1110"><span class="linenos">1110</span></a>                                 <span class="n">step</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="health_check-1111"><a href="#health_check-1111"><span class="linenos">1111</span></a>            <span class="n">streamlit_url_update</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">text_input</span><span class="p">(</span>
</span><span id="health_check-1112"><a href="#health_check-1112"><span class="linenos">1112</span></a>                <span class="s2">&quot;Streamlit Server URL&quot;</span><span class="p">,</span>
</span><span id="health_check-1113"><a href="#health_check-1113"><span class="linenos">1113</span></a>                <span class="n">value</span><span class="o">=</span><span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;streamlit_url&quot;</span><span class="p">,</span> <span class="s2">&quot;http://localhost&quot;</span><span class="p">)</span>
</span><span id="health_check-1114"><a href="#health_check-1114"><span class="linenos">1114</span></a>            <span class="p">)</span>
</span><span id="health_check-1115"><a href="#health_check-1115"><span class="linenos">1115</span></a>        
</span><span id="health_check-1116"><a href="#health_check-1116"><span class="linenos">1116</span></a>        <span class="k">with</span> <span class="n">col2</span><span class="p">:</span>
</span><span id="health_check-1117"><a href="#health_check-1117"><span class="linenos">1117</span></a>            <span class="n">cpu_critical</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">slider</span><span class="p">(</span><span class="s2">&quot;CPU Critical Threshold (%)&quot;</span><span class="p">,</span> 
</span><span id="health_check-1118"><a href="#health_check-1118"><span class="linenos">1118</span></a>                                 <span class="n">min_value</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">95</span><span class="p">,</span> 
</span><span id="health_check-1119"><a href="#health_check-1119"><span class="linenos">1119</span></a>                                 <span class="n">value</span><span class="o">=</span><span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cpu_critical&quot;</span><span class="p">,</span> <span class="mi">90</span><span class="p">),</span>
</span><span id="health_check-1120"><a href="#health_check-1120"><span class="linenos">1120</span></a>                                 <span class="n">step</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="health_check-1121"><a href="#health_check-1121"><span class="linenos">1121</span></a>            <span class="n">memory_critical</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">slider</span><span class="p">(</span><span class="s2">&quot;Memory Critical Threshold (%)&quot;</span><span class="p">,</span> 
</span><span id="health_check-1122"><a href="#health_check-1122"><span class="linenos">1122</span></a>                                    <span class="n">min_value</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">95</span><span class="p">,</span> 
</span><span id="health_check-1123"><a href="#health_check-1123"><span class="linenos">1123</span></a>                                    <span class="n">value</span><span class="o">=</span><span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory_critical&quot;</span><span class="p">,</span> <span class="mi">90</span><span class="p">),</span>
</span><span id="health_check-1124"><a href="#health_check-1124"><span class="linenos">1124</span></a>                                    <span class="n">step</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="health_check-1125"><a href="#health_check-1125"><span class="linenos">1125</span></a>            <span class="n">disk_critical</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">slider</span><span class="p">(</span><span class="s2">&quot;Disk Critical Threshold (%)&quot;</span><span class="p">,</span> 
</span><span id="health_check-1126"><a href="#health_check-1126"><span class="linenos">1126</span></a>                                  <span class="n">min_value</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">95</span><span class="p">,</span> 
</span><span id="health_check-1127"><a href="#health_check-1127"><span class="linenos">1127</span></a>                                  <span class="n">value</span><span class="o">=</span><span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;disk_critical&quot;</span><span class="p">,</span> <span class="mi">90</span><span class="p">),</span>
</span><span id="health_check-1128"><a href="#health_check-1128"><span class="linenos">1128</span></a>                                  <span class="n">step</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="health_check-1129"><a href="#health_check-1129"><span class="linenos">1129</span></a>        
</span><span id="health_check-1130"><a href="#health_check-1130"><span class="linenos">1130</span></a>            <span class="n">check_interval</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">slider</span><span class="p">(</span><span class="s2">&quot;Check Interval (seconds)&quot;</span><span class="p">,</span> 
</span><span id="health_check-1131"><a href="#health_check-1131"><span class="linenos">1131</span></a>                                <span class="n">min_value</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> 
</span><span id="health_check-1132"><a href="#health_check-1132"><span class="linenos">1132</span></a>                                <span class="n">value</span><span class="o">=</span><span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;check_interval&quot;</span><span class="p">,</span> <span class="mi">60</span><span class="p">),</span>
</span><span id="health_check-1133"><a href="#health_check-1133"><span class="linenos">1133</span></a>                                <span class="n">step</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span id="health_check-1134"><a href="#health_check-1134"><span class="linenos">1134</span></a>            <span class="n">streamlit_port_update</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span>
</span><span id="health_check-1135"><a href="#health_check-1135"><span class="linenos">1135</span></a>                <span class="s2">&quot;Streamlit Server Port&quot;</span><span class="p">,</span>
</span><span id="health_check-1136"><a href="#health_check-1136"><span class="linenos">1136</span></a>                <span class="n">value</span><span class="o">=</span><span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;streamlit_port&quot;</span><span class="p">,</span> <span class="mi">8501</span><span class="p">),</span>
</span><span id="health_check-1137"><a href="#health_check-1137"><span class="linenos">1137</span></a>                <span class="n">step</span><span class="o">=</span><span class="mi">1</span>
</span><span id="health_check-1138"><a href="#health_check-1138"><span class="linenos">1138</span></a>            <span class="p">)</span>
</span><span id="health_check-1139"><a href="#health_check-1139"><span class="linenos">1139</span></a>        
</span><span id="health_check-1140"><a href="#health_check-1140"><span class="linenos">1140</span></a>        <span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s2">&quot;Save Configuration&quot;</span><span class="p">):</span>
</span><span id="health_check-1141"><a href="#health_check-1141"><span class="linenos">1141</span></a>            <span class="c1"># Update configuration</span>
</span><span id="health_check-1142"><a href="#health_check-1142"><span class="linenos">1142</span></a>            <span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">][</span><span class="s2">&quot;cpu_warning&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cpu_warning</span>
</span><span id="health_check-1143"><a href="#health_check-1143"><span class="linenos">1143</span></a>            <span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">][</span><span class="s2">&quot;cpu_critical&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cpu_critical</span>
</span><span id="health_check-1144"><a href="#health_check-1144"><span class="linenos">1144</span></a>            <span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">][</span><span class="s2">&quot;memory_warning&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">memory_warning</span>
</span><span id="health_check-1145"><a href="#health_check-1145"><span class="linenos">1145</span></a>            <span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">][</span><span class="s2">&quot;memory_critical&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">memory_critical</span>
</span><span id="health_check-1146"><a href="#health_check-1146"><span class="linenos">1146</span></a>            <span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">][</span><span class="s2">&quot;disk_warning&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">disk_warning</span>
</span><span id="health_check-1147"><a href="#health_check-1147"><span class="linenos">1147</span></a>            <span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;thresholds&quot;</span><span class="p">][</span><span class="s2">&quot;disk_critical&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">disk_critical</span>
</span><span id="health_check-1148"><a href="#health_check-1148"><span class="linenos">1148</span></a>            <span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;check_interval&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">check_interval</span>
</span><span id="health_check-1149"><a href="#health_check-1149"><span class="linenos">1149</span></a>            <span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;streamlit_url&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">streamlit_url_update</span>
</span><span id="health_check-1150"><a href="#health_check-1150"><span class="linenos">1150</span></a>            <span class="n">health_service</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;streamlit_port&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">streamlit_port_update</span>
</span><span id="health_check-1151"><a href="#health_check-1151"><span class="linenos">1151</span></a>            
</span><span id="health_check-1152"><a href="#health_check-1152"><span class="linenos">1152</span></a>            <span class="c1"># Save to file</span>
</span><span id="health_check-1153"><a href="#health_check-1153"><span class="linenos">1153</span></a>            <span class="n">health_service</span><span class="o">.</span><span class="n">save_config</span><span class="p">()</span>
</span><span id="health_check-1154"><a href="#health_check-1154"><span class="linenos">1154</span></a>            <span class="n">st</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="s2">&quot;Configuration saved successfully&quot;</span><span class="p">)</span>
</span><span id="health_check-1155"><a href="#health_check-1155"><span class="linenos">1155</span></a>            
</span><span id="health_check-1156"><a href="#health_check-1156"><span class="linenos">1156</span></a>            <span class="c1"># Restart the service if interval changed</span>
</span><span id="health_check-1157"><a href="#health_check-1157"><span class="linenos">1157</span></a>            <span class="n">health_service</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</span><span id="health_check-1158"><a href="#health_check-1158"><span class="linenos">1158</span></a>            <span class="n">health_service</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Displays an interactive Streamlit dashboard for monitoring application health.
This function initializes and manages a health check service, presenting real-time system metrics,
dependency statuses, custom checks, and Streamlit page health in a user-friendly dashboard.
Users can manually refresh health checks, view detailed error information, and adjust configuration
thresholds and intervals directly from the UI.
Args:
    config_path (str, optional): Path to the health check configuration JSON file.
        Defaults to "health_check_config.json".
Features:
    - Displays overall health status with color-coded indicators.
    - Shows last updated timestamp for health data.
    - Monitors Streamlit server status, latency, and errors.
    - Provides tabs for:
        * System Resources (CPU, Memory, Disk usage and status)
        * Dependencies (external services and their health)
        * Custom Checks (user-defined health checks)
        * Streamlit Pages (page-specific errors and status)
    - Allows configuration of system thresholds, check intervals, and Streamlit server settings.
    - Supports manual refresh and saving configuration changes.
Raises:
    Displays error messages in the UI for any exceptions encountered during health data retrieval or processing.
Returns:
    None. The dashboard is rendered in the Streamlit app.</p>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>